<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ZipMetro Delivery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <!-- Put the provided logo file at assets/zipmetro-logo.png -->
  <link rel="icon" href="assets/zipmetro-logo.png" />
  <style>
    * { box-sizing: border-box; }
    :root{
      --font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      --max-width:1200px;
      
      /* Modern, accessible color palette */
      --primary: #0ea5a4; /* Teal - main brand */
      --primary-dark: #0d8a89;
      --primary-light: #14b8b6;
      --accent: #fb923c; /* Warm orange */
      --accent-dark: #f97316;
      --accent-light: #fdba74;
      
      /* Neutral colors with high contrast */
      --bg-primary: #ffffff;
      --bg-secondary: #f8fafc;
      --bg-tertiary: #f1f5f9;
      --surface: #ffffff;
      --surface-elevated: #ffffff;
      
      --text-primary: #0f172a;
      --text-secondary: #475569;
      --text-muted: #64748b;
      --text-inverse: #ffffff;
      
      --border-light: #e2e8f0;
      --border-medium: #cbd5e1;
      --border-strong: #94a3b8;
      
      /* Shadows for depth */
      --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --radius-full: 9999px;
      
      --focus-ring: 0 0 0 3px rgba(14, 165, 164, 0.2);
      --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
      
      /* Spacing scale */
      --space-xs: 0.5rem;
      --space-sm: 0.75rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --space-3xl: 4rem;
      
      /* Touch target sizes (minimum 44x44px for accessibility) */
      --touch-target: 44px;
      --touch-target-lg: 52px;
    }
    html{ 
      -webkit-text-size-adjust:100%; 
      font-size:16px;
      scroll-behavior: smooth;
    }
    body {
      margin: 0;
      font-family: var(--font-family);
      background: var(--bg-secondary);
      color: var(--text-primary);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height: 1.6;
    }
    .skip-link{
      position: absolute;
      left: -999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    .skip-link:focus{
      left: var(--space-md);
      top: var(--space-md);
      width: auto;
      height: auto;
      background: var(--primary);
      color: var(--text-inverse);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      z-index: 9999;
      font-weight: 600;
    }
    header {
      background: var(--surface);
      padding: var(--space-md) var(--space-lg);
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-light);
      position: sticky;
      top: 0;
      z-index: 50;
      box-shadow: var(--shadow-sm);
      backdrop-filter: blur(10px);
      background: rgba(255, 255, 255, 0.95);
    }
    .brand {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: var(--space-md);
    }
    .brand-logo{ 
      width: 48px; 
      height: 48px; 
      object-fit: contain; 
      border-radius: var(--radius-md); 
      display: inline-block;
      box-shadow: var(--shadow-sm);
    }
    .brand-title {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.02em;
      display: block;
      line-height: 1.2;
      color: var(--text-primary);
    }
    .brand-sub {
      font-size: 12px;
      color: var(--text-muted);
      display: block;
      margin-top: 2px;
      font-weight: 400;
    }
    nav {
      display: flex;
      gap: var(--space-sm);
      align-items: center;
    }
    .nav-toggle{
      display: none;
      background: var(--bg-tertiary);
      border: 1px solid var(--border-light);
      color: var(--text-primary);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: 16px;
      min-height: var(--touch-target);
      min-width: var(--touch-target);
      transition: all var(--transition-base);
    }
    .nav-toggle:hover {
      background: var(--bg-secondary);
      border-color: var(--border-medium);
    }
    .nav-toggle:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }
    .nav-toggle svg{ display: block; }
    .nav-btn {
      border: none;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      padding: var(--space-sm) var(--space-lg);
      border-radius: var(--radius-full);
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      min-height: var(--touch-target);
      transition: all var(--transition-base);
      white-space: nowrap;
    }
    .nav-btn.active {
      background: var(--primary);
      color: var(--text-inverse);
      box-shadow: var(--shadow-md);
    }
    .nav-btn:hover:not(.active) {
      background: var(--bg-secondary);
      color: var(--text-primary);
    }
    .nav-btn:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }
    .cart-indicator {
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 500;
      padding: var(--space-sm) var(--space-md);
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
    }
    .layout {
      display: grid;
      grid-template-columns: 280px 1fr;
      min-height: calc(100vh - 80px);
      max-width: var(--max-width);
      margin: 0 auto;
      gap: var(--space-xl);
      padding: var(--space-xl) var(--space-lg);
    }
    main{ 
      padding: 0;
      width: 100%;
    }
    aside {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      box-shadow: var(--shadow-sm);
      height: fit-content;
      position: sticky;
      top: calc(80px + var(--space-xl));
    }
    main {
      padding: 0;
    }
    h2 {
      margin-top: 0;
      margin-bottom: var(--space-md);
      font-size: 28px;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.02em;
      line-height: 1.2;
    }
    h3 {
      margin-top: 0;
      margin-bottom: var(--space-md);
      font-size: 18px;
      font-weight: 600;
      color: var(--text-primary);
      letter-spacing: -0.01em;
    }
    .section {
      display: none;
    }
    .section.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .category-list {
      list-style: none;
      padding: 0;
      margin: 0 0 var(--space-xl);
    }
    .category-item {
      padding: var(--space-md) var(--space-lg);
      margin-bottom: var(--space-xs);
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: var(--text-secondary);
      transition: all var(--transition-base);
      min-height: var(--touch-target);
      display: flex;
      align-items: center;
    }
    .category-item.active {
      background: var(--primary);
      color: var(--text-inverse);
      font-weight: 600;
      box-shadow: var(--shadow-md);
    }
    .category-item:hover:not(.active) {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }
    .category-item:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }
    .filter-block {
      margin-top: var(--space-xl);
      margin-bottom: var(--space-xl);
    }
    .filter-block label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-sm);
    }
    .search-input {
      width: 100%;
      padding: var(--space-md) var(--space-lg);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-medium);
      background: var(--bg-secondary);
      color: var(--text-primary);
      font-size: 15px;
      transition: all var(--transition-base);
      min-height: var(--touch-target);
    }
    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: var(--focus-ring);
      background: var(--surface);
    }
    .search-input::placeholder {
      color: var(--text-muted);
    }
    .ad-block {
      margin-top: var(--space-xl);
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      background: linear-gradient(135deg, rgba(14,165,164,0.08), rgba(251,146,60,0.06));
      border: 1px solid rgba(14,165,164,0.15);
      color: var(--text-primary);
      font-size: 14px;
      box-shadow: var(--shadow-sm);
    }
    .ad-title {
      font-size: 11px;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: var(--space-xs);
    }
    .ad-content {
      margin-top: var(--space-xs);
      font-size: 14px;
      line-height: 1.5;
      color: var(--text-secondary);
    }
    .products-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: var(--space-lg);
      margin-top: var(--space-lg);
    }

    /* Hero banner / promo above products */
    .hero-ad {
      border-radius: var(--radius-lg);
      padding: var(--space-lg) var(--space-xl);
      background: linear-gradient(135deg, rgba(14,165,164,0.08), rgba(251,146,60,0.06));
      border: 1px solid rgba(14,165,164,0.15);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-lg);
      margin-bottom: var(--space-xl);
      box-shadow: var(--shadow-sm);
    }
    .hero-ad .cta { 
      background: var(--primary); 
      color: var(--text-inverse); 
      padding: var(--space-md) var(--space-xl); 
      border-radius: var(--radius-full); 
      font-weight: 600;
      font-size: 14px;
      min-height: var(--touch-target);
      border: none;
      cursor: pointer;
      transition: all var(--transition-base);
      white-space: nowrap;
    }
    .hero-ad .cta:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }

    /* Carousel styles - horizontal scrolling layout */
    .hero-carousel { 
      margin-bottom: var(--space-xl); 
      position: relative; 
      overflow: hidden;
    }
    .hero-carousel .carousel-slides { 
      display: flex; 
      flex-direction: row;
      gap: var(--space-lg); 
      overflow-x: auto;
      overflow-y: hidden;
      scroll-behavior: smooth;
      scrollbar-width: thin;
      scrollbar-color: var(--border-medium) var(--bg-secondary);
      padding-bottom: var(--space-sm);
      -webkit-overflow-scrolling: touch;
    }
    .hero-carousel .carousel-slides::-webkit-scrollbar {
      height: 8px;
    }
    .hero-carousel .carousel-slides::-webkit-scrollbar-track {
      background: var(--bg-secondary);
      border-radius: var(--radius-full);
    }
    .hero-carousel .carousel-slides::-webkit-scrollbar-thumb {
      background: var(--border-medium);
      border-radius: var(--radius-full);
    }
    .hero-carousel .carousel-slides::-webkit-scrollbar-thumb:hover {
      background: var(--border-strong);
    }
    .hero-carousel .carousel-slide { 
      display: flex; 
      flex-direction: column;
      gap: var(--space-md); 
      align-items: flex-start; 
      padding: var(--space-xl); 
      border-radius: var(--radius-lg); 
      background: var(--surface);
      border: 1px solid var(--border-light); 
      box-shadow: var(--shadow-lg); 
      opacity: 1; 
      transform: translateY(0); 
      transition: all var(--transition-base);
      flex: 0 0 auto;
      min-width: 300px;
      max-width: 380px;
      width: 100%;
    }
    @media (min-width: 1200px) {
      .hero-carousel .carousel-slide {
        min-width: 350px;
        max-width: 420px;
      }
    }
    .hero-carousel .carousel-slide:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-xl);
      border-color: var(--border-medium);
    }
    .hero-carousel .carousel-slide.active { 
      opacity: 1; 
      transform: translateY(0); 
    }
    .hero-carousel .slide-media { 
      width: 100%; 
      min-height: 180px; 
      border-radius: var(--radius-md); 
      overflow: hidden;
      box-shadow: var(--shadow-md);
    }
    .hero-carousel .slide-media img{ 
      width: 100%; 
      height: 100%; 
      object-fit: cover; 
      display: block; 
    }
    .hero-carousel .slide-body { 
      padding: 0; 
      display: flex; 
      flex-direction: column; 
      gap: var(--space-md); 
      flex: 1;
      width: 100%;
    }
    .hero-carousel .slide-title{ 
      font-size: 24px; 
      font-weight: 700; 
      color: var(--text-primary);
      letter-spacing: -0.02em;
      line-height: 1.2;
    }
    .hero-carousel .slide-sub{ 
      color: var(--text-secondary); 
      font-size: 15px;
      line-height: 1.5;
    }
    .hero-carousel .slide-cta .cta{ 
      border: none; 
      cursor: pointer; 
      border-radius: var(--radius-full); 
      padding: var(--space-md) var(--space-xl); 
      background: var(--primary); 
      color: var(--text-inverse); 
      font-weight: 600;
      font-size: 14px;
      min-height: var(--touch-target);
      transition: all var(--transition-base);
      align-self: flex-start;
    }
    .hero-carousel .slide-cta .cta:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-md);
    }
    .hero-carousel .carousel-controls{ 
      display: none; 
    }
    .hero-carousel .carousel-indicators{ 
      display: none; 
    }

    /* Mobile bottom bar for quick actions */
    #mobile-bar{ 
      display: none; 
    }
    @media (max-width: 800px){
      .layout {
        grid-template-columns: 1fr;
        gap: var(--space-lg);
        padding: var(--space-lg);
      }
      
      aside {
        position: static;
        border: 1px solid var(--border-light);
        border-radius: var(--radius-lg);
      }
      
      .hero-carousel .carousel-slide{ 
        flex-direction: column; 
        padding: var(--space-lg);
        min-width: 280px;
        max-width: 320px;
      }
      .hero-carousel .slide-media{ 
        width: 100%; 
        height: 180px; 
      }
      .hero-carousel .slide-body{ 
        align-items: flex-start; 
      }
      .hero-carousel .slide-title {
        font-size: 18px;
      }
      
      #mobile-bar{ 
        display: flex; 
        position: fixed; 
        left: var(--space-md); 
        right: var(--space-md); 
        bottom: var(--space-md); 
        gap: var(--space-md); 
        z-index: 9998;
        padding: var(--space-md);
        background: var(--surface);
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-xl);
        border: 1px solid var(--border-light);
      }
      #mobile-bar .bar-btn{ 
        flex: 1; 
        padding: var(--space-md) var(--space-lg); 
        border-radius: var(--radius-full); 
        border: none; 
        font-weight: 600; 
        font-size: 15px;
        cursor: pointer;
        min-height: var(--touch-target-lg);
        transition: all var(--transition-base);
      }
      #mobile-bar .bar-cart{ 
        background: var(--accent); 
        color: var(--text-inverse);
        box-shadow: var(--shadow-md);
      }
      #mobile-bar .bar-cart:hover {
        background: var(--accent-dark);
        transform: translateY(-1px);
        box-shadow: var(--shadow-lg);
      }
      #mobile-bar .bar-shop{ 
        background: var(--bg-tertiary); 
        color: var(--text-primary);
        border: 1px solid var(--border-light);
      }
      #mobile-bar .bar-shop:hover {
        background: var(--bg-secondary);
        border-color: var(--border-medium);
      }
      
      /* make buttons larger for touch */
      .btn, .nav-btn, .nav-toggle{ 
        padding: var(--space-md) var(--space-lg); 
        min-height: var(--touch-target-lg);
      }
      
      .products-grid {
        grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        gap: var(--space-md);
      }
      
      .card {
        padding: var(--space-md);
      }
      
      h2 {
        font-size: 24px;
      }
    }

    @media (max-width: 480px){
      html {
        font-size: 15px;
      }
      
      header {
        padding: var(--space-md);
      }
      
      .layout {
        padding: var(--space-md);
      }
      
      .hero-carousel .carousel-slide {
        min-width: 260px;
        max-width: 300px;
      }
      .hero-carousel .slide-media{ 
        height: 160px; 
      }
      .hero-carousel .slide-title{ 
        font-size: 16px; 
      }
      
      .products-grid{ 
        grid-template-columns: 1fr; 
      }
      
      .map-shell{ 
        height: 240px; 
      }
      
      .two-col{ 
        grid-template-columns: 1fr; 
      }
      
      .brand-title {
        font-size: 18px;
      }
    }
    .card {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      border: 1px solid var(--border-light);
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
      box-shadow: var(--shadow-sm);
      transition: all var(--transition-base);
      height: 100%;
    }
    .card:hover{ 
      transform: translateY(-4px); 
      box-shadow: var(--shadow-lg);
      border-color: var(--border-medium);
    }
    .card-media{ 
      height: 200px; 
      border-radius: var(--radius-md); 
      background: var(--bg-tertiary); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      color: var(--text-muted); 
      font-weight: 600; 
      font-size: 14px;
      overflow: hidden;
    }
    .card{ 
      opacity: 0; 
      transform: translateY(8px); 
      animation: fadeUp .4s ease forwards; 
    }
    @keyframes fadeUp{ 
      from{ opacity: 0; transform: translateY(8px); } 
      to{ opacity: 1; transform: translateY(0); } 
    }
    .card-media img{ 
      width: 100%; 
      height: 100%; 
      object-fit: cover; 
      border-radius: var(--radius-md); 
      display: block; 
    }
    /* skeleton shimmer for image loading */
    .skeleton{ 
      position: relative; 
      overflow: hidden; 
      background: linear-gradient(90deg, var(--bg-tertiary), var(--bg-secondary), var(--bg-tertiary));
      background-size: 200% 100%;
      animation: shimmer 1.5s ease-in-out infinite;
    }
    @keyframes shimmer{ 
      0%{ background-position: 200% 0; } 
      100%{ background-position: -200% 0; } 
    }
    .img-loaded{ 
      transition: opacity .3s ease; 
      opacity: 1; 
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--space-md);
    }
    .card-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
      line-height: 1.3;
      flex: 1;
    }
    .tag {
      font-size: 11px;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-full);
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-weight: 600;
      white-space: nowrap;
    }
    .card-desc {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
      min-height: 40px;
    }
    .card-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: auto;
      padding-top: var(--space-sm);
      gap: var(--space-md);
    }
    .price {
      font-size: 20px;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.01em;
    }
    .btn {
      border: none;
      cursor: pointer;
      padding: var(--space-md) var(--space-lg);
      border-radius: var(--radius-full);
      font-size: 14px;
      font-weight: 600;
      min-height: var(--touch-target);
      transition: all var(--transition-base);
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    .btn-primary {
      background: var(--primary);
      color: var(--text-inverse);
      font-weight: 600;
      box-shadow: var(--shadow-md);
    }
    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-1px);
      box-shadow: var(--shadow-lg);
    }
    .btn-primary:active {
      transform: translateY(0);
    }
    .btn-outline {
      background: transparent;
      color: var(--text-secondary);
      border: 1px solid var(--border-medium);
    }
    .btn-outline:hover {
      background: var(--bg-tertiary);
      border-color: var(--border-strong);
      color: var(--text-primary);
    }
    .btn-outline:active {
      transform: translateY(0);
    }
    .btn:focus-visible, .nav-btn:focus-visible, .nav-toggle:focus-visible { 
      outline: none; 
      box-shadow: var(--focus-ring); 
    }

    /* Toast notification */
    .toast {
      position: fixed;
      right: var(--space-lg);
      bottom: var(--space-lg);
      min-width: 280px;
      max-width: 400px;
      background: var(--surface);
      border: 1px solid var(--border-light);
      color: var(--text-primary);
      padding: var(--space-lg);
      border-radius: var(--radius-lg);
      display: flex;
      gap: var(--space-md);
      align-items: center;
      box-shadow: var(--shadow-xl);
      transform: translateY(20px) scale(0.95);
      opacity: 0;
      transition: transform 300ms cubic-bezier(.2,.9,.2,1), opacity 300ms ease;
      z-index: 9999;
    }
    .toast.show { 
      transform: translateY(0) scale(1); 
      opacity: 1; 
    }
    .toast .toast-actions { 
      margin-left: auto; 
      display: flex; 
      gap: var(--space-sm); 
    }
    .toast .toast-actions .btn { 
      padding: var(--space-sm) var(--space-md); 
      font-size: 13px; 
      min-height: 36px;
    }
    .pill {
      border-radius: var(--radius-full);
      padding: var(--space-xs) var(--space-sm);
      font-size: 12px;
      border: 1px solid var(--border-medium);
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-weight: 500;
    }
    .stack {
      display: flex;
      flex-direction: column;
      gap: var(--space-lg);
    }
    .row {
      display: flex;
      gap: var(--space-md);
      flex-wrap: wrap;
      align-items: center;
    }
    label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-xs);
      display: block;
    }
    input, select, textarea {
      font-family: inherit;
      font-size: 15px;
      padding: var(--space-md) var(--space-lg);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-medium);
      background: var(--bg-secondary);
      color: var(--text-primary);
      width: 100%;
      min-height: var(--touch-target);
      transition: all var(--transition-base);
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: var(--focus-ring);
      background: var(--surface);
    }
    input::placeholder, textarea::placeholder {
      color: var(--text-muted);
    }
    textarea {
      resize: vertical;
      min-height: 100px;
      line-height: 1.5;
    }
    input[type="checkbox"] {
      min-height: auto;
      width: auto;
      margin-right: var(--space-sm);
      cursor: pointer;
    }
    .two-col {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: var(--space-xl);
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    .table th, .table td {
      border-bottom: 1px solid var(--border-light);
      padding: var(--space-md);
      text-align: left;
    }
    .table th {
      font-weight: 600;
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }
    .table td {
      color: var(--text-secondary);
    }
    .table tr:hover td {
      background: var(--bg-secondary);
    }
    .badge {
      display: inline-block;
      font-size: 12px;
      padding: var(--space-xs) var(--space-sm);
      border-radius: var(--radius-full);
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-weight: 500;
    }
    .map-shell {
      background: var(--surface);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
      padding: var(--space-lg);
      font-size: 14px;
      color: var(--text-secondary);
      height: 280px;
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
      box-shadow: var(--shadow-sm);
    }
    .map-placeholder {
      flex: 1;
      border-radius: var(--radius-md);
      border: 2px dashed var(--border-medium);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: var(--text-muted);
      background: var(--bg-tertiary);
    }
    .notice {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.6;
    }
    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
      font-size: 14px;
    }
    .chip {
      padding: var(--space-sm) var(--space-lg);
      border-radius: var(--radius-full);
      border: 1px solid var(--border-medium);
      cursor: pointer;
      background: var(--bg-secondary);
      color: var(--text-secondary);
      font-weight: 500;
      transition: all var(--transition-base);
      min-height: var(--touch-target);
      display: inline-flex;
      align-items: center;
    }
    .chip:hover {
      border-color: var(--border-strong);
      background: var(--bg-tertiary);
    }
    .chip.active {
      background: var(--primary);
      border-color: var(--primary);
      color: var(--text-inverse);
      box-shadow: var(--shadow-sm);
    }
    .chip:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }
    .text-muted {
      color: var(--text-muted);
      font-size: 14px;
      line-height: 1.6;
    }
    @media (max-width: 800px) {
      .nav-toggle{ 
        display: inline-flex; 
      }
      nav{ 
        position: absolute; 
        right: var(--space-md); 
        top: calc(100% + var(--space-sm)); 
        display: none; 
        flex-direction: column; 
        background: var(--surface); 
        padding: var(--space-md); 
        border-radius: var(--radius-lg); 
        border: 1px solid var(--border-light);
        box-shadow: var(--shadow-xl);
        min-width: 200px;
        gap: var(--space-xs);
      }
      nav.open{ 
        display: flex; 
        animation: navFade .2s ease; 
      }
      @keyframes navFade{ 
        from{ opacity: 0; transform: translateY(-8px); } 
        to{ opacity: 1; transform: translateY(0); } 
      }
      header{ 
        padding-right: calc(var(--space-lg) + var(--touch-target) + var(--space-sm)); 
      }
      .cart-indicator {
        display: none;
      }
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#main-content">Skip to main content</a>
  <header>
    <button class="nav-toggle" aria-controls="site-nav" aria-expanded="false" aria-label="Toggle menu">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <rect x="3" y="6" width="18" height="2" rx="1" fill="currentColor" />
        <rect x="3" y="11" width="18" height="2" rx="1" fill="currentColor" />
        <rect x="3" y="16" width="12" height="2" rx="1" fill="currentColor" />
      </svg>
    </button>
    <div class="brand">
      <img class="brand-logo" src="assets/zipmetro-logo.png" alt="ZipMetro logo" />
      <div>
        <span class="brand-title">ZipMetro</span>
        <span class="brand-sub">Same-day delivery · Age-verified</span>
      </div>
    </div>
    <nav id="site-nav" role="navigation" aria-label="Primary navigation">
      <button class="nav-btn active" data-section="shop-section">Shop</button>
      <button class="nav-btn" data-section="cart-section">Cart</button>
      <button class="nav-btn" data-section="account-section">Account & ID</button>
      <button class="nav-btn" data-section="admin-section">Admin</button>
    </nav>
    <div class="cart-indicator">
      Cart: <span id="cart-count">0</span> items
    </div>
  </header>

  <div class="layout">
    <aside>
      <h3>Categories</h3>
      <ul class="category-list" id="category-list">
        <li class="category-item active" data-category="Flower">Flower</li>
        <li class="category-item" data-category="Vape">Vape</li>
        <li class="category-item" data-category="Extracts">Extracts</li>
        <li class="category-item" data-category="Edibles">Edibles</li>
      </ul>

      <div class="filter-block">
        <div style="margin-bottom: 6px;">Search products</div>
        <input id="search-input" class="search-input" placeholder="Type to filter…" />
      </div>

      <div class="ad-block" id="ad-block">
        <div class="ad-title">Featured Deal</div>
        <div class="ad-content" id="ad-content">
          25% off first order · Free delivery over $100.
        </div>
      </div>
    </aside>

    <main id="main-content">
      <!-- SHOP SECTION -->
      <section id="shop-section" class="section active">
        <h2>Shop ZipMetro</h2>
        <p class="text-muted" style="margin-bottom: var(--space-xl); font-size: 16px; line-height: 1.6;">Browse by category, add to cart, and check out when you're ready. Mapping, ID, and notifications are handled at checkout.</p>
        <div class="products-grid" id="products-grid"></div>
      </section>

      <!-- CART SECTION -->
      <section id="cart-section" class="section">
        <h2>Checkout & Delivery</h2>
        <div class="two-col">
          <div class="stack">
            <div class="card">
              <h3>Cart</h3>
              <div id="cart-items"></div>
              <div class="row" style="justify-content: space-between; margin-top: 10px;">
                <span>Total: <strong id="cart-total">$0.00</strong></span>
                <button class="btn btn-outline" id="clear-cart-btn">Clear cart</button>
              </div>
            </div>

            <div class="card">
              <h3>Delivery Details</h3>
              <div class="stack">
                <div class="row">
                  <div style="flex:1;">
                    <label>Full name</label>
                    <input id="checkout-name" placeholder="Customer name" />
                  </div>
                  <div style="flex:1;">
                    <label>Phone</label>
                    <input id="checkout-phone" placeholder="(555) 555-5555" />
                  </div>
                </div>
                <div>
                  <label>Delivery address</label>
                  <input id="checkout-address" placeholder="Street, city, ZIP" />
                </div>
                <div class="row">
                  <div style="flex:1;">
                    <label>Preferred delivery window</label>
                    <select id="checkout-window">
                      <option value="ASAP">ASAP (60–90 min)</option>
                      <option value="Today PM">Today PM</option>
                      <option value="Tonight">Tonight</option>
                    </select>
                  </div>
                  <div style="flex:1;">
                    <label>Order notes (optional)</label>
                    <input id="checkout-notes" placeholder="Gate code, buzzer, etc." />
                  </div>
                </div>
                <div>
                  <label>
                    <input type="checkbox" id="checkout-age-confirm" />
                    I confirm I am 21+ and will present valid ID on delivery.
                  </label>
                </div>
                <button class="btn btn-primary" id="place-order-btn">Place order</button>
                <div class="notice">
                  This is a demo front-end only. Real payments, age verification, and compliance logic would be wired to your backend/API.
                </div>
                <div id="order-status" class="text-muted"></div>
              </div>
            </div>
          </div>

          <div class="map-shell">
            <div class="row" style="justify-content: space-between;">
              <span>Delivery mapping</span>
              <span class="badge">Stubbed · Ready for API</span>
            </div>
            <div class="map-placeholder">
              Map placeholder – plug in Google Maps, Mapbox, or other provider here
              using address + driver location.
            </div>
            <div class="notice">
              In production you’d show:
              <ul style="margin: 4px 0 0 16px; padding: 0;">
                <li>Customer address marker</li>
                <li>Driver real-time location</li>
                <li>ETA updates pushed via notifications</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      <!-- ACCOUNT & ID SECTION -->
      <section id="account-section" class="section">
        <h2>Account, ID Upload & Notifications</h2>
        <div class="two-col">
          <div class="card">
            <h3>Upload ID (one-time)</h3>
            <div class="stack">
              <div class="row">
                <div style="flex:1;">
                  <label>First name</label>
                  <input id="id-first-name" />
                </div>
                <div style="flex:1;">
                  <label>Last name</label>
                  <input id="id-last-name" />
                </div>
              </div>
              <div class="row">
                <div style="flex:1;">
                  <label>Date of birth</label>
                  <input id="id-dob" type="date" />
                </div>
                <div style="flex:1;">
                  <label>ID type</label>
                  <select id="id-type">
                    <option value="Drivers license">Driver’s license</option>
                    <option value="State ID">State ID</option>
                    <option value="Passport">Passport</option>
                  </select>
                </div>
              </div>
              <div>
                <label>Upload ID image (front)</label>
                <input id="id-file" type="file" accept="image/*" />
              </div>
              <div>
                <label>
                  <input type="checkbox" id="id-consent" />
                  I consent to ZipMetro storing my ID for age verification in compliance with local laws.
                </label>
              </div>
              <button class="btn btn-primary" id="submit-id-btn">Submit ID</button>
              <div id="id-status" class="text-muted"></div>
              <div class="notice">
                In a real app this would hit a secure backend + KYC/ID verification service,
                with proper encryption and retention rules.
              </div>
            </div>
          </div>

          <div class="card">
            <h3>Notification preferences</h3>
            <div class="stack">
              <div class="chip-row" id="notif-chips">
                <div class="chip active" data-channel="sms">SMS</div>
                <div class="chip active" data-channel="email">Email</div>
                <div class="chip" data-channel="push">Push (app)</div>
              </div>
              <div class="notice">
                These preferences will be used for:
                <ul style="margin: 4px 0 0 16px; padding: 0;">
                  <li>Order status: received, out for delivery, delivered</li>
                  <li>Critical updates: driver delays, address issues</li>
                  <li>Optional promos (if enabled in admin)</li>
                </ul>
              </div>
              <button class="btn btn-outline" id="save-notif-btn">Save preferences</button>
              <div id="notif-status" class="text-muted"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- ADMIN SECTION -->
      <section id="admin-section" class="section">
        <h2>Admin · ZipMetro Control</h2>
        <p class="text-muted" style="margin-bottom: var(--space-xl); font-size: 16px; line-height: 1.6;">This is a front-end-only admin stub. In production this would be behind auth and wired to your backend.</p>

        <div class="stack">
          <div class="two-col">
            <div class="card">
              <h3>High-level metrics (mock)</h3>
              <table class="table">
                <thead>
                  <tr>
                    <th>Metric</th>
                    <th>Today</th>
                    <th>7-day</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Orders</td>
                    <td>18</td>
                    <td>122</td>
                  </tr>
                  <tr>
                    <td>GMV</td>
                    <td>$2,340</td>
                    <td>$14,920</td>
                  </tr>
                  <tr>
                    <td>Avg basket</td>
                    <td>$130</td>
                    <td>$122</td>
                  </tr>
                  <tr>
                    <td>Repeat customers</td>
                    <td>62%</td>
                    <td>58%</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div class="card">
              <h3>Advertising slot (homepage banner)</h3>
              <div class="stack">
                <label for="admin-ad-text">Banner copy</label>
                <textarea id="admin-ad-text" placeholder="e.g. Mix & Match quarters · Any 4 for $99."></textarea>
                <button class="btn btn-primary" id="save-ad-btn">Save ad</button>
                <div class="notice">
                  This feeds the “Featured Deal” unit in the left sidebar on all customer views.
                </div>
                <div id="admin-ad-status" class="text-muted"></div>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>Product catalog (demo)</h3>
            <div style="margin-bottom:10px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
              <input id="admin-new-name" placeholder="Name" style="min-width:160px;" />
              <select id="admin-new-category">
                <option value="Flower">Flower</option>
                <option value="Vape">Vape</option>
                <option value="Extracts">Extracts</option>
                <option value="Edibles">Edibles</option>
              </select>
              <input id="admin-new-price" placeholder="Price" type="number" style="width:100px;" />
              <input id="admin-new-thc" placeholder="THC mg" type="number" style="width:100px;" />
              <input id="admin-new-image" placeholder="Image URL (optional)" style="min-width:200px;" />
              <button class="btn btn-primary" id="add-product-btn">Add product</button>
            </div>
            <table class="table" id="admin-products-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Category</th>
                  <th>THC mg</th>
                  <th>Price</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <!-- Populated from JS -->
              </tbody>
            </table>
            <div class="notice">
              In production this table would be editable with create/update/delete actions,
              plus inventory counts and store/brand associations.
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="toast" class="toast" aria-live="polite" hidden></div>
  <div id="mobile-bar" aria-hidden="false">
    <button class="bar-btn bar-shop" onclick="switchSection('shop-section')">Shop</button>
    <button class="bar-btn bar-cart" onclick="switchSection('cart-section')">Cart (<span id="mobile-cart-count">0</span>)</button>
  </div>

  <script>
    // Mobile nav toggle
    (function(){
      const navToggle = document.querySelector('.nav-toggle');
      const nav = document.getElementById('site-nav');
      if(navToggle && nav){
        navToggle.addEventListener('click', ()=>{
          const open = nav.classList.toggle('open');
          navToggle.setAttribute('aria-expanded', open ? 'true' : 'false');
        });
        // close nav after selecting
        nav.querySelectorAll('.nav-btn').forEach(b=> b.addEventListener('click', ()=>{
          nav.classList.remove('open');
          navToggle.setAttribute('aria-expanded','false');
        }));
        // close nav if focus leaves (small helper)
        document.addEventListener('click', (e)=>{
          if(!nav.contains(e.target) && !navToggle.contains(e.target)){
            nav.classList.remove('open'); navToggle.setAttribute('aria-expanded','false');
          }
        });
      }
    })();

    // Toast micro-interaction: shows a small dismissible notification
    function showToast(message, actionLabel, actionCallback, timeout = 4500){
      const el = document.getElementById('toast');
      if(!el) return;
      el.hidden = false;
      el.innerHTML = `
        <div class="toast-body" style="font-size:13px; line-height:1.2;">${message}</div>
        <div class="toast-actions">
          <button id="toast-close" class="btn btn-outline">Close</button>
          <button id="toast-action" class="btn btn-primary">${actionLabel || 'OK'}</button>
        </div>
      `;
      // animate in
      requestAnimationFrame(()=> el.classList.add('show'));

      function cleanup(){
        el.classList.remove('show');
        setTimeout(()=>{ el.hidden = true; el.innerHTML = ''; }, 260);
      }

      document.getElementById('toast-close').addEventListener('click', cleanup, { once: true });
      document.getElementById('toast-action').addEventListener('click', ()=>{ try{ actionCallback && actionCallback(); } catch(e){} cleanup(); }, { once: true });
      // auto-dismiss
      setTimeout(()=>{ cleanup(); }, timeout);
    }
    // products are loaded from the backend API (products.json) on startup
    let products = [];

    // fallback dataset so the app still shows example products if no backend server is running
    const fallbackProducts = [
      { id: 1, name: "Sunset Sherbet", category: "Flower", desc: "Hybrid · Smooth, creamy, evening friendly.", price: 45, thc: 25, image: "https://picsum.photos/seed/sunset-sherbet/800/440" },
      { id: 2, name: "ZipMetro House OG", category: "Flower", desc: "Indica-leaning classic with heavy body feel.", price: 40, thc: 27, image: "https://picsum.photos/seed/house-og/800/440" },
      { id: 9, name: "Lemon Gaze", category: "Flower", desc: "Citrus sativa-leaning · bright and clear.", price: 38, thc: 22, image: "https://picsum.photos/seed/lemon-gaze/800/440" },
      { id: 10, name: "Royal Kush", category: "Flower", desc: "Relaxing indica · couch-lock friendly.", price: 50, thc: 29, image: "https://picsum.photos/seed/royal-kush/800/440" },
      { id: 11, name: "Blue Velvet", category: "Flower", desc: "Balanced Hybrid · smooth flavor.", price: 42, thc: 24, image: "https://picsum.photos/seed/blue-velvet/800/440" },
      { id: 12, name: "Cali Dream", category: "Flower", desc: "Tropical terp profile · daytime use.", price: 44, thc: 26, image: "https://picsum.photos/seed/cali-dream/800/440" },

      { id: 3, name: "Electric Haze Vape 1g", category: "Vape", desc: "Sativa cart · citrus & pine, day-time vibes.", price: 35, thc: 90, image: "https://picsum.photos/seed/electric-haze/800/440" },
      { id: 4, name: "Night Drive Live Resin Cart", category: "Vape", desc: "Full-spectrum live resin · terp heavy.", price: 48, thc: 88, image: "https://picsum.photos/seed/night-drive/800/440" },
      { id: 13, name: "Citrus Rush Cart", category: "Vape", desc: "Energetic sativa-forward cartridge.", price: 36, thc: 92, image: "https://picsum.photos/seed/citrus-rush/800/440" },
      { id: 14, name: "Moonlight OG Cart", category: "Vape", desc: "Smooth indica cart for evenings.", price: 40, thc: 85, image: "https://picsum.photos/seed/moonlight-og/800/440" },
      { id: 15, name: "Sparkle Hybrid 0.5g", category: "Vape", desc: "Compact pen · hybrid effects.", price: 28, thc: 75, image: "https://picsum.photos/seed/sparkle-hybrid/800/440" },
      { id: 16, name: "High Noon 1g", category: "Vape", desc: "Daytime clarity · citrus notes.", price: 34, thc: 88, image: "https://picsum.photos/seed/high-noon/800/440" },

      { id: 5, name: "Guava Punch Live Rosin", category: "Extracts", desc: "Cold-cured rosin · fruit forward and loud.", price: 65, thc: 76, image: "https://picsum.photos/seed/guava-punch/800/440" },
      { id: 6, name: "Diamond Sauce – Metro Fuel", category: "Extracts", desc: "High potency diamonds in terp sauce.", price: 70, thc: 82, image: "https://picsum.photos/seed/diamond-sauce/800/440" },
      { id: 17, name: "Crystal Shatter", category: "Extracts", desc: "High-clarity shatter for potency seekers.", price: 68, thc: 85, image: "https://picsum.photos/seed/crystal-shatter/800/440" },
      { id: 18, name: "Rosin Live Stack", category: "Extracts", desc: "Solventless rosin · full flavor.", price: 72, thc: 80, image: "https://picsum.photos/seed/rosin-live/800/440" },
      { id: 19, name: "Terp Sauce Reserve", category: "Extracts", desc: "Flavor-forward sauce with rich terps.", price: 75, thc: 78, image: "https://picsum.photos/seed/terp-sauce/800/440" },
      { id: 20, name: "Ultra Diamonds", category: "Extracts", desc: "Top-shelf diamonds for advanced users.", price: 88, thc: 92, image: "https://picsum.photos/seed/ultra-diamonds/800/440" },

      { id: 7, name: "Metro Mango Gummies 100mg", category: "Edibles", desc: "10 x 10mg pieces · mellow mango flavor.", price: 18, thc: 100, image: "https://picsum.photos/seed/mango-gummies/800/440" },
      { id: 8, name: "NightCap Chocolates 200mg", category: "Edibles", desc: "8 x 25mg · rich dark chocolate squares.", price: 24, thc: 200, image: "https://picsum.photos/seed/nightcap-choco/800/440" },
      { id: 21, name: "Citrus Chews 50mg", category: "Edibles", desc: "6 x 8.33mg chews · bright citrus.", price: 14, thc: 50, image: "https://picsum.photos/seed/citrus-chews/800/440" },
      { id: 22, name: "Maple Bars 120mg", category: "Edibles", desc: "6 x 20mg bars · maple richness.", price: 22, thc: 120, image: "https://picsum.photos/seed/maple-bars/800/440" },
      { id: 23, name: "Berry Blast Gummies 150mg", category: "Edibles", desc: "15 x 10mg · tangy berry mix.", price: 26, thc: 150, image: "https://picsum.photos/seed/berry-blast/800/440" },
      { id: 24, name: "Espresso Bites 80mg", category: "Edibles", desc: "8 x 10mg · coffee-forward treats.", price: 19, thc: 80, image: "https://picsum.photos/seed/espresso-bites/800/440" }
    ];

    async function loadProductsFromApi(){
      try{
        const res = await fetch('/api/products');
        if(!res.ok) throw new Error('Failed loading products');
        products = await res.json();
      }catch(e){
        console.warn('Could not load products from API, falling back to client dataset.', e);
        products = fallbackProducts.slice();
      }
      renderProducts();
      renderAdminProducts();
      updateCartIndicator();
    }

    let cart = [];
    let currentCategory = "Flower";
    let notifPrefs = { sms: true, email: true, push: false };

    // --- Helpers -----------------------------------------------------------
    function formatMoney(v) {
      return "$" + v.toFixed(2);
    }

    function updateCartIndicator() {
      const count = cart.reduce((sum, item) => sum + item.qty, 0);
      document.getElementById("cart-count").textContent = count;
      const mobile = document.getElementById('mobile-cart-count');
      if(mobile) mobile.textContent = count;
    }

    function renderProducts() {
      const grid = document.getElementById("products-grid");
      const query = document.getElementById("search-input").value.toLowerCase().trim();

      const filtered = products.filter(p =>
        p.category === currentCategory &&
        (!query || p.name.toLowerCase().includes(query) || p.desc.toLowerCase().includes(query))
      );

      grid.innerHTML = "";
      if (!filtered.length) {
        grid.innerHTML = "<div class='text-muted'>No products match that search in this category.</div>";
        return;
      }

      // Insert responsive carousel hero above the products grid
      const existingHero = document.querySelector('.hero-carousel');
      if(!existingHero){
        const carousel = document.createElement('div');
        carousel.className = 'hero-carousel';
        carousel.setAttribute('role', 'region');
        carousel.setAttribute('aria-label', 'Promotions');
        carousel.innerHTML = `
          <div class="carousel-slides" aria-live="polite"></div>
        `;
        grid.parentNode.insertBefore(carousel, grid);

        // sample slides (image, title, subtitle, cta)
        const slides = [
          { img: 'https://picsum.photos/seed/promo1/1200/420', title: 'Weekend Special', subtitle: '20% off selected strains · Code WEEKEND', cta: 'Shop deals' },
          { img: 'https://picsum.photos/seed/promo2/1200/420', title: 'Free Delivery', subtitle: 'Free delivery over $75 this week only', cta: 'Learn more' },
          { img: 'https://picsum.photos/seed/promo3/1200/420', title: 'New Arrivals', subtitle: 'Fresh live rosin and new gummies', cta: 'Browse new' }
        ];

        const slidesEl = carousel.querySelector('.carousel-slides');

        // Create all slides and display them all at once
        slides.forEach((s, i) => {
          const sl = document.createElement('div');
          sl.className = 'carousel-slide active';
          sl.innerHTML = `
            <div class="slide-media skeleton"><img src="${s.img}" alt="${s.title}" loading="lazy"/></div>
            <div class="slide-body">
              <div class="slide-title">${s.title}</div>
              <div class="slide-sub">${s.subtitle}</div>
              <div class="slide-cta"><button class="btn cta">${s.cta}</button></div>
            </div>
          `;
          sl.dataset.index = i;
          slidesEl.appendChild(sl);
        });
      }

      // small helper: create an inline SVG placeholder as data URL (fallback)
      function svgPlaceholder(text, w=600, h=360, id=0){
        const bg1 = ['#0f1724','#04263a','#102030','#0b2330'][id % 4];
        const bg2 = ['#071029','#052037','#081623','#071223'][id % 4];
        const safe = text.replace(/&/g,'%26').replace(/#/g,'%23');
        const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'>`+
          `<defs><linearGradient id='g${id}' x1='0' x2='1'><stop offset='0' stop-color='${bg1}'/><stop offset='1' stop-color='${bg2}'/></linearGradient></defs>`+
          `<rect width='100%' height='100%' fill='url(#g${id})'/>`+
          `<text x='50%' y='52%' dominant-baseline='middle' text-anchor='middle' font-family='Arial, Helvetica, sans-serif' font-size='32' fill='rgba(230,238,248,0.95)'>${safe}</text>`+
        `</svg>`;
        return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
      }

      filtered.forEach(p => {
        const card = document.createElement("div");
        card.className = "card";
        const imgUrl = p.image || svgPlaceholder(p.name.split(' ')[0], 800, 440, p.id);
        card.innerHTML = `
          <div class="card-media skeleton" aria-hidden="true">
            <img src="${imgUrl}" alt="${p.name}" loading="lazy" />
          </div>
          <div class="card-header">
            <div>
              <div class="card-title">${p.name}</div>
              <div class="text-muted" style="font-size:11px;">${p.category}</div>
            </div>
            <span class="tag">${p.thc} mg THC</span>
          </div>
          <div class="card-desc">${p.desc}</div>
          <div class="card-footer">
            <span class="price">${formatMoney(p.price)}</span>
            <button class="btn btn-primary" data-add-id="${p.id}">Add to cart</button>
          </div>
        `;
        // handle image load to remove skeleton and fade in
        grid.appendChild(card);
        const img = card.querySelector('.card-media img');
        if(img){
          img.style.opacity = '0';
          img.addEventListener('load', ()=>{
            const media = card.querySelector('.card-media');
            if(media) media.classList.remove('skeleton');
            img.classList.add('img-loaded');
            img.style.opacity = '1';
          });
        }
      });

      grid.querySelectorAll("[data-add-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = parseInt(btn.getAttribute("data-add-id"), 10);
          const existing = cart.find(i => i.id === id);
          if (existing) existing.qty += 1;
          else cart.push({ id, qty: 1 });
          updateCartIndicator();
          const product = products.find(p => p.id === id);
          showToast(`${product ? product.name : 'Item'} added to cart`, 'View cart', () => switchSection('cart-section'));
        });
      });
    }

    function renderCart() {
      const container = document.getElementById("cart-items");
      const totalEl = document.getElementById("cart-total");
      container.innerHTML = "";

      if (!cart.length) {
        container.innerHTML = "<div class='text-muted'>Your cart is empty.</div>";
        totalEl.textContent = "$0.00";
        return;
      }

      let total = 0;
      cart.forEach(item => {
        const product = products.find(p => p.id === item.id);
        if (!product) return;
        const lineTotal = product.price * item.qty;
        total += lineTotal;

        const row = document.createElement("div");
        row.className = "row";
        row.style.justifyContent = "space-between";
        row.style.marginBottom = "6px";
        row.innerHTML = `
          <div>
            <div style="font-size:13px;">${product.name}</div>
            <div class="text-muted">${item.qty} × ${formatMoney(product.price)}</div>
          </div>
          <div class="row">
            <span style="font-size:13px; margin-right:8px;">${formatMoney(lineTotal)}</span>
            <button class="btn btn-outline" data-minus-id="${product.id}">−</button>
            <button class="btn btn-outline" data-plus-id="${product.id}">+</button>
            <button class="btn btn-outline" data-remove-id="${product.id}">×</button>
          </div>
        `;
        container.appendChild(row);
      });

      totalEl.textContent = formatMoney(total);

      container.querySelectorAll("[data-plus-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = parseInt(btn.getAttribute("data-plus-id"), 10);
          const item = cart.find(i => i.id === id);
          if (item) item.qty += 1;
          renderCart();
          updateCartIndicator();
        });
      });
      container.querySelectorAll("[data-minus-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = parseInt(btn.getAttribute("data-minus-id"), 10);
          const item = cart.find(i => i.id === id);
          if (item && item.qty > 1) item.qty -= 1;
          else cart = cart.filter(i => i.id !== id);
          renderCart();
          updateCartIndicator();
        });
      });
      container.querySelectorAll("[data-remove-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = parseInt(btn.getAttribute("data-remove-id"), 10);
          cart = cart.filter(i => i.id !== id);
          renderCart();
          updateCartIndicator();
        });
      });
    }

    function renderAdminProducts() {
      const tbody = document.querySelector("#admin-products-table tbody");
      tbody.innerHTML = "";
      products.forEach(p => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>${p.thc}</td>
          <td>${formatMoney(p.price)}</td>
          <td><button class="btn btn-outline" data-delete-id="${p.id}">Delete</button></td>
        `;
        tbody.appendChild(tr);
      });

      // wire delete buttons to API
      tbody.querySelectorAll('[data-delete-id]').forEach(btn => {
        btn.addEventListener('click', async ()=>{
          const id = btn.getAttribute('data-delete-id');
          if(!confirm('Delete this product?')) return;
          try{
            const res = await fetch('/api/products/' + encodeURIComponent(id), { method: 'DELETE' });
            if(res.status === 204){
              // reload
              await loadProductsFromApi();
              document.getElementById('admin-ad-status').textContent = 'Product deleted.';
            }else{
              const err = await res.json();
              alert('Delete failed: ' + (err && err.error ? err.error : res.status));
            }
          }catch(e){
            alert('Delete failed: ' + e.message);
          }
        });
      });
    }

    function switchSection(id) {
      document.querySelectorAll("main .section").forEach(sec => {
        sec.classList.toggle("active", sec.id === id);
      });
      document.querySelectorAll(".nav-btn").forEach(btn => {
        btn.classList.toggle("active", btn.getAttribute("data-section") === id);
      });
      if (id === "shop-section") renderProducts();
      if (id === "cart-section") renderCart();
    }

    // --- Event wiring ------------------------------------------------------
    document.querySelectorAll(".nav-btn").forEach(btn => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-section");
        switchSection(id);
      });
    });

    document.getElementById("category-list").addEventListener("click", e => {
      const item = e.target.closest(".category-item");
      if (!item) return;
      currentCategory = item.getAttribute("data-category");
      document.querySelectorAll(".category-item").forEach(c => {
        c.classList.toggle("active", c === item);
      });
      renderProducts();
    });

    document.getElementById("search-input").addEventListener("input", () => {
      renderProducts();
    });

    document.getElementById("clear-cart-btn").addEventListener("click", () => {
      if (!cart.length) return;
      if (confirm("Clear cart?")) {
        cart = [];
        renderCart();
        updateCartIndicator();
      }
    });

    document.getElementById("place-order-btn").addEventListener("click", () => {
      const name = document.getElementById("checkout-name").value.trim();
      const phone = document.getElementById("checkout-phone").value.trim();
      const addr = document.getElementById("checkout-address").value.trim();
      const windowVal = document.getElementById("checkout-window").value;
      const ageOk = document.getElementById("checkout-age-confirm").checked;
      const statusEl = document.getElementById("order-status");

      if (!cart.length) {
        alert("Cart is empty.");
        return;
      }
      if (!name || !phone || !addr) {
        alert("Fill out name, phone, and address.");
        return;
      }
      if (!ageOk) {
        alert("You must confirm age 21+.");
        return;
      }

      const channels = Object.entries(notifPrefs)
        .filter(([, v]) => v)
        .map(([k]) => k.toUpperCase())
        .join(", ") || "NONE";

      statusEl.textContent =
        `Order placed for ${name}. Delivery window: ${windowVal}. Notifications via: ${channels}. (Demo only – no real order created.)`;
    });

    document.getElementById("submit-id-btn").addEventListener("click", () => {
      const first = document.getElementById("id-first-name").value.trim();
      const last = document.getElementById("id-last-name").value.trim();
      const dob = document.getElementById("id-dob").value;
      const file = document.getElementById("id-file").files[0];
      const consent = document.getElementById("id-consent").checked;
      const statusEl = document.getElementById("id-status");

      if (!first || !last || !dob || !file) {
        alert("Fill out all ID fields and choose a file.");
        return;
      }
      if (!consent) {
        alert("You must consent to ID storage.");
        return;
      }
      statusEl.textContent = `ID submitted for ${first} ${last} (demo only, not uploaded anywhere).`;
    });

    document.getElementById("save-ad-btn").addEventListener("click", () => {
      const text = document.getElementById("admin-ad-text").value.trim();
      const adContent = document.getElementById("ad-content");
      const status = document.getElementById("admin-ad-status");
      if (!text) {
        alert("Enter some ad copy.");
        return;
      }
      adContent.textContent = text;
      status.textContent = "Ad updated for customer view.";
    });

    // Admin: Add product
    document.getElementById('add-product-btn').addEventListener('click', async () => {
      const name = document.getElementById('admin-new-name').value.trim();
      const category = document.getElementById('admin-new-category').value;
      const price = Number(document.getElementById('admin-new-price').value || 0);
      const thc = Number(document.getElementById('admin-new-thc').value || 0);
      const image = document.getElementById('admin-new-image').value.trim();
      const status = document.getElementById('admin-ad-status');
      if(!name){ alert('Enter product name'); return; }
      try{
        const res = await fetch('/api/products', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ name, category, price, thc, image }) });
        if(res.status === 201){
          const created = await res.json();
          status.textContent = 'Product added: ' + created.name;
          // clear inputs
          document.getElementById('admin-new-name').value='';
          document.getElementById('admin-new-price').value='';
          document.getElementById('admin-new-thc').value='';
          document.getElementById('admin-new-image').value='';
          await loadProductsFromApi();
        }else{
          const err = await res.json();
          alert('Add failed: ' + (err && err.error ? err.error : res.status));
        }
      }catch(e){ alert('Add failed: ' + e.message); }
    });

    document.getElementById("notif-chips").addEventListener("click", e => {
      const chip = e.target.closest(".chip");
      if (!chip) return;
      const channel = chip.getAttribute("data-channel");
      const newVal = !chip.classList.contains("active");
      notifPrefs[channel] = newVal;
      chip.classList.toggle("active", newVal);
    });

    document.getElementById("save-notif-btn").addEventListener("click", () => {
      const status = document.getElementById("notif-status");
      const enabled = Object.entries(notifPrefs)
        .filter(([, v]) => v)
        .map(([k]) => k.toUpperCase())
        .join(", ") || "NONE";
      status.textContent = "Saved. Channels enabled: " + enabled + ".";
    });

    // --- Initial render ----------------------------------------------------
    // Load products from API (falls back to client-side if API unavailable)
    loadProductsFromApi();
    renderAdminProducts();
    // accessibility: focus main when skip-link used
    document.querySelector('.skip-link').addEventListener('click', (e)=>{
      const m = document.getElementById('main-content');
      if(m){ m.setAttribute('tabindex','-1'); m.focus(); }
    });
  </script>
</body>
</html>
