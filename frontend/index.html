<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ZipMetro Delivery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <!-- Preconnect to Google Fonts for faster DNS/TLS -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <!-- Load fonts with optional display to prevent layout shift -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Bungee&family=Righteous&family=Black+Ops+One&display=optional" rel="stylesheet">
  <!-- ZipMetro logo - vibrant graffiti-style design -->
  <link rel="icon" href="assets/ZipMetroLogoRemoveBG (1).png" />
  <style>
    * { box-sizing: border-box; }
    :root{
      /* Metric-compatible fallback stacks to prevent layout shift */
      --font-family: 'Bungee', 'Righteous', 'Black Ops One', Impact, 'Arial Black', 'Franklin Gothic Bold', 'Helvetica Neue', sans-serif;
      --font-graffiti: 'Bungee', 'Righteous', 'Black Ops One', Impact, 'Arial Black', 'Franklin Gothic Bold', 'Helvetica Neue', sans-serif;
      --font-body: 'Bungee', 'Righteous', 'Black Ops One', Impact, 'Arial Black', 'Franklin Gothic Bold', 'Helvetica Neue', sans-serif;
      --font-input: 'Inter', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      --max-width:1200px;
      
      /* ZipMetro Brand Colors */
      --primary: #B83EBF; /* Primary Purple */
      --primary-dark: #A12EB8; /* Secondary Purple */
      --primary-light: #C85ECF;
      --accent: #D8FF3F; /* Neon Yellow/Green Accent */
      --accent-dark: #C4E638;
      --accent-light: #E5FF66;
      
      /* Background colors */
      --bg-primary: #0F0F0F; /* Dark Background */
      --bg-secondary: #1A1A1A;
      --bg-tertiary: #252525;
      --surface: #1A1A1A;
      --surface-elevated: #252525;
      
      /* Text colors for dark background */
      --text-primary: #F1F1F1; /* Neutral Gray for text */
      --text-secondary: #D0D0D0;
      --text-muted: #A0A0A0;
      --text-inverse: #0F0F0F; /* Dark text for light backgrounds (CTAs) */
      
      --border-light: #333333;
      --border-medium: #404040;
      --border-strong: #555555;
      
      /* Shadows for depth - standardized for cards */
      --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);
      --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.25);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
      
      --radius-sm: 8px;
      --radius-md: 12px;
      --radius-lg: 16px;
      --radius-xl: 20px;
      --radius-full: 9999px;
      
      --focus-ring: 0 0 0 3px rgba(184, 62, 191, 0.4);
      --transition-base: 200ms cubic-bezier(0.4, 0, 0.2, 1);
      --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
      
      /* Spacing scale */
      --space-xs: 0.5rem;
      --space-sm: 0.75rem;
      --space-md: 1rem;
      --space-lg: 1.5rem;
      --space-xl: 2rem;
      --space-2xl: 3rem;
      --space-3xl: 4rem;
      
      /* Touch target sizes (minimum 44x44px for accessibility) */
      --touch-target: 44px;
      --touch-target-lg: 52px;
    }
    html{ 
      -webkit-text-size-adjust:100%; 
      font-size:16px;
      scroll-behavior: smooth;
      overflow-x: hidden; /* Prevent horizontal scroll */
    }
    body {
      margin: 0;
      font-family: var(--font-graffiti);
      background: var(--bg-primary);
      color: var(--text-primary);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height: 1.6;
      overflow-x: hidden; /* Prevent horizontal scroll at root */
      width: 100%;
      max-width: 100vw;
    }
    
    /* AppShell - Global Layout Container */
    .app-shell {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      width: 100%;
      max-width: 100vw;
      overflow-x: hidden;
    }
    .skip-link{
      position: absolute;
      left: -999px;
      top: auto;
      width: 1px;
      height: 1px;
      overflow: hidden;
    }
    .skip-link:focus{
      left: var(--space-md);
      top: var(--space-md);
      width: auto;
      height: auto;
      background: var(--primary);
      color: var(--text-inverse);
      padding: var(--space-sm) var(--space-md);
      border-radius: var(--radius-md);
      z-index: 9999;
      font-weight: 600;
    }
    /* Header - Desktop only (hidden on mobile) */
    header {
      background: #0F0F0F;
      padding: var(--space-md) var(--space-lg);
      display: none; /* Hidden by default (mobile) */
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid var(--border-light);
      position: sticky;
      top: 0;
      z-index: 50;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      height: 72px;
      min-height: 72px;
      width: 100%;
      max-width: 100vw;
      overflow-x: hidden;
    }
    
    @media (min-width: 768px) {
      header {
        display: flex; /* Show on desktop */
      }
    }
    .brand {
      display: flex;
      flex-direction: row;
      align-items: center;
      gap: 0;
      flex-shrink: 0;
      margin: 0;
      padding: 0;
    }
    /* Brand Logo - Vibrant Graffiti Style */
    .brand-logo {
      max-width: 140px;
      width: 140px;
      height: auto;
      aspect-ratio: auto;
      object-fit: contain;
      border-radius: 0;
      display: block;
      display: block;
      margin: 0;
      padding: 0;
      transition: transform var(--transition-base);
    }
    .brand-logo:hover {
      transform: scale(1.02);
    }
    .brand-link {
      display: inline-flex;
      align-items: center;
      text-decoration: none;
      margin: 0;
      padding: 0;
    }
    /* Hide logo container if image fails to load */
    .brand-logo:not([src]),
    .brand-logo[src=""],
    img.brand-logo[src*="undefined"],
    img.brand-logo[src*="null"] {
      display: none;
    }
    /* Hide brand link if logo is missing */
    .brand-link:has(img.brand-logo:not([src])),
    .brand-link:has(img.brand-logo[src=""]) {
      display: none;
    }
    
    /* Show header logo on desktop, hide on mobile */
    @media (max-width: 767px) {
      .brand-logo,
      .brand-link {
        display: none !important;
      }
    }
    
    @media (min-width: 768px) {
      .brand-logo,
      .brand-link {
        display: block !important;
      }
    }
    .brand-title {
      font-family: var(--font-graffiti);
      font-size: 24px;
      font-weight: 400;
      letter-spacing: 0.03em;
      display: block;
      line-height: 1.2;
      color: var(--primary);
      text-transform: uppercase;
    }
    .brand-sub {
      font-size: 12px;
      color: var(--text-muted);
      display: block;
      margin-top: 2px;
      font-weight: 400;
    }
    /* TopNav - Desktop only (>=768px) */
    nav {
      display: none; /* Hidden by default (mobile) */
      gap: var(--space-md);
      align-items: center;
      flex: 1;
      justify-content: center;
      padding: 0 var(--space-lg);
    }
    
    @media (min-width: 768px) {
      nav {
        display: flex; /* Show on desktop */
      }
    }
    /* Standardized Nav Toggle */
    .nav-toggle{
      display: none;
      background: transparent;
      border: 1px solid var(--border-light);
      color: var(--text-primary);
      padding: var(--space-sm);
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      min-height: 44px;
      min-width: 44px;
      transition: all var(--transition-base);
      align-items: center;
      justify-content: center;
      margin: 0;
      flex-shrink: 0;
    }
    .nav-toggle:hover {
      background: rgba(161, 46, 184, 0.1);
      border-color: #A12EB8;
      color: #A12EB8;
    }
    .nav-toggle:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }
    .nav-toggle svg{ display: block; }
    /* Standardized Nav Button */
    .nav-btn {
      border: none;
      background: transparent;
      color: var(--text-secondary);
      padding: var(--space-md) var(--space-lg);
      border-radius: 12px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      min-height: 44px;
      transition: all var(--transition-base);
      white-space: nowrap;
      position: relative;
    }
    .nav-btn.active {
      background: transparent;
      color: #B83EBF;
      font-weight: 600;
    }
    .nav-btn.active::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      height: 3px;
      background: #B83EBF;
      border-radius: var(--radius-full) var(--radius-full) 0 0;
    }
    .nav-btn:hover:not(.active) {
      background: transparent;
      color: #A12EB8;
    }
    .nav-btn:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }
    .header-right {
      display: flex;
      align-items: center;
      gap: var(--space-md);
      flex-shrink: 0;
    }
    
    #user-status {
      display: none;
      align-items: center;
      gap: var(--space-sm);
      font-size: 13px;
      color: var(--text-secondary);
    }
    
    .cart-indicator {
      font-size: 14px;
      color: var(--text-secondary);
      font-weight: 500;
      padding: var(--space-sm) var(--space-md);
      background: transparent;
      border-radius: var(--radius-md);
      flex-shrink: 0;
    }
    /* PageContainer - consistent max-width and padding for all pages */
    .page-container {
      max-width: 1152px; /* max-w-6xl equivalent (1152px) */
      margin: 0 auto;
      padding: 0 var(--space-md); /* px-4 */
      width: 100%;
      box-sizing: border-box;
    }
    
    @media (min-width: 768px) {
      .page-container {
        padding: 0 var(--space-lg); /* md:px-6 */
      }
    }
    
    /* Layout wrapper - removed, using PageContainer directly */
    .layout {
      display: block;
      width: 100%;
      max-width: 100vw;
      overflow-x: hidden;
    }
    
    /* Main content area - AppShell main */
    main#main-content {
      width: 100%;
      max-width: 100vw;
      box-sizing: border-box;
      padding: 0;
      overflow-x: hidden;
      /* Add padding-bottom on mobile to prevent content being covered by bottom nav */
      padding-bottom: 0;
      flex: 1; /* Take remaining space in AppShell */
    }
    
    /* Mobile: Add padding-bottom for fixed bottom nav */
    @media (max-width: 767px) {
      main#main-content {
        padding-bottom: calc(56px + env(safe-area-inset-bottom, 0px)); /* pb-20 equivalent */
      }
    }
    
    /* Desktop: No bottom padding needed */
    @media (min-width: 768px) {
      main#main-content {
        padding-bottom: 0; /* md:pb-0 */
      }
    }
    aside {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      box-shadow: var(--shadow-sm);
      height: fit-content;
      position: sticky;
      top: calc(72px + var(--space-xl));
      align-self: start;
    }
    main {
      padding: 0;
    }
    /* Responsive Typography */
    h1 {
      margin-top: 0;
      margin-bottom: var(--space-lg);
      font-family: var(--font-graffiti);
      font-size: clamp(24px, 5vw, 36px); /* text-2xl md:text-4xl equivalent */
      font-weight: 400;
      color: var(--text-primary);
      letter-spacing: 0.02em;
      line-height: 1.2;
      text-transform: uppercase;
    }
    
    @media (min-width: 768px) {
      h1 {
        font-size: clamp(32px, 4vw, 42px); /* md:text-4xl */
      }
    }
    
    h2 {
      margin-top: 0;
      margin-bottom: var(--space-md);
      font-family: var(--font-graffiti);
      font-size: clamp(20px, 4vw, 28px); /* text-xl md:text-3xl */
      font-weight: 400;
      color: var(--text-primary);
      letter-spacing: 0.02em;
      line-height: 1.3;
      text-transform: uppercase;
    }
    
    @media (min-width: 768px) {
      h2 {
        font-size: clamp(28px, 3.5vw, 32px); /* md:text-3xl */
      }
    }
    
    h3 {
      margin-top: 0;
      margin-bottom: var(--space-md);
      font-family: var(--font-graffiti);
      font-size: clamp(18px, 3vw, 22px); /* text-lg md:text-2xl */
      font-weight: 400;
      color: var(--text-primary);
      letter-spacing: 0.01em;
      line-height: 1.4;
      text-transform: uppercase;
    }
    
    @media (min-width: 768px) {
      h3 {
        font-size: clamp(20px, 2.5vw, 24px); /* md:text-2xl */
      }
    }
    
    h4 {
      margin-top: 0;
      margin-bottom: var(--space-sm);
      font-family: var(--font-graffiti);
      font-size: clamp(16px, 2.5vw, 18px); /* text-base md:text-lg */
      font-weight: 400;
      color: var(--text-primary);
      letter-spacing: 0.01em;
      line-height: 1.5;
      text-transform: uppercase;
    }
    
    @media (min-width: 768px) {
      h4 {
        font-size: 18px; /* md:text-lg */
      }
    }
    .section {
      display: none;
      width: 100%;
      max-width: 100vw;
      box-sizing: border-box;
      overflow-x: hidden; /* Prevent horizontal overflow */
    }
    .section.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    /* Removed duplicate - handled above */
    #shop-section {
      width: 100%;
      box-sizing: border-box;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    .category-list {
      list-style: none;
      padding: 0;
      margin: 0 0 var(--space-xl); /* mb-6 equivalent */
      display: flex;
      flex-direction: row;
      gap: 12px;
      overflow-x: auto;
      overflow-y: hidden;
      scrollbar-width: none; /* Firefox */
      -ms-overflow-style: none; /* IE and Edge */
      white-space: nowrap;
      width: 100%;
    }
    .category-list-container {
      margin-bottom: var(--space-xl); /* mb-6 spacing after tabs */
      width: 100%;
      max-width: 100%;
      overflow-x: hidden; /* Prevent overflow */
    }
    .category-list::-webkit-scrollbar {
      display: none; /* Chrome, Safari, Opera */
    }
    /* Standardized Category Item - Horizontal Tab Style */
    .category-item {
      padding: 12px 24px;
      margin-bottom: 0;
      border-radius: 9999px; /* rounded-full */
      cursor: pointer;
      font-size: 15px;
      font-weight: 500;
      color: rgba(209, 213, 219, 1); /* gray-300 */
      transition: all 0.3s ease;
      min-height: var(--touch-target);
      display: inline-flex;
      align-items: center;
      white-space: nowrap;
      flex-shrink: 0;
      background: rgba(31, 41, 55, 1); /* gray-800 */
      border: none;
    }
    .category-item.active {
      background: linear-gradient(135deg, #A855F7 0%, #EC4899 100%); /* purple-500 to pink-500 */
      color: #FFFFFF;
      font-weight: 500;
      box-shadow: var(--shadow-md);
    }
    .category-item:hover:not(.active) {
      background: rgba(55, 65, 81, 1); /* gray-700 */
      color: rgba(209, 213, 219, 1); /* gray-300 */
    }
    .category-item:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }
    .filter-block {
      margin-top: var(--space-xl);
      margin-bottom: var(--space-xl);
    }
    .filter-block label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-sm);
    }
    .search-input {
      font-family: var(--font-input);
      text-transform: none;
      width: 100%;
      padding: var(--space-md) var(--space-lg);
      border-radius: 12px;
      border: 1px solid var(--border-medium);
      background: var(--bg-tertiary);
      color: var(--text-primary);
      font-size: 15px;
      transition: all var(--transition-base);
      min-height: var(--touch-target);
    }
    .search-input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: var(--focus-ring);
      background: var(--surface);
    }
    .search-input::placeholder {
      color: var(--text-muted);
    }
    /* Featured Deal ad-block removed */
    /* Products Grid - Responsive Layout */
    .products-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr); /* grid-cols-2 */
      gap: var(--space-md); /* gap-4 */
      margin-top: var(--space-lg);
      width: 100%;
      max-width: 100%;
      overflow-x: hidden;
    }
    
    /* Mobile: Horizontal scrollable product cards */
    @media (max-width: 767px) {
      /* Make page-container allow horizontal overflow for products-grid */
      #shop-section .page-container {
        overflow-x: visible;
      }
      
      .products-grid {
        display: flex !important;
        flex-direction: row !important;
        flex-wrap: nowrap !important;
        grid-template-columns: none !important;
        overflow-x: auto !important;
        overflow-y: hidden !important;
        scroll-snap-type: x mandatory;
        -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        scrollbar-width: thin; /* Firefox */
        scrollbar-color: var(--primary) var(--bg-secondary);
        gap: var(--space-md);
        padding-bottom: var(--space-sm); /* Space for scrollbar */
        margin-left: calc(-1 * var(--space-md)); /* Break out of page-container padding */
        margin-right: calc(-1 * var(--space-md));
        padding-left: var(--space-md);
        padding-right: var(--space-md);
        width: 100vw; /* Full viewport width */
        max-width: 100vw;
      }
      
      .products-grid .card {
        /* Card width: full viewport width minus left and right padding only */
        /* This ensures one full card is visible at a time with no peek of next card */
        flex: 0 0 calc(100vw - 2 * var(--space-md)) !important;
        min-width: calc(100vw - 2 * var(--space-md)) !important;
        max-width: calc(100vw - 2 * var(--space-md)) !important;
        width: calc(100vw - 2 * var(--space-md)) !important;
        scroll-snap-align: start; /* Snap to each card */
        height: auto;
        flex-shrink: 0 !important; /* Prevent cards from shrinking */
      }
      
      /* Custom scrollbar for mobile */
      .products-grid::-webkit-scrollbar {
        height: 4px;
      }
      
      .products-grid::-webkit-scrollbar-track {
        background: var(--bg-secondary);
        border-radius: 2px;
      }
      
      .products-grid::-webkit-scrollbar-thumb {
        background: var(--primary);
        border-radius: 2px;
      }
      
      .products-grid::-webkit-scrollbar-thumb:hover {
        background: var(--primary-dark);
      }
    }
    
    @media (min-width: 768px) {
      .products-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* md:grid-cols-3 */
        gap: var(--space-lg);
        overflow-x: hidden; /* No horizontal scroll on desktop */
      }
    }
    
    @media (min-width: 1024px) {
      .products-grid {
        grid-template-columns: repeat(4, 1fr); /* lg:grid-cols-4 */
      }
    }

    /* Hero banner / promo above products */
    /* Standardized Hero Ad */
    .hero-ad {
      border-radius: 16px;
      padding: var(--space-lg) var(--space-xl);
      background: linear-gradient(135deg, rgba(184,62,191,0.15), rgba(161,46,184,0.12));
      border: 1px solid rgba(184,62,191,0.3);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: var(--space-lg);
      margin-bottom: var(--space-xl);
      box-shadow: var(--shadow-sm);
    }
    .hero-ad .cta { 
      background: #D8FF3F; 
      color: #0F0F0F; 
      padding: var(--space-md) var(--space-xl); 
      border-radius: 12px; 
      font-family: var(--font-graffiti);
      font-weight: 600;
      font-size: 15px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      min-height: var(--touch-target);
      border: none;
      cursor: pointer;
      transition: all var(--transition-base);
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(216, 255, 63, 0.4);
    }
    .hero-ad .cta:hover {
      background: #E6FF7A;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(216, 255, 63, 0.5);
    }

    /* Homepage Hero Section - Balanced & Modern */
    .hero-section {
      /* Original brand colors with subtle overlay to reduce saturation by 10-15% */
      background: linear-gradient(135deg, #B83EBF 0%, #A12EB8 100%);
      border-radius: 16px;
      padding: 30px 28px 25px 28px;
      margin-bottom: var(--space-xl);
      position: relative;
      overflow: hidden; /* Prevent overflow */
      box-shadow: var(--shadow-md);
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      width: 100%;
      max-width: 100%; /* Use full width of container */
      margin-left: auto;
      margin-right: auto;
      min-height: 220px; /* min-h-* instead of fixed height */
      max-height: none; /* Remove fixed max-height */
      justify-content: center;
    }
    
    @media (min-width: 768px) {
      .hero-section {
        min-height: 280px;
        max-height: 320px;
      }
    }
    
    .hero-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      /* Subtle white overlay to reduce saturation by ~12% while keeping brand colors */
      background: radial-gradient(circle at 30% 50%, rgba(255, 255, 255, 0.12) 0%, transparent 50%),
                  radial-gradient(circle at 70% 50%, rgba(255, 255, 255, 0.08) 0%, transparent 50%);
      pointer-events: none;
    }
    
    .hero-content {
      position: relative;
      z-index: 1;
      max-width: 100%;
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: var(--space-sm);
      align-items: center;
      justify-content: center;
    }
    
    .hero-logo {
      max-width: 160px;
      width: 160px;
      height: auto;
      aspect-ratio: auto;
      object-fit: contain;
      margin-top: 0;
      margin-bottom: 0;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
      display: block;
    }
    
    .hero-headline {
      font-family: var(--font-graffiti);
      font-size: clamp(22px, 2.8vw, 34px);
      font-weight: 700;
      color: #FFFFFF;
      line-height: 1.2;
      letter-spacing: -0.01em;
      text-transform: uppercase;
      margin: 0;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }
    
    .hero-subheadline {
      font-family: var(--font-graffiti);
      font-size: clamp(11px, 1.4vw, 13px);
      font-weight: 400;
      color: rgba(255, 255, 255, 0.95);
      line-height: 1.5;
      margin: 0;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.15);
      max-width: 600px;
    }
    
    .hero-cta {
      background: #D8FF3F;
      color: #0F0F0F;
      padding: var(--space-md) var(--space-xl);
      border-radius: 12px;
      font-family: var(--font-graffiti);
      font-weight: 600;
      font-size: 16px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      min-height: 48px;
      min-width: 180px;
      border: none;
      cursor: pointer;
      transition: all var(--transition-base);
      white-space: nowrap;
      box-shadow: 0 4px 16px rgba(216, 255, 63, 0.4);
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      margin-top: var(--space-xs);
    }
    
    .hero-cta:hover {
      background: #E6FF7A;
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(216, 255, 63, 0.5);
    }
    
    .hero-cta:active {
      transform: translateY(0);
    }
    
    @media (max-width: 767px) {
      .hero-section {
        padding: 20px 20px 20px 20px;
        margin-bottom: var(--space-lg);
        min-height: 220px;
        max-height: 260px;
      }
      
      .hero-content {
        gap: var(--space-xs);
      }
      
      .hero-logo {
        max-width: 115px;
        margin-top: 0;
        margin-bottom: 0;
      }
      
      .hero-headline {
        font-size: clamp(17px, 3.5vw, 22px);
        margin-bottom: 0;
      }
      
      .hero-subheadline {
        font-size: clamp(10px, 2.5vw, 11px);
        margin-bottom: 0;
      }
      
      .hero-cta {
        padding: var(--space-sm) var(--space-lg);
        font-size: 14px;
        min-height: 44px;
        min-width: 160px;
        margin-top: 0;
      }
    }
    
    @media (max-width: 480px) {
      .hero-section {
        padding: 24px var(--space-md);
        min-height: 220px;
        max-height: 280px;
        width: 100%;
        box-sizing: border-box;
        margin-left: 0;
        margin-right: 0;
        max-width: 100%;
      }
      
      .hero-logo {
        max-width: 100px !important;
        margin-bottom: var(--space-sm);
      }
      
      .hero-headline {
        font-size: clamp(18px, 4vw, 24px) !important;
        line-height: 1.2 !important;
        margin-bottom: var(--space-sm);
      }
      
      .hero-subheadline {
        font-size: clamp(10px, 2.5vw, 12px) !important;
        line-height: 1.4 !important;
      }
    }

    /* Carousel styles - horizontal scrolling layout */
    .hero-carousel { 
      margin-bottom: var(--space-xl); 
      position: relative; 
      overflow: hidden;
      border-radius: 16px;
      width: 100%;
      max-width: 100%;
      box-sizing: border-box;
    }
    .hero-carousel .carousel-slides { 
      display: flex; 
      flex-direction: row;
      gap: 0;
      overflow: hidden;
      scroll-behavior: smooth;
      position: relative;
      width: 100%;
      box-sizing: border-box;
      min-height: 400px;
    }
    /* Standardized Hero Carousel Slide */
    .hero-carousel .carousel-slide { 
      display: flex; 
      flex-direction: column;
      gap: var(--space-md); 
      align-items: flex-start; 
      padding: var(--space-xl); 
      border-radius: 16px; 
      background: var(--surface);
      border: 1px solid var(--border-light); 
      box-shadow: var(--shadow-md); 
      opacity: 0;
      transform: translateX(100%);
      transition: opacity 0.5s ease, transform 0.5s ease;
      width: 100%;
      min-width: 100%;
      max-width: 100%;
      flex-shrink: 0;
      position: absolute;
      top: 0;
      left: 0;
      box-sizing: border-box;
    }
    .hero-carousel .carousel-slide.active { 
      opacity: 1; 
      transform: translateX(0);
      position: relative;
    }
    .hero-carousel .carousel-slide.prev {
      transform: translateX(-100%);
    }
    .hero-carousel .carousel-slide.next {
      transform: translateX(100%);
    }
    .hero-carousel .slide-media { 
      width: 100%; 
      aspect-ratio: 16/9;
      border-radius: 12px; 
      overflow: hidden;
      box-shadow: var(--shadow-sm);
      position: relative;
      margin: 0;
      flex-shrink: 0;
      box-sizing: border-box;
    }
    .hero-carousel .slide-media img{ 
      width: 100%; 
      height: 100%; 
      object-fit: cover; 
      display: block;
      position: absolute;
      top: 0;
      left: 0;
    }
    .hero-carousel .slide-body { 
      padding: 0; 
      display: flex; 
      flex-direction: column; 
      gap: var(--space-md); 
      flex: 1;
      width: 100%;
      box-sizing: border-box;
    }
    .hero-carousel .slide-title{ 
      font-family: var(--font-graffiti);
      font-size: 26px; 
      font-weight: 400; 
      color: var(--text-primary);
      letter-spacing: 0.02em;
      line-height: 1.2;
      text-transform: uppercase;
    }
    .hero-carousel .slide-sub{ 
      color: var(--text-secondary); 
      font-size: 15px;
      line-height: 1.5;
    }
    .hero-carousel .slide-cta .cta{ 
      border: none; 
      cursor: pointer; 
      border-radius: 12px; 
      padding: var(--space-md) var(--space-xl); 
      background: #D8FF3F; 
      color: #0F0F0F; 
      font-family: var(--font-graffiti);
      font-weight: 600;
      font-size: 15px;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      min-height: var(--touch-target);
      transition: all var(--transition-base);
      align-self: flex-start;
      box-shadow: 0 4px 12px rgba(216, 255, 63, 0.4);
    }
    .hero-carousel .slide-cta .cta:hover {
      background: #E6FF7A;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(216, 255, 63, 0.5);
    }
    /* Carousel Controls */
    .hero-carousel .carousel-controls{ 
      display: flex;
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 100%;
      justify-content: space-between;
      padding: 0 var(--space-md);
      pointer-events: none;
      z-index: 10;
      left: 0;
      right: 0;
      box-sizing: border-box;
    }
    .hero-carousel .carousel-btn {
      pointer-events: all;
      background: rgba(15, 15, 15, 0.7);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      width: 48px;
      height: 48px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all var(--transition-base);
      font-size: 20px;
      backdrop-filter: blur(8px);
    }
    .hero-carousel .carousel-btn:hover {
      background: rgba(15, 15, 15, 0.9);
      transform: scale(1.1);
    }
    .hero-carousel .carousel-btn:active {
      transform: scale(0.95);
    }
    .hero-carousel .carousel-btn.prev {
      left: var(--space-md);
    }
    .hero-carousel .carousel-btn.next {
      right: var(--space-md);
    }
    /* Carousel Indicators */
    .hero-carousel .carousel-indicators{ 
      display: flex;
      justify-content: center;
      gap: var(--space-sm);
      padding: var(--space-md) 0;
      position: absolute;
      bottom: var(--space-md);
      left: 50%;
      transform: translateX(-50%);
      z-index: 10;
      width: auto;
      max-width: 100%;
      box-sizing: border-box;
    }
    .hero-carousel .carousel-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.4);
      border: 1px solid rgba(255, 255, 255, 0.6);
      cursor: pointer;
      transition: all var(--transition-base);
      backdrop-filter: blur(4px);
    }
    .hero-carousel .carousel-indicator.active {
      background: #D8FF3F;
      border-color: #D8FF3F;
      width: 24px;
      border-radius: 5px;
    }
    .hero-carousel .carousel-indicator:hover {
      background: rgba(255, 255, 255, 0.6);
    }

    /* Mobile bottom bar removed - using BottomNav (AppFooter) instead */
    #mobile-bar{ 
      display: none !important; 
    }
    @media (max-width: 767px){
      .layout {
        grid-template-columns: 1fr;
        gap: var(--space-lg);
        padding: var(--space-md);
        /* Safe area insets for mobile */
        padding-left: max(var(--space-md), env(safe-area-inset-left, 0px));
        padding-right: max(var(--space-md), env(safe-area-inset-right, 0px));
      }
      
      /* Reorder: Hero section first, then categories on mobile */
      aside {
        order: 2; /* Categories come after hero */
        position: static;
        border: 1px solid var(--border-light);
        border-radius: var(--radius-lg);
        margin-top: 0;
      }
      
      main {
        order: 1; /* Main content (with hero) comes first */
      }
      
      /* Ensure hero section is properly sized on mobile */
      .hero-section {
        width: 100%;
        margin-bottom: var(--space-lg);
      }
      
      /* Ensure carousel is full width on mobile */
      .hero-carousel {
        width: 100%;
        max-width: 100%;
        margin-left: 0;
        margin-right: 0;
      }
      
      .hero-carousel .carousel-slide{ 
        flex-direction: column; 
        padding: var(--space-lg);
        width: 100%;
        max-width: 100%;
      }
      .hero-carousel .slide-media{ 
        width: 100%; 
        aspect-ratio: 16/9;
        max-width: 100%;
      }
      .hero-carousel .slide-body{ 
        align-items: flex-start; 
      }
      .hero-carousel .slide-title {
        font-size: 20px;
      }
      .hero-carousel .carousel-btn {
        width: 40px;
        height: 40px;
        font-size: 18px;
      }
      .hero-carousel .carousel-indicators {
        bottom: var(--space-sm);
      }
      
      /* Mobile-bar removed - using BottomNav (AppFooter) instead */
      
      /* make buttons larger for touch */
      .btn, .nav-btn, .nav-toggle{ 
        padding: var(--space-md) var(--space-lg); 
        min-height: var(--touch-target-lg);
      }
      
      /* Products grid responsive classes handle mobile layout */
      
      /* Ensure card footer works on mobile */
      .card-footer {
        padding: var(--space-sm) var(--space-md) var(--space-md) var(--space-md);
        gap: 8px; /* Slightly smaller gap on mobile */
      }
      
      .card-footer .btn-primary {
        font-size: 12px;
        padding: var(--space-xs) var(--space-sm);
      }
      
      .card-footer .price {
        font-size: 18px;
      }
      
      h2 {
        font-size: 24px;
      }
    }

    @media (max-width: 480px){
      html {
        font-size: 15px;
      }
      
      header {
        padding: 0;
        padding-left: max(12px, env(safe-area-inset-left, 0px));
        padding-right: max(var(--space-md), env(safe-area-inset-right, 0px));
        padding-top: env(safe-area-inset-top, 0px);
        height: calc(60px + env(safe-area-inset-top, 0px));
        min-height: calc(60px + env(safe-area-inset-top, 0px));
      }
      
      /* Smaller login button on very small screens */
      #login-toggle-btn {
        min-width: 70px !important;
        padding: var(--space-sm) var(--space-md) !important;
        font-size: 14px !important;
      }
      
      /* Full-width login form on small screens */
      #login-register-section {
        padding: var(--space-lg) !important;
      }
      
      /* Adjust nav position for smaller header */
      nav {
        top: calc(60px + env(safe-area-inset-top, 0px)) !important;
      }
      
      .layout {
        padding: var(--space-md);
        padding-left: max(var(--space-md), env(safe-area-inset-left));
        padding-right: max(var(--space-md), env(safe-area-inset-right));
      }
      
      /* Make carousel edge-to-edge on mobile */
      .hero-carousel {
        width: calc(100% + 2 * var(--space-md));
        max-width: calc(100% + 2 * var(--space-md));
        margin-left: calc(-1 * var(--space-md));
        margin-right: calc(-1 * var(--space-md));
        border-radius: 0;
      }
      
      .hero-carousel .carousel-slide {
        width: 100%;
        max-width: 100%;
        min-width: 100%;
        border-radius: 0;
      }
      .hero-carousel .slide-media{ 
        height: 160px; 
      }
      .hero-carousel .slide-title{ 
        font-size: 16px; 
      }
      
      /* Removed conflicting products-grid rule - using flex layout for horizontal scrolling */
      
      .map-shell{ 
        height: 240px; 
      }
      
      .two-col{ 
        grid-template-columns: 1fr;
        gap: var(--space-lg);
      }
      
      .brand-title {
        font-size: 18px;
      }
      
      /* Improve touch targets on small screens */
      .btn, button, .nav-btn, .chip {
        min-height: 48px;
        min-width: 48px;
        padding: var(--space-sm) var(--space-md);
      }
      
      /* Better spacing for mobile */
      .card {
        padding: var(--space-md);
        margin-bottom: var(--space-md);
      }
      
      /* Improve text readability */
      p, .text-muted, .card-desc {
        font-size: 15px;
        line-height: 1.6;
      }
      
      /* Better modal/dialog on mobile */
      .modal, .dialog {
        margin: var(--space-md);
        max-height: calc(100dvh - 2 * var(--space-md) - env(safe-area-inset-top) - env(safe-area-inset-bottom));
        border-radius: var(--radius-lg);
      }
      
    }
    /* Mobile-specific improvements */
    @media (max-width: 767px) {
      /* Improve scrolling */
      * {
        -webkit-overflow-scrolling: touch;
      }
      
      /* Better image handling */
      img {
        max-width: 100%;
        height: auto;
        display: block;
      }
      
      /* Prevent text selection on buttons */
      .btn, button, .nav-btn, .chip {
        -webkit-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: rgba(184, 62, 191, 0.2);
        touch-action: manipulation;
      }
      
      /* Improve table scrolling on mobile */
      table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        white-space: nowrap;
      }
    }
    
    /* Standardized Card Styles */
    .card {
      background: var(--surface);
      border-radius: 16px; /* rounded-2xl */
      padding: 0;
      border: 1px solid var(--border-light);
      display: flex;
      flex-direction: column;
      gap: 0;
      box-shadow: var(--shadow-md);
      transition: all var(--transition-base);
      height: auto; /* Remove fixed height, use auto */
      position: relative; /* For pseudo-element hover effects */
    }
    /* Use pseudo-element for hover glow to prevent text clipping */
    .card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 16px;
      border: 1px solid transparent;
      pointer-events: none;
      transition: all var(--transition-base);
      z-index: 0;
    }
    .card:hover{ 
      transform: translateY(-2px); 
      box-shadow: var(--shadow-lg);
    }
    .card:hover::before {
      border-color: var(--primary);
    }
    .card-media{ 
      aspect-ratio: 4/3;
      width: 100%;
      border-radius: 16px 16px 0 0; /* rounded-t-2xl */
      background: var(--bg-secondary); 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      color: var(--text-muted); 
      font-weight: 600; 
      font-size: 14px;
      overflow: hidden;
      position: relative;
      margin: 0;
    }
    .card{ 
      opacity: 0; 
      transform: translateY(8px); 
      animation: fadeUp .4s ease forwards; 
    }
    @keyframes fadeUp{ 
      from{ opacity: 0; transform: translateY(8px); } 
      to{ opacity: 1; transform: translateY(0); } 
    }
    .card-media img{ 
      width: 100%; 
      height: 100%; 
      object-fit: cover; 
      border-radius: 16px 16px 0 0; /* rounded-t-2xl */
      display: block;
      position: absolute;
      top: 0;
      left: 0;
    }
    /* skeleton shimmer for image loading */
    .skeleton{ 
      position: relative; 
      overflow: hidden; 
      background: linear-gradient(90deg, var(--bg-secondary), var(--bg-tertiary), var(--bg-secondary));
      background-size: 200% 100%;
      animation: shimmer 1.5s ease-in-out infinite;
    }
    @keyframes shimmer{ 
      0%{ background-position: 200% 0; } 
      100%{ background-position: -200% 0; } 
    }
    .img-loaded{ 
      transition: opacity .3s ease; 
      opacity: 1; 
    }
    /* Card info section - below image */
    .card-info {
      padding: var(--space-lg); /* p-4 or p-6 equivalent */
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
      flex: 1;
      min-width: 0; /* Allow flex items to shrink below content size */
      position: relative; /* Ensure content is above pseudo-element */
      z-index: 1;
    }
    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: var(--space-md);
      margin-bottom: var(--space-xs);
    }
    .card-title {
      font-size: 17px;
      font-weight: 700;
      color: var(--text-primary);
      line-height: 1.3;
      flex: 1;
      font-family: var(--font-body);
      margin-bottom: 4px;
    }
    .card-category {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: var(--space-sm);
    }
    .card-desc {
      font-size: 13px;
      color: var(--text-secondary);
      line-height: 1.5;
      min-height: 40px;
      margin-bottom: var(--space-sm);
    }
    /* Product Card Footer - Price and Button Container */
    .card-footer {
      display: flex;
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
      gap: 12px; /* Fixed 12px gap as specified */
      margin-top: auto;
      padding: var(--space-sm) var(--space-lg) var(--space-md) var(--space-lg);
      width: 100%;
      box-sizing: border-box;
      position: relative; /* Ensure footer is above pseudo-element */
      z-index: 1;
    }
    
    /* Price styling */
    .price {
      font-size: clamp(18px, 2vw, 22px); /* Responsive text sizing */
      font-weight: 800;
      color: #FACC15; /* text-yellow-400 */
      letter-spacing: 0.01em;
      font-family: var(--font-body);
      white-space: nowrap; /* Prevent price from wrapping */
      flex-shrink: 0; /* Prevent price from shrinking */
      min-width: 0; /* Allow to shrink if absolutely necessary */
    }
    /* Standardized Button Styles */
    .btn {
      border: none;
      cursor: pointer;
      padding: var(--space-md) var(--space-lg);
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      min-height: var(--touch-target);
      transition: all var(--transition-base);
      white-space: nowrap;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-family: var(--font-body);
    }
    
    /* Primary Button - Neon Yellow/Green */
    .btn-primary {
      background: #D8FF3F;
      color: #0F0F0F;
      font-family: var(--font-graffiti);
      font-weight: 600;
      font-size: clamp(12px, 1.5vw, 14px); /* Responsive font size */
      letter-spacing: 0.03em;
      text-transform: uppercase;
      box-shadow: 0 4px 12px rgba(216, 255, 63, 0.4);
      padding: var(--space-sm) var(--space-md); /* Use padding, not width */
      min-width: fit-content; /* Button sizes to content */
      flex-shrink: 1; /* Allow button to shrink if needed */
      white-space: nowrap; /* Keep text on one line */
      box-sizing: border-box;
      text-align: center; /* Center text */
      overflow: visible; /* Ensure text is never clipped */
    }
    
    /* Card footer button specific rules */
    .card-footer .btn-primary {
      max-width: none; /* Remove max-width restriction */
      flex: 0 1 auto; /* Don't grow, can shrink, auto basis */
      text-overflow: clip; /* Don't use ellipsis */
      overflow: visible; /* Ensure button text is never clipped */
    }
    
    /* Responsive adjustments for different screen sizes */
    @media (min-width: 768px) {
      .card-footer {
        gap: 12px; /* Full gap on desktop */
      }
      
      .card-footer .btn-primary {
        font-size: 14px;
        padding: var(--space-sm) var(--space-md);
      }
    }
    
    @media (min-width: 1024px) {
      .card-footer .price {
        font-size: 22px;
      }
    }
    
    @media (min-width: 1440px) {
      .card-footer {
        padding: var(--space-sm) var(--space-xl) var(--space-md) var(--space-xl);
      }
    }
    .btn-primary:hover {
      background: #E6FF7A;
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(216, 255, 63, 0.5);
    }
    .btn-primary:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(216, 255, 63, 0.4);
    }
    
    /* Secondary Button - Purple Gradient */
    .btn-outline,
    .btn-secondary {
      background: linear-gradient(135deg, #B83EBF 0%, #A12EB8 100%);
      color: #FFFFFF;
      border: none;
      box-shadow: 0 4px 12px rgba(184, 62, 191, 0.3);
    }
    .btn-outline:hover,
    .btn-secondary:hover {
      background: linear-gradient(135deg, #C85ECF 0%, #B83EBF 100%);
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(184, 62, 191, 0.4);
    }
    .btn-outline:active,
    .btn-secondary:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(184, 62, 191, 0.3);
    }
    .btn:focus-visible, .nav-btn:focus-visible, .nav-toggle:focus-visible { 
      outline: none; 
      box-shadow: var(--focus-ring); 
    }

    /* Standardized Toast Notification */
    .toast {
      position: fixed;
      right: var(--space-lg);
      bottom: var(--space-lg);
      min-width: 280px;
      max-width: min(400px, calc(100vw - 2 * var(--space-lg)));
      background: var(--surface);
      border: 1px solid var(--border-light);
      color: var(--text-primary);
      padding: var(--space-lg);
      border-radius: 16px;
      display: flex;
      gap: var(--space-md);
      align-items: center;
      box-shadow: var(--shadow-lg);
      transform: translateY(20px) scale(0.95);
      opacity: 0;
      transition: transform 300ms cubic-bezier(.2,.9,.2,1), opacity 300ms ease;
      z-index: 9999;
    }
    .toast.show { 
      transform: translateY(0) scale(1); 
      opacity: 1; 
    }
    .toast .toast-actions { 
      margin-left: auto; 
      display: flex; 
      gap: var(--space-sm); 
    }
    
    @media (max-width: 767px) {
      .toast {
        right: var(--space-md);
        bottom: calc(56px + env(safe-area-inset-bottom, 0px) + var(--space-md)); /* Above bottom nav */
        left: var(--space-md);
        max-width: none;
        width: calc(100vw - 2 * var(--space-md));
      }
    }
    .toast .toast-actions .btn { 
      padding: var(--space-sm) var(--space-md); 
      font-size: 13px; 
      min-height: 36px;
    }
    .stack {
      display: flex;
      flex-direction: column;
      gap: var(--space-lg);
    }
    .row {
      display: flex;
      gap: var(--space-md);
      flex-wrap: wrap;
      align-items: center;
    }
    label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: var(--space-xs);
      display: block;
    }
    /* Standardized Input Styles */
    input, select, textarea {
      font-family: var(--font-input);
      font-size: 16px; /* Prevent zoom on iOS */
      text-transform: none;
      padding: var(--space-md) var(--space-lg);
      border-radius: 12px;
      border: 1px solid var(--border-medium);
      background: var(--bg-secondary);
      color: var(--text-primary);
      width: 100%;
      min-height: var(--touch-target);
      transition: all var(--transition-base);
      -webkit-appearance: none;
      appearance: none;
      touch-action: manipulation;
    }
    /* Prevent zoom on input focus in iOS */
    @media (max-width: 480px) {
      input[type="text"],
      input[type="email"],
      input[type="password"],
      input[type="number"],
      input[type="tel"],
      input[type="url"],
      select,
      textarea {
        font-size: 16px !important;
      }
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: var(--focus-ring);
      background: var(--surface);
    }
    input::placeholder, textarea::placeholder {
      color: var(--text-muted);
    }
    textarea {
      resize: vertical;
      min-height: 100px;
      line-height: 1.5;
    }
    input[type="checkbox"] {
      min-height: auto;
      width: auto;
      margin-right: var(--space-sm);
      cursor: pointer;
    }
    .two-col {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
      gap: var(--space-xl);
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    .table th, .table td {
      border-bottom: 1px solid var(--border-light);
      padding: var(--space-md);
      text-align: left;
    }
    .table th {
      font-weight: 600;
      color: var(--text-primary);
      background: var(--bg-tertiary);
    }
    .table td {
      color: var(--text-secondary);
    }
    .table tr:hover td {
      background: var(--bg-secondary);
    }
    /* Standardized Badge/Pill/Tag Styles */
    .badge,
    .pill,
    .tag {
      display: inline-block;
      font-size: 12px;
      padding: var(--space-xs) var(--space-sm);
      border-radius: 12px;
      background: var(--bg-tertiary);
      color: var(--text-secondary);
      font-weight: 500;
      border: 1px solid var(--border-light);
    }
    
    /* Standardized Map Shell */
    .map-shell {
      background: var(--surface);
      border-radius: 16px;
      border: 1px solid var(--border-light);
      padding: var(--space-lg);
      font-size: 14px;
      color: var(--text-secondary);
      height: 280px;
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
      box-shadow: var(--shadow-md);
    }
    .map-placeholder {
      flex: 1;
      border-radius: 12px;
      border: 2px dashed var(--border-medium);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      color: var(--text-muted);
      background: var(--bg-secondary);
    }
    /* Standardized Notice */
    .notice {
      font-size: 13px;
      color: var(--text-muted);
      line-height: 1.6;
      padding: var(--space-md);
      border-radius: 12px;
      background: var(--bg-secondary);
      border: 1px solid var(--border-light);
    }
    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-sm);
      font-size: 14px;
    }
    /* Standardized Chip */
    .chip {
      padding: var(--space-sm) var(--space-lg);
      border-radius: 12px;
      border: 1px solid var(--border-medium);
      cursor: pointer;
      background: var(--bg-secondary);
      color: var(--text-secondary);
      font-weight: 500;
      transition: all var(--transition-base);
      min-height: var(--touch-target);
      display: inline-flex;
      align-items: center;
    }
    .chip:hover {
      border-color: var(--border-strong);
      background: var(--bg-tertiary);
    }
    .chip.active {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      border-color: var(--primary);
      color: var(--text-inverse);
      box-shadow: 0 4px 12px rgba(184, 62, 191, 0.3);
    }
    .chip:focus-visible {
      outline: none;
      box-shadow: var(--focus-ring);
    }
    /* Tab Interface Styles */
    .tab-container {
      margin-bottom: var(--space-xl);
    }
    .tab-header {
      display: flex;
      gap: var(--space-sm);
      border-bottom: 1px solid var(--border-light);
      margin-bottom: var(--space-xl);
      overflow-x: auto;
    }
    .tab-header::-webkit-scrollbar {
      display: none;
    }
    .tab-button {
      padding: var(--space-md) var(--space-xl);
      background: transparent;
      border: none;
      border-bottom: 2px solid transparent;
      color: var(--text-secondary);
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      white-space: nowrap;
      min-height: 48px;
    }
    .tab-button:hover {
      color: var(--text-primary);
      background: var(--bg-secondary);
    }
    .tab-button.active {
      color: var(--text-primary);
      border-bottom-color: var(--primary);
      background: var(--bg-secondary);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }
    /* Toggle Switch Styles */
    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 52px;
      height: 28px;
      margin-right: var(--space-md);
    }
    .toggle-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .toggle-slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(31, 41, 55, 1);
      transition: 0.3s;
      border-radius: 28px;
      border: 1px solid var(--border-medium);
    }
    .toggle-slider:before {
      position: absolute;
      content: "";
      height: 20px;
      width: 20px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: 0.3s;
      border-radius: 50%;
    }
    .toggle-switch input:checked + .toggle-slider {
      background: linear-gradient(135deg, #B83EBF 0%, #A12EB8 100%);
      border-color: var(--primary);
    }
    .toggle-switch input:checked + .toggle-slider:before {
      transform: translateX(24px);
    }
    .toggle-switch input:focus + .toggle-slider {
      box-shadow: var(--focus-ring);
    }
    .toggle-item {
      display: flex;
      align-items: center;
      padding: var(--space-md);
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      margin-bottom: var(--space-sm);
      transition: all 0.3s ease;
    }
    .toggle-item:hover {
      background: var(--bg-tertiary);
    }
    .toggle-label {
      flex: 1;
      font-size: 15px;
      font-weight: 500;
      color: var(--text-primary);
    }
    .toggle-description {
      font-size: 13px;
      color: var(--text-secondary);
      margin-top: 2px;
    }
    /* Improved Form Styles */
    .form-group {
      margin-bottom: var(--space-lg);
    }
    .form-group label {
      display: block;
      margin-bottom: var(--space-sm);
      font-size: 14px;
      font-weight: 600;
      color: var(--text-primary);
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 12px 16px;
      background: rgba(17, 24, 39, 1);
      border: 1px solid rgba(31, 41, 55, 1);
      border-radius: 12px;
      color: var(--text-primary);
      font-size: 15px;
      transition: all 0.3s ease;
    }
    .form-group input:focus,
    .form-group select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(184, 62, 191, 0.1);
    }
    .form-group input::placeholder {
      color: var(--text-muted);
    }
    .form-row {
      display: flex;
      gap: var(--space-md);
    }
    .form-row .form-group {
      flex: 1;
      margin-bottom: 0;
    }
    /* Carousel Admin Styles */
    .carousel-slide-admin {
      border: 1px solid var(--border-light);
      border-radius: var(--radius-md);
      padding: var(--space-xl);
      background: var(--bg-secondary);
      margin-bottom: var(--space-lg);
      width: 100%;
      box-sizing: border-box;
    }
    .carousel-slide-admin-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-lg);
    }
    .carousel-slide-admin-title {
      font-weight: 600;
      color: var(--text-primary);
      font-size: 18px;
    }
    .carousel-slide-admin-preview {
      width: 100%;
      max-width: 600px;
      aspect-ratio: 16/9;
      border-radius: var(--radius-md);
      overflow: hidden;
      margin-bottom: var(--space-lg);
      background: var(--bg-tertiary);
      border: 1px solid var(--border-light);
      box-shadow: var(--shadow-sm);
    }
    .carousel-slide-admin-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
    #carousel-slides-admin {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: var(--space-lg);
    }
    .checkbox-group {
      display: flex;
      align-items: flex-start;
      gap: var(--space-sm);
      padding: var(--space-md);
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      margin-bottom: var(--space-lg);
    }
    .checkbox-group input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-top: 2px;
      cursor: pointer;
      accent-color: var(--primary);
    }
    .checkbox-group label {
      flex: 1;
      margin: 0;
      font-size: 14px;
      line-height: 1.5;
      color: var(--text-primary);
      cursor: pointer;
    }
    .text-muted {
      color: var(--text-muted);
      font-size: 14px;
      line-height: 1.6;
    }
    @media (max-width: 767px) {
      header {
        padding: var(--space-md) var(--space-lg);
        padding-left: max(var(--space-md), env(safe-area-inset-left, 0px));
        padding-right: max(var(--space-md), env(safe-area-inset-right, 0px));
        padding-top: max(var(--space-md), env(safe-area-inset-top, 0px));
        height: auto;
        min-height: 64px;
      }
      
      /* TopNav hidden on mobile - only logo and login shown */
      
      nav{ 
        position: static; 
        display: none !important; /* Hide TopNav on mobile */ 
        flex-direction: row; 
        background: transparent; 
        padding: 0; 
        border-bottom: none;
        box-shadow: none;
        gap: var(--space-sm);
        align-items: center;
        justify-content: center;
        max-height: none;
        overflow-y: visible;
      }
      
      @keyframes navFade{ 
        from{ opacity: 0; transform: translateY(-8px); } 
        to{ opacity: 1; transform: translateY(0); } 
      }
      
      .nav-btn {
        width: 100%;
        justify-content: flex-start;
        padding: var(--space-md) var(--space-lg);
        border-radius: var(--radius-md);
        min-height: 48px;
        touch-action: manipulation;
      }
      
      .nav-btn.active::after {
        left: 0;
        transform: none;
        width: 4px;
        height: 100%;
        border-radius: var(--radius-md) 0 0 var(--radius-md);
      }
      
      .brand,
      .brand-link {
        flex: 0 0 auto;
        margin-left: 0;
      }
      
      .brand-logo {
        max-width: 110px;
        width: 110px;
        height: auto;
      }
      
      .header-right {
        gap: var(--space-sm) !important;
        margin-left: auto;
        flex-wrap: nowrap;
      }
      
      /* Fix login button for mobile */
      #login-toggle-btn {
        min-height: 48px !important;
        min-width: 80px !important;
        padding: var(--space-md) var(--space-lg) !important;
        font-size: 15px !important;
        font-weight: 600;
        border-radius: var(--radius-md);
        touch-action: manipulation;
        -webkit-tap-highlight-color: rgba(184, 62, 191, 0.2);
      }
      
      /* Fix logout button for mobile */
      #logout-btn {
        min-height: 44px !important;
        padding: var(--space-sm) var(--space-md) !important;
        font-size: 14px !important;
      }
      
      /* Tab interface mobile styles */
      .tab-header {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
      }
      .tab-header::-webkit-scrollbar {
        display: none;
      }
      .tab-button {
        min-width: auto;
        padding: var(--space-sm) var(--space-md);
        font-size: 14px;
      }
      .form-row {
        flex-direction: column;
      }
      .form-row .form-group {
        margin-bottom: var(--space-lg);
      }
      
      /* Account & ID Section Mobile Improvements */
      #account-section .card {
        padding: var(--space-lg);
        margin-bottom: var(--space-lg);
      }
      
      #account-section .tab-header {
        gap: var(--space-xs);
        padding: 0;
        margin-bottom: var(--space-lg);
      }
      
      #account-section .tab-button {
        padding: var(--space-sm) var(--space-md);
        font-size: 13px;
        min-height: 44px;
        flex: 1;
        white-space: nowrap;
      }
      
      #account-section .form-group {
        margin-bottom: var(--space-lg);
      }
      
      #account-section .form-group input,
      #account-section .form-group select,
      #account-section .form-group textarea {
        min-height: 48px;
        font-size: 16px;
        padding: var(--space-md) var(--space-lg);
      }
      
      #account-section .btn {
        min-height: 52px;
        font-size: 16px;
        width: 100%;
      }
      
      #account-section .toggle-item {
        padding: var(--space-md);
        min-height: 60px;
      }
      
      /* Admin Section Mobile Improvements */
      #admin-section .card {
        padding: var(--space-lg);
        margin-bottom: var(--space-lg);
      }
      
      #admin-section h2 {
        font-size: 24px;
        margin-bottom: var(--space-md);
      }
      
      #admin-section .text-muted {
        font-size: 14px;
        margin-bottom: var(--space-lg);
      }
      
      #admin-section .stack {
        gap: var(--space-lg);
      }
      
      #admin-section input,
      #admin-section select,
      #admin-section textarea {
        min-height: 48px;
        font-size: 16px;
        padding: var(--space-md) var(--space-lg);
        width: 100%;
        box-sizing: border-box;
      }
      
      #admin-section label {
        font-size: 14px;
        margin-bottom: var(--space-xs);
        display: block;
        font-weight: 600;
      }
      
      #admin-section .btn {
        min-height: 52px;
        font-size: 16px;
        width: 100%;
        margin-top: var(--space-md);
      }
      
      /* Admin form rows stack on mobile */
      #admin-section [style*="display:flex"] {
        flex-direction: column !important;
        gap: var(--space-md) !important;
      }
      
      #admin-section [style*="display:flex"] > * {
        width: 100% !important;
        min-width: 100% !important;
        flex: 1 1 100% !important;
      }
      
      /* Override inline styles for mobile */
      #admin-section input[style*="min-width"],
      #admin-section input[style*="width:100px"] {
        width: 100% !important;
        min-width: 100% !important;
      }
      
      /* Carousel admin inputs */
      #admin-section .carousel-image-file,
      #admin-section .carousel-image-url,
      #admin-section .carousel-title,
      #admin-section .carousel-subtitle,
      #admin-section .carousel-cta {
        width: 100% !important;
        min-height: 48px;
        font-size: 16px;
        padding: var(--space-md) var(--space-lg);
      }
      
      /* Consistent card styling */
      #account-section .card h3,
      #admin-section .card h3 {
        font-size: 18px;
        margin-top: 0;
        margin-bottom: var(--space-lg);
        color: var(--text-primary);
      }
      
      /* Consistent notice styling */
      #account-section .notice,
      #admin-section .notice {
        background: var(--surface);
        border: 1px solid var(--border-light);
        border-radius: var(--radius-md);
        padding: var(--space-md);
        font-size: 13px;
        color: var(--text-secondary);
        margin-top: var(--space-lg);
      }
      
      /* Consistent status text */
      #account-section .text-muted,
      #admin-section .text-muted {
        font-size: 13px;
        color: var(--text-muted);
        margin-top: var(--space-sm);
      }
      
      /* Admin table scrollable on mobile */
      #admin-section .table {
        display: block;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
        font-size: 13px;
      }
      
      #admin-section .table thead,
      #admin-section .table tbody,
      #admin-section .table tr {
        display: table;
        width: 100%;
        table-layout: fixed;
      }
      
      #admin-section .table th,
      #admin-section .table td {
        padding: var(--space-sm) var(--space-xs);
        font-size: 12px;
        word-wrap: break-word;
      }
      
      #admin-section .table th:first-child,
      #admin-section .table td:first-child {
        min-width: 120px;
      }
      
      #admin-section .table th:last-child,
      #admin-section .table td:last-child {
        width: 80px;
      }
      
      /* Image preview responsive */
      #admin-section #image-preview {
        margin-top: var(--space-md);
      }
      
      #admin-section #preview-img {
        max-width: 100%;
        height: auto;
      }
      
      /* Carousel admin mobile */
      #admin-section #carousel-slides-admin {
        gap: var(--space-lg);
      }
      
      #admin-section #carousel-slides-admin .card {
        padding: var(--space-md);
      }
      
      .toggle-item {
        flex-direction: column;
        align-items: flex-start;
        gap: var(--space-sm);
      }
      .toggle-switch {
        align-self: flex-start;
      }
      .form-group input,
      .form-group select {
        min-height: 48px;
        font-size: 16px;
      }
      
      /* Fix user status display on mobile */
      #user-status {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        gap: var(--space-xs);
        font-size: 12px;
        flex-wrap: wrap;
      }
      
      #user-email {
        font-size: 12px;
        max-width: 120px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
      }
      
      .cart-indicator {
        display: none;
      }
      
      /* Improve navigation dropdown menu */
      /* Nav is always visible in header - no fixed positioning needed */
      
      .nav-btn {
        width: auto !important;
        min-height: 44px !important;
        padding: var(--space-sm) var(--space-md) !important;
        font-size: 14px !important;
        font-weight: 500;
        border-radius: var(--radius-md);
        justify-content: center;
        text-align: center;
        gap: var(--space-xs);
        touch-action: manipulation;
        -webkit-tap-highlight-color: rgba(184, 62, 191, 0.2);
      }
      
      /* Backdrop overlay removed - nav is always visible */
      
      /* Fix login form section on mobile */
      #login-register-section .row {
        flex-direction: column !important;
        gap: var(--space-lg) !important;
      }
      
      #login-register-section .row > div {
        flex: 1 1 100% !important;
        width: 100% !important;
      }
      
      /* Ensure login inputs are properly sized */
      #login-register-section input {
        min-height: 48px !important;
        font-size: 16px !important;
        padding: var(--space-md) var(--space-lg) !important;
      }
      
      #login-register-section label {
        font-size: 14px !important;
        margin-bottom: var(--space-xs) !important;
        display: block;
      }
      
      #login-register-section .btn {
        min-height: 52px !important;
        font-size: 16px !important;
        font-weight: 600;
        width: 100%;
        margin-top: var(--space-md);
      }
      
      /* Better spacing in login form */
      #login-register-section .stack {
        gap: var(--space-md) !important;
      }
    }

    /* Cart Icon Button */
    .cart-icon-btn {
      position: relative;
      background: transparent;
      border: none;
      color: var(--text-primary);
      cursor: pointer;
      padding: var(--space-sm);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-md);
      transition: background-color var(--transition-base);
      min-width: var(--touch-target);
      min-height: var(--touch-target);
    }

    .cart-icon-btn:hover {
      background: var(--surface-elevated);
    }

    .cart-icon-btn:focus-visible {
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }

    .cart-badge {
      position: absolute;
      top: 4px;
      right: 4px;
      background: var(--accent);
      color: var(--text-inverse);
      font-size: 11px;
      font-weight: 700;
      padding: 2px 6px;
      border-radius: var(--radius-full);
      min-width: 18px;
      text-align: center;
      line-height: 1.4;
    }

    /* Mini-Cart Styles */
    .mini-cart-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.6);
      z-index: 9998;
      opacity: 0;
      transition: opacity var(--transition-base);
      pointer-events: none;
    }

    .mini-cart-overlay:not([hidden]) {
      opacity: 1;
      pointer-events: all;
    }

    .mini-cart {
      position: fixed;
      top: 0;
      right: 0;
      width: 100%;
      max-width: 420px;
      height: 100dvh;
      height: 100vh;
      background: var(--bg-secondary);
      box-shadow: -4px 0 24px rgba(0, 0, 0, 0.3);
      z-index: 9999;
      display: flex;
      flex-direction: column;
      transform: translateX(100%);
      transition: transform var(--transition-base);
      overflow: hidden;
    }

    .mini-cart:not([hidden]) {
      transform: translateX(0);
    }

    .mini-cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-lg);
      border-bottom: 1px solid var(--border-light);
    }

    .mini-cart-header h3 {
      margin: 0;
      font-size: 20px;
      font-weight: 700;
    }

    .mini-cart-close {
      background: transparent;
      border: none;
      color: var(--text-primary);
      font-size: 32px;
      line-height: 1;
      cursor: pointer;
      padding: var(--space-xs);
      min-width: var(--touch-target);
      min-height: var(--touch-target);
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-sm);
      transition: background-color var(--transition-base);
    }

    .mini-cart-close:hover {
      background: var(--surface-elevated);
    }

    .mini-cart-body {
      flex: 1;
      overflow-y: auto;
      padding: var(--space-md);
      display: flex;
      flex-direction: column;
      gap: var(--space-md);
    }

    .mini-cart-body:empty::before {
      content: 'Your cart is empty';
      display: block;
      text-align: center;
      color: var(--text-muted);
      padding: var(--space-2xl);
    }

    .mini-cart-item {
      display: flex;
      gap: var(--space-md);
      padding: var(--space-md);
      background: var(--surface);
      border-radius: var(--radius-md);
      border: 1px solid var(--border-light);
    }

    .mini-cart-item-image {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: var(--radius-sm);
      background: var(--bg-tertiary);
      flex-shrink: 0;
    }

    .mini-cart-item-details {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: var(--space-xs);
    }

    .mini-cart-item-name {
      font-weight: 600;
      font-size: 15px;
      color: var(--text-primary);
    }

    .mini-cart-item-price {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .mini-cart-qty-controls {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      margin-top: var(--space-xs);
    }

    .mini-cart-qty-btn {
      background: var(--surface-elevated);
      border: 1px solid var(--border-medium);
      color: var(--text-primary);
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      transition: all var(--transition-base);
      min-width: var(--touch-target);
      min-height: var(--touch-target);
    }

    .mini-cart-qty-btn:hover {
      background: var(--primary);
      border-color: var(--primary);
      color: var(--text-inverse);
    }

    .mini-cart-qty-value {
      min-width: 24px;
      text-align: center;
      font-weight: 600;
      font-size: 15px;
    }

    .mini-cart-item-remove {
      background: transparent;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: var(--space-xs);
      font-size: 20px;
      line-height: 1;
      transition: color var(--transition-base);
      min-width: var(--touch-target);
      min-height: var(--touch-target);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .mini-cart-item-remove:hover {
      color: #ff4444;
    }

    .mini-cart-footer {
      padding: var(--space-lg);
      border-top: 1px solid var(--border-light);
      background: var(--bg-secondary);
    }

    .mini-cart-subtotal {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-lg);
      padding-bottom: var(--space-lg);
      border-bottom: 1px solid var(--border-light);
    }

    .mini-cart-subtotal-label {
      font-size: 16px;
      font-weight: 600;
      color: var(--text-primary);
    }

    .mini-cart-subtotal-value {
      font-size: 20px;
      font-weight: 700;
      color: var(--primary);
    }

    .mini-cart-footer .btn {
      width: 100%;
      min-height: var(--touch-target-lg);
      font-size: 16px;
      font-weight: 600;
    }

    /* Checkout Steps */
    .checkout-steps {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: var(--space-sm);
      margin-bottom: var(--space-2xl);
      padding: var(--space-lg);
      background: var(--surface);
      border-radius: var(--radius-lg);
    }

    .checkout-step {
      display: flex;
      align-items: center;
      gap: var(--space-sm);
      flex: 1;
      position: relative;
    }

    .checkout-step-number {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-full);
      background: var(--bg-tertiary);
      color: var(--text-muted);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 14px;
      border: 2px solid var(--border-medium);
      transition: all var(--transition-base);
      flex-shrink: 0;
    }

    .checkout-step.active .checkout-step-number {
      background: var(--primary);
      color: var(--text-inverse);
      border-color: var(--primary);
    }

    .checkout-step.completed .checkout-step-number {
      background: var(--accent);
      color: var(--text-inverse);
      border-color: var(--accent);
    }

    .checkout-step-label {
      font-size: 14px;
      font-weight: 600;
      color: var(--text-secondary);
      transition: color var(--transition-base);
    }

    .checkout-step.active .checkout-step-label {
      color: var(--text-primary);
    }

    .checkout-step-line {
      flex: 1;
      height: 2px;
      background: var(--border-medium);
      margin: 0 var(--space-sm);
    }

    .checkout-step.completed .checkout-step-line {
      background: var(--accent);
    }

    .checkout-step-content {
      display: none;
    }

    .checkout-step-content.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .checkout-summary-card {
      background: var(--surface);
      border: 1px solid var(--border-light);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      position: sticky;
      top: calc(64px + var(--space-lg));
      max-height: calc(100dvh - 80px);
      overflow-y: auto;
    }

    .checkout-summary-card h3 {
      margin-top: 0;
      margin-bottom: var(--space-lg);
      font-size: 18px;
      font-weight: 700;
    }

    .checkout-summary-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: var(--space-md) 0;
      border-bottom: 1px solid var(--border-light);
    }

    .checkout-summary-item:last-child {
      border-bottom: none;
    }

    .checkout-summary-item-name {
      font-weight: 600;
      font-size: 14px;
    }

    .checkout-summary-item-qty {
      color: var(--text-muted);
      font-size: 13px;
    }

    .checkout-summary-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: var(--space-lg);
      padding-top: var(--space-lg);
      border-top: 2px solid var(--border-medium);
      font-size: 18px;
      font-weight: 700;
    }

    .checkout-success {
      background: var(--surface);
      border: 2px solid var(--accent);
      border-radius: var(--radius-lg);
      padding: var(--space-2xl);
      text-align: center;
      margin: var(--space-2xl) 0;
    }

    .checkout-success h3 {
      color: var(--accent);
      margin-bottom: var(--space-md);
    }

    .checkout-error {
      background: rgba(255, 68, 68, 0.1);
      border: 1px solid #ff4444;
      border-radius: var(--radius-md);
      padding: var(--space-md);
      margin: var(--space-md) 0;
      color: #ffcccc;
    }

    .form-error {
      color: #ff4444;
      font-size: 13px;
      margin-top: var(--space-xs);
      display: block;
    }

    .form-group input.form-invalid,
    .form-group select.form-invalid,
    .form-group textarea.form-invalid {
      border-color: #ff4444;
    }

    .form-group input.form-valid,
    .form-group select.form-valid,
    .form-group textarea.form-valid {
      border-color: var(--accent);
    }

    .secure-checkout {
      background: var(--surface);
      border-radius: var(--radius-md);
      padding: var(--space-md);
      margin: var(--space-lg) 0;
      text-align: center;
      font-size: 13px;
      color: var(--text-muted);
      border: 1px solid var(--border-light);
    }

    .secure-checkout::before {
      content: ' ';
      margin-right: var(--space-xs);
    }

    /* Mobile View Cart CTA */
    .mobile-view-cart-cta {
      position: fixed;
      bottom: calc(56px + env(safe-area-inset-bottom, 0px) + var(--space-md));
      left: var(--space-md);
      right: var(--space-md);
      background: var(--primary);
      color: var(--text-inverse);
      border: none;
      border-radius: var(--radius-lg);
      padding: var(--space-md) var(--space-lg);
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      z-index: 999;
      box-shadow: var(--shadow-lg);
      min-height: var(--touch-target-lg);
      transition: all var(--transition-base);
    }

    .mobile-view-cart-cta:not([hidden]) {
      display: block;
    }

    .mobile-view-cart-cta:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow-xl);
    }

    .mobile-view-cart-cta:active {
      transform: translateY(0);
    }

    /* Trust Signals */
    .trust-signals {
      background: var(--surface);
      border-radius: var(--radius-lg);
      padding: var(--space-lg);
      margin: var(--space-xl) 0;
      border: 1px solid var(--border-light);
    }

    .trust-signals h3 {
      margin-top: 0;
      margin-bottom: var(--space-md);
      font-size: 18px;
    }

    .trust-badges {
      display: flex;
      flex-wrap: wrap;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
    }

    .trust-badge {
      display: flex;
      align-items: center;
      gap: var(--space-xs);
      padding: var(--space-sm) var(--space-md);
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      font-size: 13px;
      color: var(--text-secondary);
    }

    .reviews-section {
      margin: var(--space-2xl) 0;
      padding: var(--space-lg);
      background: var(--surface);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-light);
    }

    .reviews-section h3 {
      margin-top: 0;
      margin-bottom: var(--space-lg);
    }

    .review-item {
      padding: var(--space-md);
      border-bottom: 1px solid var(--border-light);
    }

    .review-item:last-child {
      border-bottom: none;
    }

    .review-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--space-xs);
    }

    .review-author {
      font-weight: 600;
      font-size: 14px;
    }

    .review-rating {
      color: var(--accent);
      font-size: 14px;
    }

    .review-text {
      color: var(--text-secondary);
      font-size: 14px;
      line-height: 1.5;
    }

    /* Footer */
    footer {
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-light);
      margin-top: var(--space-3xl);
      padding: var(--space-2xl) var(--space-lg);
    }

    /* Hide footer on mobile, show on desktop */
    @media (max-width: 767px) {
      footer {
        display: none;
      }
      
      /* Hide mobile-bar when AppFooter is shown */
      #mobile-bar {
        display: none !important;
      }
    }

    /* BottomNav - Mobile-only bottom navigation bar */
    .app-footer {
      display: flex; /* Show on mobile by default */
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      width: 100%;
      background: var(--bg-secondary);
      border-top: 1px solid var(--border-light);
      z-index: 50;
      box-shadow: 0 -2px 8px rgba(0, 0, 0, 0.1);
      /* Safe area support - add padding at bottom for iOS notch/home indicator */
      padding-bottom: env(safe-area-inset-bottom, 0px);
      /* Ensure it doesn't stretch vertically */
      height: auto;
      min-height: auto;
      max-height: none;
      /* Remove any flex properties that might cause stretching */
      flex: none;
      align-self: auto;
    }

    /* Hide BottomNav on desktop (>=768px) */
    @media (min-width: 768px) {
      .app-footer {
        display: none !important;
      }
    }

    .app-footer nav {
      display: flex;
      flex-direction: row;
      width: 100%;
      height: 56px;
      min-height: 56px;
      max-height: 56px;
      align-items: center;
      justify-content: space-around;
      padding: 0 var(--space-sm);
      flex-wrap: nowrap;
      gap: 0;
      margin: 0;
      box-sizing: border-box;
    }

    .app-footer-link {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 4px;
      flex: 1 1 0;
      min-width: 0;
      min-height: 44px;
      max-height: 56px;
      padding: var(--space-xs) var(--space-sm);
      background: transparent;
      border: none;
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      transition: all var(--transition-base);
      border-radius: var(--radius-sm);
      position: relative;
      -webkit-tap-highlight-color: rgba(184, 62, 191, 0.2);
      /* Prevent stretching */
      align-self: center;
    }

    .app-footer-link:focus-visible {
      outline: 2px solid var(--primary);
      outline-offset: -2px;
    }

    .app-footer-link:hover {
      color: var(--text-primary);
      background: var(--surface);
    }

    .app-footer-link.active {
      color: var(--primary);
    }

    .app-footer-link.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 40px;
      height: 3px;
      background: var(--primary);
      border-radius: 0 0 var(--radius-sm) var(--radius-sm);
    }

    .app-footer-icon {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
    }

    .app-footer-icon svg {
      width: 100%;
      height: 100%;
      fill: currentColor;
    }

    .app-footer-label {
      font-size: 11px;
      line-height: 1.2;
      text-align: center;
      white-space: nowrap;
    }

    /* Add bottom padding to main content on mobile to prevent overlap with AppFooter */
    @media (max-width: 767px) {
      main#main-content {
        padding-bottom: calc(56px + env(safe-area-inset-bottom, 0px) + var(--space-lg));
      }

      .layout {
        padding-bottom: calc(56px + env(safe-area-inset-bottom, 0px) + var(--space-lg));
      }
      
      /* Ensure body doesn't stretch AppFooter */
      body {
        display: block;
      }
    }

    .footer-top {
      max-width: var(--max-width);
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-2xl);
      margin-bottom: var(--space-2xl);
    }

    .footer-col h4 {
      margin-top: 0;
      margin-bottom: var(--space-md);
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .footer-logo {
      font-size: 24px;
      font-weight: 800;
      color: var(--primary);
      margin-bottom: var(--space-sm);
    }

    .footer-tagline {
      color: var(--text-secondary);
      font-size: 14px;
      margin-bottom: var(--space-md);
    }

    .footer-trust {
      margin-top: var(--space-md);
    }

    .footer-trust p {
      font-size: 12px;
      color: var(--text-muted);
      margin: var(--space-xs) 0;
    }

    .footer-links {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .footer-links li {
      margin-bottom: var(--space-sm);
    }

    .footer-links a {
      color: var(--text-secondary);
      text-decoration: none;
      font-size: 14px;
      transition: color var(--transition-base);
    }

    .footer-links a:hover {
      color: var(--primary);
    }

    .social-icons {
      display: flex;
      gap: var(--space-md);
      margin-bottom: var(--space-lg);
    }

    .social-icons a {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--surface);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      transition: all var(--transition-base);
    }

    .social-icons a:hover {
      background: var(--primary);
      color: var(--text-inverse);
      transform: translateY(-2px);
    }

    .social-icons svg {
      width: 20px;
      height: 20px;
    }

    .newsletter-signup {
      display: flex;
      gap: var(--space-sm);
      margin-top: var(--space-md);
    }

    .newsletter-signup input {
      flex: 1;
      padding: var(--space-sm) var(--space-md);
      background: var(--surface);
      border: 1px solid var(--border-medium);
      border-radius: var(--radius-md);
      color: var(--text-primary);
      font-size: 14px;
    }

    .newsletter-signup .btn {
      padding: var(--space-sm) var(--space-md);
      font-size: 14px;
      white-space: nowrap;
    }

    .footer-bottom {
      max-width: var(--max-width);
      margin: 0 auto;
      padding-top: var(--space-lg);
      border-top: 1px solid var(--border-light);
      text-align: center;
      font-size: 13px;
      color: var(--text-muted);
    }

    .compliance-notice {
      margin-top: var(--space-md);
      font-size: 12px;
      color: var(--text-muted);
    }

    @media (max-width: 768px) {
      .cart-icon-btn {
        display: flex;
      }

      .cart-indicator {
        display: none;
      }

      .mini-cart {
        max-width: 100%;
      }

      .checkout-steps {
        flex-direction: column;
        gap: var(--space-md);
      }

      .checkout-step-line {
        display: none;
      }

      .checkout-summary-card {
        position: static;
        margin-top: var(--space-lg);
      }

      .footer-top {
        grid-template-columns: 1fr;
        gap: var(--space-xl);
      }

      .newsletter-signup {
        flex-direction: column;
      }

      .newsletter-signup .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#main-content">Skip to main content</a>
  <!-- AppShell - Global Layout Container -->
  <div class="app-shell">
  <header>
    <a href="/" class="brand-link">
      <img class="brand-logo" src="assets/ZipMetroLogoRemoveBG (1).png" alt="ZipMetro" />
    </a>
    <nav id="site-nav" role="navigation" aria-label="Primary navigation">
      <!-- Navigation buttons will be generated by JavaScript from navItems config -->
    </nav>
    <div class="header-right">
      <div class="cart-indicator">
        Cart: <span id="cart-count">0</span> items
      </div>
      <div id="user-status">
        <span id="user-email"></span>
        <button id="logout-btn" class="btn btn-outline" style="padding: var(--space-xs) var(--space-sm); font-size: 12px; min-height: auto;">Logout</button>
      </div>
      <button id="login-toggle-btn" class="btn btn-outline" style="padding: var(--space-sm) var(--space-md); font-size: 13px; min-height: 44px;">Login</button>
    </div>
  </header>

  <main id="main-content">
    <!-- SHOP SECTION -->
    <section id="shop-section" class="section active">
      <div class="page-container">
        <!-- Hero Banner Section -->
        <div class="hero-section">
          <div class="hero-content">
            <img class="hero-logo" src="assets/ZipMetroLogoRemoveBG (1).png" alt="ZipMetro" />
            <h1 class="hero-headline">Same-Day Delivery<br/>Age-Verified & Secure</h1>
            <p class="hero-subheadline">Premium cannabis products delivered to your door. Fast, discreet, and fully compliant.</p>
          </div>
        </div>
        
        <!-- Carousel will be inserted here by JavaScript -->
        <div id="carousel-container"></div>
        
        <!-- Categories - positioned after carousel -->
        <div class="category-list-container" style="margin-bottom: var(--space-lg);">
          <h3>Categories</h3>
          <ul class="category-list" id="category-list">
            <li class="category-item active" data-category="Flower">Flower</li>
            <li class="category-item" data-category="Vape">Vape</li>
            <li class="category-item" data-category="Extracts">Extracts</li>
            <li class="category-item" data-category="Edibles">Edibles</li>
          </ul>
        </div>

        <div class="filter-block" style="margin-bottom: var(--space-xl);">
          <div style="margin-bottom: 6px;">Search products</div>
          <input id="search-input" class="search-input" placeholder="Type to filter" />
        </div>
        
        <div class="products-grid" id="products-grid"></div>

        <!-- Reviews Section -->
        <div class="reviews-section">
          <h3>What Our Customers Say</h3>
          <div class="review-item">
            <div class="review-header">
              <span class="review-author">Sarah M.</span>
              <span class="review-rating"></span>
            </div>
            <div class="review-text">
              Fast delivery and great selection. The ordering process was smooth and my order arrived exactly when promised.
            </div>
          </div>
          <div class="review-item">
            <div class="review-header">
              <span class="review-author">Mike T.</span>
              <span class="review-rating"></span>
            </div>
            <div class="review-text">
              Professional service and quality products. Highly recommend for anyone looking for reliable cannabis delivery.
            </div>
          </div>
        </div>
      </div>
      </section>

      <!-- CART SECTION -->
      <section id="cart-section" class="section">
        <div class="page-container">
        <h2>Checkout</h2>
        
        <!-- Checkout Steps Progress -->
        <div class="checkout-steps">
          <div class="checkout-step active" data-step="1">
            <div class="checkout-step-number">1</div>
            <div class="checkout-step-label">Cart</div>
          </div>
          <div class="checkout-step-line"></div>
          <div class="checkout-step" data-step="2">
            <div class="checkout-step-number">2</div>
            <div class="checkout-step-label">Delivery</div>
          </div>
          <div class="checkout-step-line"></div>
          <div class="checkout-step" data-step="3">
            <div class="checkout-step-number">3</div>
            <div class="checkout-step-label">Confirmation</div>
          </div>
        </div>

        <div class="two-col">
          <div class="stack" style="flex: 1;">
            <!-- Step 1: Cart Review -->
            <div class="checkout-step-content active" id="checkout-step-1">
              <div class="card">
                <h3>Review Your Cart</h3>
                <div id="cart-items"></div>
                <div class="row" style="justify-content: space-between; margin-top: var(--space-lg); padding-top: var(--space-lg); border-top: 1px solid var(--border-light);">
                  <span style="font-size: 18px; font-weight: 700;">Total: <strong id="cart-total">$0.00</strong></span>
                  <button class="btn btn-outline" id="clear-cart-btn">Clear cart</button>
                </div>
                <button class="btn btn-primary" id="checkout-continue-1" style="width: 100%; margin-top: var(--space-lg); min-height: var(--touch-target-lg);">Continue to Delivery</button>
              </div>
            </div>

            <!-- Step 2: Delivery Details -->
            <div class="checkout-step-content" id="checkout-step-2">
              <div class="card">
                <h3>Delivery Details</h3>
                <form id="checkout-form" class="stack">
                  <div class="form-group">
                    <label for="checkout-name">Full name <span style="color: #ff4444;">*</span></label>
                    <input id="checkout-name" type="text" placeholder="Customer name" required autocomplete="name" />
                    <span class="form-error" id="checkout-name-error"></span>
                  </div>
                  
                  <div class="form-group">
                    <label for="checkout-phone">Phone <span style="color: #ff4444;">*</span></label>
                    <input id="checkout-phone" type="tel" placeholder="(555) 555-5555" required autocomplete="tel" />
                    <span class="form-error" id="checkout-phone-error"></span>
                  </div>
                  
                  <div class="form-group">
                    <label for="checkout-address">Delivery address <span style="color: #ff4444;">*</span></label>
                    <input id="checkout-address" type="text" placeholder="Start typing your address..." required autocomplete="street-address" />
                    <span class="form-error" id="checkout-address-error"></span>
                    <div class="notice" style="margin-top: var(--space-xs); font-size: 12px;">
                      Address autocomplete ready for Google Places API integration
                    </div>
                  </div>
                  
                  <div class="row">
                    <div class="form-group" style="flex: 1;">
                      <label for="checkout-window">Preferred delivery window <span style="color: #ff4444;">*</span></label>
                      <select id="checkout-window" required>
                        <option value="">Select a time</option>
                        <option value="ASAP">ASAP (6090 min)</option>
                        <option value="Today PM">Today PM</option>
                        <option value="Tonight">Tonight</option>
                      </select>
                      <span class="form-error" id="checkout-window-error"></span>
                    </div>
                    <div class="form-group" style="flex: 1;">
                      <label for="checkout-notes">Order notes (optional)</label>
                      <input id="checkout-notes" type="text" placeholder="Gate code, buzzer, etc." />
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label style="display: flex; align-items: center; gap: var(--space-sm); cursor: pointer;">
                      <input type="checkbox" id="checkout-age-confirm" required style="width: auto; margin: 0;" />
                      <span>I confirm I am 21+ and will present valid ID on delivery. <span style="color: #ff4444;">*</span></span>
                    </label>
                    <span class="form-error" id="checkout-age-confirm-error"></span>
                  </div>
                  
                  <div class="secure-checkout">
                    Secure checkout  Your information is protected
                  </div>
                  
                  <div class="row" style="gap: var(--space-md); margin-top: var(--space-lg);">
                    <button type="button" class="btn btn-outline" id="checkout-back-2" style="flex: 1; min-height: var(--touch-target-lg);">Back</button>
                    <button type="submit" class="btn btn-primary" id="place-order-btn" style="flex: 1; min-height: var(--touch-target-lg);">Place Order</button>
                  </div>
                  
                  <div id="checkout-form-error" class="checkout-error" style="display: none;"></div>
                </form>
              </div>
            </div>

            <!-- Step 3: Confirmation -->
            <div class="checkout-step-content" id="checkout-step-3">
              <div class="checkout-success" id="checkout-success">
                <h3> Order Placed Successfully!</h3>
                <p>Thank you for your order. We'll send you a confirmation email shortly.</p>
                <p style="margin-top: var(--space-md); font-size: 14px; color: var(--text-secondary);">
                  Order #<span id="order-number">-</span>
                </p>
                <div style="margin-top: var(--space-lg);">
                  <button class="btn btn-primary" onclick="switchSection('shop-section')">Continue Shopping</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Order Summary Card (Desktop) -->
          <div class="checkout-summary-card" id="checkout-summary-card">
            <h3>Order Summary</h3>
            <div id="checkout-summary-items"></div>
            <div class="checkout-summary-total">
              <span>Total</span>
              <span id="checkout-summary-total">$0.00</span>
            </div>
          </div>
        </div>
        </div>
      </section>

      <!-- ACCOUNT & ID SECTION -->
      <section id="account-section" class="section">
        <h2>Account & Settings</h2>
        
        <!-- Main Tab Navigation -->
        <div class="tab-container">
          <div class="tab-header" role="tablist">
            <button class="tab-button active" data-tab="account-tab" role="tab" aria-selected="true">Account</button>
            <button class="tab-button" data-tab="id-tab" role="tab" aria-selected="false">ID Upload</button>
            <button class="tab-button" data-tab="notifications-tab" role="tab" aria-selected="false">Notifications</button>
          </div>

          <!-- Account Tab Content -->
          <div id="account-tab" class="tab-content active">
            <!-- Admin Link (only visible to admins) -->
            <div id="admin-account-link" style="display: none; margin-bottom: var(--space-lg);">
              <div class="card">
                <div style="display: flex; align-items: center; justify-content: space-between;">
                  <div>
                    <h3 style="margin: 0 0 var(--space-xs) 0;">Admin Panel</h3>
                    <p class="text-muted" style="margin: 0; font-size: 14px;">Manage products, carousel, and settings</p>
                  </div>
                  <button class="btn btn-primary" onclick="switchSection('admin-section')">Go to Admin</button>
                </div>
              </div>
            </div>
            
            <div class="card">
              <h3>Login / Register</h3>
              
              <!-- Account Sub-tabs -->
              <div class="tab-header" style="margin-top: var(--space-md); margin-bottom: var(--space-lg);">
                <button class="tab-button active" data-subtab="login-subtab" style="font-size: 14px; padding: var(--space-sm) var(--space-lg);">Login</button>
                <button class="tab-button" data-subtab="register-subtab" style="font-size: 14px; padding: var(--space-sm) var(--space-lg);">Register</button>
              </div>

              <!-- Login Sub-tab -->
              <div id="login-subtab" class="tab-content active">
                <form class="stack" style="gap: var(--space-lg);">
                  <div class="form-group">
                    <label for="login-email">Email</label>
                    <input id="login-email" type="email" placeholder="admin@zipmetro.com" autocapitalize="off" autocomplete="email" />
                  </div>
                  <div class="form-group">
                    <label for="login-password">Password</label>
                    <input id="login-password" type="password" placeholder="Password" autocapitalize="off" autocomplete="current-password" />
                  </div>
                  <button type="button" class="btn btn-primary" id="login-btn" style="width: 100%; margin-top: var(--space-md);">Login</button>
                  <div id="login-status" class="text-muted"></div>
                </form>
                <div class="notice" style="margin-top: var(--space-lg);">
                  <strong>Default Admin:</strong> admin@zipmetro.com / admin123
                </div>
              </div>

              <!-- Register Sub-tab -->
              <div id="register-subtab" class="tab-content">
                <form class="stack" style="gap: var(--space-lg);">
                  <div class="form-group">
                    <label for="register-email">Email</label>
                    <input id="register-email" type="email" placeholder="your@email.com" autocapitalize="off" autocomplete="email" />
                  </div>
                  <div class="form-group">
                    <label for="register-password">Password</label>
                    <input id="register-password" type="password" placeholder="Password" autocapitalize="off" autocomplete="new-password" />
                  </div>
                  <div class="form-row">
                    <div class="form-group">
                      <label for="register-first-name">First Name</label>
                      <input id="register-first-name" type="text" placeholder="First name" autocomplete="given-name" />
                    </div>
                    <div class="form-group">
                      <label for="register-last-name">Last Name</label>
                      <input id="register-last-name" type="text" placeholder="Last name" autocomplete="family-name" />
                    </div>
                  </div>
                  <button type="button" class="btn btn-outline" id="register-btn" style="width: 100%; margin-top: var(--space-md);">Register</button>
                  <div id="register-status" class="text-muted"></div>
                </form>
              </div>
            </div>
          </div>

          <!-- ID Upload Tab Content -->
          <div id="id-tab" class="tab-content">
            <div class="card">
              <h3>Upload ID (one-time)</h3>
              <div class="stack" style="gap: var(--space-lg);">
                <div class="form-row">
                  <div class="form-group">
                    <label for="id-first-name">First name</label>
                    <input id="id-first-name" type="text" autocomplete="given-name" />
                  </div>
                  <div class="form-group">
                    <label for="id-last-name">Last name</label>
                    <input id="id-last-name" type="text" autocomplete="family-name" />
                  </div>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="id-dob">Date of birth</label>
                    <input id="id-dob" type="date" autocomplete="bday" />
                  </div>
                  <div class="form-group">
                    <label for="id-type">ID type</label>
                    <select id="id-type">
                      <option value="Drivers license">Driver's license</option>
                      <option value="State ID">State ID</option>
                      <option value="Passport">Passport</option>
                    </select>
                  </div>
                </div>
                <div class="form-group">
                  <label for="id-file">Upload ID image (front)</label>
                  <input id="id-file" type="file" accept="image/*" style="padding: var(--space-md);" />
                </div>
                <div class="checkbox-group">
                  <input type="checkbox" id="id-consent" />
                  <label for="id-consent">
                    I consent to ZipMetro storing my ID for age verification in compliance with local laws.
                  </label>
                </div>
                <button class="btn btn-primary" id="submit-id-btn" style="width: 100%;">Submit ID</button>
                <div id="id-status" class="text-muted"></div>
                <div class="notice">
                  In a real app this would hit a secure backend + KYC/ID verification service,
                  with proper encryption and retention rules.
                </div>
              </div>
            </div>
          </div>

          <!-- Notifications Tab Content -->
          <div id="notifications-tab" class="tab-content">
            <div class="card">
              <h3>Notification Preferences</h3>
              <div class="stack" style="gap: var(--space-lg);">
                <div>
                  <div class="toggle-item">
                    <label class="toggle-switch">
                      <input type="checkbox" id="notif-sms-toggle" checked />
                      <span class="toggle-slider"></span>
                    </label>
                    <div style="flex: 1;">
                      <div class="toggle-label">SMS Notifications</div>
                      <div class="toggle-description">Receive order updates via text message</div>
                    </div>
                  </div>
                  <div class="toggle-item">
                    <label class="toggle-switch">
                      <input type="checkbox" id="notif-email-toggle" checked />
                      <span class="toggle-slider"></span>
                    </label>
                    <div style="flex: 1;">
                      <div class="toggle-label">Email Notifications</div>
                      <div class="toggle-description">Receive order updates via email</div>
                    </div>
                  </div>
                  <div class="toggle-item">
                    <label class="toggle-switch">
                      <input type="checkbox" id="notif-push-toggle" />
                      <span class="toggle-slider"></span>
                    </label>
                    <div style="flex: 1;">
                      <div class="toggle-label">Push Notifications</div>
                      <div class="toggle-description">Receive push notifications in the app</div>
                    </div>
                  </div>
                </div>
                <button class="btn btn-primary" id="save-notif-btn" style="width: 100%;">Save Preferences</button>
                <div id="notif-status" class="text-muted"></div>
                <div class="notice">
                  <strong>These preferences will be used for:</strong>
                  <ul style="margin: 8px 0 0 20px; padding: 0;">
                    <li>Order status: received, out for delivery, delivered</li>
                    <li>Critical updates: driver delays, address issues</li>
                    <li>Optional promos (if enabled in admin)</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- ADMIN SECTION -->
      <section id="admin-section" class="section">
        <div class="page-container">
        <h2>Admin  ZipMetro Control</h2>
        <p class="text-muted" style="margin-bottom: var(--space-xl); font-size: 16px; line-height: 1.6;">This is a front-end-only admin stub. In production this would be behind auth and wired to your backend.</p>

        <div class="stack">
          <div class="card">
            <h3>Carousel Banner Management</h3>
            <div class="stack" style="gap: var(--space-xl);">
              <div id="carousel-slides-admin">
                <!-- Slides will be dynamically added here -->
              </div>
              <button class="btn btn-outline" id="add-carousel-slide-btn" style="width: 100%;">Add New Slide</button>
              <button class="btn btn-primary" id="save-carousel-btn" style="width: 100%;">Save Carousel Banners</button>
              <div id="carousel-status" class="text-muted"></div>
              <div class="notice">
                Upload images and set content for the carousel banners displayed above products. You can add up to 5 slides.
              </div>
            </div>
          </div>

          <div class="card">
            <h3>Product catalog (demo)</h3>
            <div style="margin-bottom:10px;">
              <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom: var(--space-md);">
                <input id="admin-new-name" placeholder="Name" style="min-width:160px;" />
                <select id="admin-new-category">
                  <option value="Flower">Flower</option>
                  <option value="Vape">Vape</option>
                  <option value="Extracts">Extracts</option>
                  <option value="Edibles">Edibles</option>
                </select>
                <input id="admin-new-price" placeholder="Price" type="number" style="width:100px;" />
                <input id="admin-new-thc" placeholder="THC mg" type="number" style="width:100px;" />
              </div>
              <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom: var(--space-md);">
                <div style="flex: 1; min-width: 200px;">
                  <label style="display: block; margin-bottom: var(--space-xs); font-size: 13px; font-weight: 600;">Upload Image</label>
                  <input id="admin-new-image-file" type="file" accept="image/*" style="width: 100%; padding: var(--space-sm);" />
                  <div id="image-preview" style="margin-top: var(--space-sm); display: none;">
                    <img id="preview-img" src="" alt="Preview" style="max-width: 200px; max-height: 150px; border-radius: var(--radius-md); border: 1px solid var(--border-light);" />
                    <button type="button" id="remove-preview" class="btn btn-outline" style="margin-top: var(--space-xs); padding: var(--space-xs) var(--space-sm); font-size: 12px;">Remove</button>
                  </div>
                </div>
                <div style="flex: 1; min-width: 200px;">
                  <label style="display: block; margin-bottom: var(--space-xs); font-size: 13px; font-weight: 600;">Or Enter Image URL</label>
                  <input id="admin-new-image-url" placeholder="Image URL (optional)" style="width: 100%;" />
                </div>
              </div>
              <button class="btn btn-primary" id="add-product-btn">Add product</button>
            </div>
            <table class="table" id="admin-products-table">
              <thead>
                <tr>
                  <th>Name</th>
                  <th>Category</th>
                  <th>THC mg</th>
                  <th>Price</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <!-- Populated from JS -->
              </tbody>
            </table>
            <div class="notice">
              In production this table would be editable with create/update/delete actions,
              plus inventory counts and store/brand associations.
            </div>
            </div>
          </div>
        </div>
        </div>
      </section>
    </main>
  </div>
  <!-- End AppShell -->

  <div id="toast" class="toast" aria-live="polite" hidden></div>

  <script>
    // Handle missing logo image - hide container if image fails to load
    (function() {
      const brandLogo = document.querySelector('.brand-logo');
      const brandLink = document.querySelector('.brand-link');
      
      if (brandLogo && brandLink) {
        // Check if image src is empty or invalid
        if (!brandLogo.src || brandLogo.src.includes('undefined') || brandLogo.src.includes('null') || brandLogo.src === window.location.href) {
          brandLink.style.display = 'none';
        }
        
        // Handle image load error
        brandLogo.addEventListener('error', function() {
          brandLink.style.display = 'none';
        });
        
        // Handle successful image load
        brandLogo.addEventListener('load', function() {
          brandLink.style.display = 'inline-flex';
        });
      }
    })();
  </script>

  <script>
    // Development-only layout shift debug helper
    // Only runs in development (localhost or when ?debug=layout-shift is in URL)
    (function() {
      // Check if we're in development mode
      const isDev = window.location.hostname === 'localhost' || 
                    window.location.hostname === '127.0.0.1' ||
                    window.location.hostname.includes('localhost') ||
                    new URLSearchParams(window.location.search).has('debug') ||
                    window.location.search.includes('layout-shift');
      
      // Don't run in production
      if (!isDev) return;
      
      // Check if PerformanceObserver is supported
      if (!('PerformanceObserver' in window)) {
        console.warn('[Layout Shift Debug] PerformanceObserver not supported');
        return;
      }
      
      let cumulativeShift = 0;
      let shiftCount = 0;
      
      try {
        const observer = new PerformanceObserver((list) => {
          for (const entry of list.getEntries()) {
            // Only log layout shifts (not other performance entries)
            if (entry.entryType !== 'layout-shift' || entry.hadRecentInput) {
              continue;
            }
            
            const value = entry.value;
            cumulativeShift += value;
            shiftCount++;
            
            // Try to identify the element causing the shift
            let elementInfo = 'Unknown element';
            if (entry.sources && entry.sources.length > 0) {
              const source = entry.sources[0];
              if (source.node) {
                // Get element selector
                elementInfo = getElementSelector(source.node);
                
                // Also log the source type
                if (source.previousRect && source.currentRect) {
                  const width = source.currentRect.width;
                  const height = source.currentRect.height;
                  elementInfo += ` (${Math.round(width)}x${Math.round(height)}px)`;
                }
              }
            }
            
            // Log the layout shift
            console.group(`[Layout Shift #${shiftCount}] CLS: ${value.toFixed(4)}`);
            console.log('Element:', elementInfo);
            console.log('Cumulative CLS:', cumulativeShift.toFixed(4));
            console.log('Entry:', entry);
            console.groupEnd();
          }
        });
        
        observer.observe({ entryTypes: ['layout-shift'] });
        
        // Log summary on page unload
        window.addEventListener('beforeunload', () => {
          if (shiftCount > 0) {
            console.log(`[Layout Shift Debug] Total shifts: ${shiftCount}, Cumulative CLS: ${cumulativeShift.toFixed(4)}`);
          }
        });
        
        console.log('[Layout Shift Debug] Enabled - monitoring layout shifts...');
      } catch (error) {
        console.error('[Layout Shift Debug] Error:', error);
      }
      
      // Helper function to generate element selector
      function getElementSelector(element) {
        if (!element || !element.tagName) return 'Unknown';
        
        // Try to get a unique selector
        if (element.id) {
          return `#${element.id}`;
        }
        
        if (element.className && typeof element.className === 'string') {
          const classes = element.className.trim().split(/\s+/).filter(c => c);
          if (classes.length > 0) {
            return `.${classes[0]}`;
          }
        }
        
        // Fallback to tag name
        let selector = element.tagName.toLowerCase();
        
        // Add parent context if available
        if (element.parentElement) {
          const parentTag = element.parentElement.tagName.toLowerCase();
          selector = `${parentTag} > ${selector}`;
        }
        
        return selector;
      }
    })();
  </script>

  <!-- Mini-Cart Slide-Out -->
  <div id="mini-cart" class="mini-cart" aria-modal="true" role="dialog" aria-label="Shopping cart" hidden>
    <div class="mini-cart-header">
      <h3>Your Cart</h3>
      <button class="mini-cart-close" id="mini-cart-close" aria-label="Close cart"></button>
    </div>
    <div class="mini-cart-body" id="mini-cart-body">
      <!-- Cart items will be rendered here by JavaScript -->
    </div>
    <div class="mini-cart-footer" id="mini-cart-footer">
      <div class="mini-cart-subtotal">
        <span class="mini-cart-subtotal-label">Subtotal</span>
        <span class="mini-cart-subtotal-value" id="mini-cart-total">$0.00</span>
      </div>
      <button class="btn btn-primary" id="mini-cart-checkout">Proceed to Checkout</button>
    </div>
  </div>
  <div id="mini-cart-overlay" class="mini-cart-overlay" hidden></div>

  <!-- mobile-bar removed - using AppFooter (BottomNav) instead -->
  <button id="mobile-view-cart-cta" class="mobile-view-cart-cta" hidden>
    View Cart (<span id="mobile-view-cart-count">0</span>)
  </button>

  <script>
    // Mobile nav toggle removed - nav is always visible

    // Toast micro-interaction: shows a small dismissible notification
    function showToast(message, actionLabel, actionCallback, timeout = 4500){
      const el = document.getElementById('toast');
      if(!el) return;
      el.hidden = false;
      el.innerHTML = `
        <div class="toast-body" style="font-size:13px; line-height:1.2;">${message}</div>
        <div class="toast-actions">
          <button id="toast-close" class="btn btn-outline">Close</button>
          <button id="toast-action" class="btn btn-primary">${actionLabel || 'OK'}</button>
        </div>
      `;
      // animate in
      requestAnimationFrame(()=> el.classList.add('show'));

      function cleanup(){
        el.classList.remove('show');
        setTimeout(()=>{ el.hidden = true; el.innerHTML = ''; }, 260);
      }

      document.getElementById('toast-close').addEventListener('click', cleanup, { once: true });
      document.getElementById('toast-action').addEventListener('click', ()=>{ try{ actionCallback && actionCallback(); } catch(e){} cleanup(); }, { once: true });
      // auto-dismiss
      setTimeout(()=>{ cleanup(); }, timeout);
    }
    // products are loaded from the backend API (products.json) on startup
    let products = [];

    // fallback dataset - 3 example products per category with cannabis/edible images
    const fallbackProducts = [
      // FLOWER - 3 cannabis flower products
      { id: 1, name: "Purple Haze", category: "Flower", desc: "Classic sativa  Uplifting and energizing with sweet berry notes.", price: 42, thc: 24, image: "https://picsum.photos/seed/purple-haze/800/440" },
      { id: 2, name: "Blue Dream", category: "Flower", desc: "Balanced hybrid  Relaxing body high with creative mental clarity.", price: 48, thc: 26, image: "https://picsum.photos/seed/blue-dream/800/440" },
      { id: 3, name: "OG Kush", category: "Flower", desc: "Indica-dominant  Deep relaxation with earthy, pine flavors.", price: 50, thc: 28, image: "https://picsum.photos/seed/og-kush/800/440" },

      // VAPE - 3 products
      { id: 4, name: "Electric Haze Vape 1g", category: "Vape", desc: "Sativa cart  citrus & pine, day-time vibes.", price: 35, thc: 90, image: "https://picsum.photos/seed/electric-haze/800/440" },
      { id: 5, name: "Night Drive Live Resin Cart", category: "Vape", desc: "Full-spectrum live resin  terp heavy.", price: 48, thc: 88, image: "https://picsum.photos/seed/night-drive/800/440" },
      { id: 6, name: "Citrus Rush Cart", category: "Vape", desc: "Energetic sativa-forward cartridge.", price: 36, thc: 92, image: "https://picsum.photos/seed/citrus-rush/800/440" },

      // EXTRACTS - 3 products
      { id: 7, name: "Guava Punch Live Rosin", category: "Extracts", desc: "Cold-cured rosin  fruit forward and loud.", price: 65, thc: 76, image: "https://picsum.photos/seed/guava-punch/800/440" },
      { id: 8, name: "Diamond Sauce  Metro Fuel", category: "Extracts", desc: "High potency diamonds in terp sauce.", price: 70, thc: 82, image: "https://picsum.photos/seed/diamond-sauce/800/440" },
      { id: 9, name: "Crystal Shatter", category: "Extracts", desc: "High-clarity shatter for potency seekers.", price: 68, thc: 85, image: "https://picsum.photos/seed/crystal-shatter/800/440" },

      // EDIBLES - 3 products
      { id: 10, name: "Metro Mango Gummies 100mg", category: "Edibles", desc: "10 x 10mg pieces  mellow mango flavor.", price: 18, thc: 100, image: "https://picsum.photos/seed/mango-gummies/800/440" },
      { id: 11, name: "NightCap Chocolates 200mg", category: "Edibles", desc: "8 x 25mg  rich dark chocolate squares.", price: 24, thc: 200, image: "https://picsum.photos/seed/nightcap-choco/800/440" },
      { id: 12, name: "Berry Blast Gummies 150mg", category: "Edibles", desc: "15 x 10mg  tangy berry mix.", price: 26, thc: 150, image: "https://picsum.photos/seed/berry-blast/800/440" }
    ];

    async function loadProductsFromApi(){
      try{
        const res = await fetch('/api/products');
        if(!res.ok) throw new Error('Failed loading products');
        const apiProducts = await res.json();
        
        // Merge API products with fallback products
        // Use API products when available, otherwise use fallback for missing categories
        const apiProductsByCategory = {};
        apiProducts.forEach(p => {
          if (!apiProductsByCategory[p.category]) {
            apiProductsByCategory[p.category] = [];
          }
          apiProductsByCategory[p.category].push(p);
        });
        
        // Build merged products array
        products = [];
        const categories = ['Flower', 'Vape', 'Extracts', 'Edibles'];
        
        categories.forEach(category => {
          if (apiProductsByCategory[category] && apiProductsByCategory[category].length > 0) {
            // Use API products for this category
            products.push(...apiProductsByCategory[category]);
          } else {
            // Use fallback products for this category
            const fallbackForCategory = fallbackProducts.filter(p => p.category === category);
            products.push(...fallbackForCategory);
          }
        });
        
        console.log('Loaded products:', products.length, 'across', categories.length, 'categories');
      }catch(e){
        console.warn('Could not load products from API, falling back to client dataset.', e);
        products = fallbackProducts.slice();
      }
      renderProducts();
      renderAdminProducts();
      updateCartIndicator();
    }

    // Shared Navigation Configuration (Single Source of Truth)
    const navItems = [
      { 
        id: 'shop-section', 
        label: 'Shop', 
        icon: `<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline>`,
        showForRole: null // Show for all users
      },
      { 
        id: 'cart-section', 
        label: 'Cart', 
        icon: `<circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>`,
        showForRole: null // Show for all users
      },
      { 
        id: 'account-section', 
        label: 'Account', 
        icon: `<path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle>`,
        showForRole: null // Show for all users
      },
      { 
        id: 'admin-section', 
        label: 'Admin', 
        icon: `<path d="M12 2L2 7l10 5 10-5-10-5z"></path><path d="M2 17l10 5 10-5M2 12l10 5 10-5"></path>`,
        showForRole: 'admin' // Show only for admin users
      }
    ];

    let cart = [];
    let currentCategory = "Flower";
    let notifPrefs = { sms: true, email: true, push: false };
    let currentUser = null;
    let authToken = localStorage.getItem('authToken');

    // Auth helpers
    async function getAuthHeaders() {
      const token = localStorage.getItem('authToken');
      const headers = { 'Content-Type': 'application/json' };
      if (token) {
        headers['Authorization'] = `Bearer ${token}`;
      }
      return headers;
    }

    async function checkAuth() {
      const token = localStorage.getItem('authToken');
      if (!token) {
        updateUserStatus();
        return false;
      }
      try {
        const res = await fetch('/api/auth/verify', { 
          headers: { 'Authorization': `Bearer ${token}` },
          credentials: 'include'
        });
        if (res.ok) {
          const data = await res.json();
          currentUser = data.user;
          updateUserStatus();
          return true;
        }
      } catch (e) {
        console.error('Auth check failed:', e);
      }
      localStorage.removeItem('authToken');
      currentUser = null;
      updateUserStatus();
      return false;
    }

    function updateUserStatus() {
      const userStatus = document.getElementById('user-status');
      const loginBtn = document.getElementById('login-toggle-btn');
      const userEmail = document.getElementById('user-email');
      const loginSection = document.getElementById('login-register-section');
      const adminAccountLink = document.getElementById('admin-account-link');
      
      if (currentUser) {
        userStatus.style.display = 'flex';
        loginBtn.style.display = 'none';
        userEmail.textContent = currentUser.email + (currentUser.role === 'admin' ? ' (Admin)' : '');
        if (loginSection) {
          loginSection.style.display = 'none';
        }
        
        // Show/hide admin navigation based on role
        if (currentUser.role === 'admin') {
          if (adminAccountLink) adminAccountLink.style.display = 'block';
        } else {
          if (adminAccountLink) adminAccountLink.style.display = 'none';
        }
      } else {
        userStatus.style.display = 'none';
        loginBtn.style.display = 'inline-flex';
        if (loginSection) {
          loginSection.style.display = 'block';
        }
        // Hide admin elements when logged out
        if (adminAccountLink) adminAccountLink.style.display = 'none';
      }
      
      // Re-render navigation to reflect role changes
      renderTopNav();
      renderBottomNav();
    }

    async function login(email, password) {
      const statusEl = document.getElementById('login-status');
      statusEl.textContent = 'Connecting...';
      statusEl.style.color = 'var(--text-secondary)';
      
      try {
        const res = await fetch('/api/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password }),
          credentials: 'include'
        });
        
        if (res.ok) {
          const data = await res.json();
          localStorage.setItem('authToken', data.token);
          currentUser = data.user;
          updateUserStatus();
          showToast('Logged in successfully!', 'OK');
          statusEl.textContent = 'Login successful!';
          statusEl.style.color = 'var(--primary)';
          document.getElementById('login-email').value = '';
          document.getElementById('login-password').value = '';
          // If user was trying to access admin, redirect them if not admin
          const activeSection = document.querySelector('.section.active');
          if (activeSection && activeSection.id === 'admin-section' && currentUser.role !== 'admin') {
            switchSection('shop-section');
          }
          return true;
        } else {
          let errorMessage = 'Unknown error';
          try {
            const error = await res.json();
            errorMessage = error.error || `HTTP ${res.status}`;
          } catch (e) {
            errorMessage = `HTTP ${res.status} - ${res.statusText}`;
          }
          statusEl.textContent = 'Login failed: ' + errorMessage;
          statusEl.style.color = 'var(--accent)';
          return false;
        }
      } catch (e) {
        console.error('Login error:', e);
        let errorMessage = e.message;
        
        // Provide more helpful error messages
        if (e.message.includes('Failed to fetch') || e.message.includes('NetworkError')) {
          errorMessage = 'Cannot connect to server. Make sure the server is running on port 3001.';
        } else if (e.message.includes('CORS')) {
          errorMessage = 'CORS error. Check server configuration.';
        }
        
        statusEl.textContent = 'Login failed: ' + errorMessage;
        statusEl.style.color = 'var(--accent)';
        return false;
      }
    }

    async function register(email, password, firstName, lastName) {
      const statusEl = document.getElementById('register-status');
      statusEl.textContent = 'Connecting...';
      statusEl.style.color = 'var(--text-secondary)';
      
      try {
        const res = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, password, first_name: firstName, last_name: lastName }),
          credentials: 'include'
        });
        
        if (res.ok || res.status === 201) {
          const data = await res.json();
          localStorage.setItem('authToken', data.token);
          currentUser = data.user;
          updateUserStatus();
          showToast('Registration successful!', 'OK');
          statusEl.textContent = 'Registration successful!';
          statusEl.style.color = 'var(--primary)';
          document.getElementById('register-email').value = '';
          document.getElementById('register-password').value = '';
          document.getElementById('register-first-name').value = '';
          document.getElementById('register-last-name').value = '';
          return true;
        } else {
          let errorMessage = 'Unknown error';
          try {
            const error = await res.json();
            errorMessage = error.error || `HTTP ${res.status}`;
          } catch (e) {
            errorMessage = `HTTP ${res.status} - ${res.statusText}`;
          }
          statusEl.textContent = 'Registration failed: ' + errorMessage;
          statusEl.style.color = 'var(--accent)';
          return false;
        }
      } catch (e) {
        console.error('Register error:', e);
        let errorMessage = e.message;
        
        if (e.message.includes('Failed to fetch') || e.message.includes('NetworkError')) {
          errorMessage = 'Cannot connect to server. Make sure the server is running on port 3001.';
        } else if (e.message.includes('CORS')) {
          errorMessage = 'CORS error. Check server configuration.';
        }
        
        statusEl.textContent = 'Registration failed: ' + errorMessage;
        statusEl.style.color = 'var(--accent)';
        return false;
      }
    }

    function logout() {
      localStorage.removeItem('authToken');
      currentUser = null;
      updateUserStatus();
      showToast('Logged out successfully', 'OK');
    }

    // Initialize auth on load (this will call updateUserStatus which re-renders nav)
    checkAuth();
    
    // Ensure navigation is initialized after auth check
    // Navigation will be re-rendered by updateUserStatus when auth state is determined

    // --- Helpers -----------------------------------------------------------
    function formatMoney(v) {
      return "$" + v.toFixed(2);
    }

    function updateCartIndicator() {
      const count = cart.reduce((sum, item) => sum + item.qty, 0);
      document.getElementById("cart-count").textContent = count;
      const mobile = document.getElementById('mobile-cart-count');
      if(mobile) mobile.textContent = count;
    }

    function renderProducts() {
      const grid = document.getElementById("products-grid");
      const query = document.getElementById("search-input").value.toLowerCase().trim();

      const filtered = products.filter(p =>
        p.category === currentCategory &&
        (!query || p.name.toLowerCase().includes(query) || p.desc.toLowerCase().includes(query))
      );

      grid.innerHTML = "";
      if (!filtered.length) {
        grid.innerHTML = "<div class='text-muted'>No products match that search in this category.</div>";
        return;
      }

      // Insert responsive carousel hero above the categories
      const existingHero = document.querySelector('.hero-carousel');
      const carouselContainer = document.getElementById('carousel-container');
      if(!existingHero && carouselContainer){
        const carousel = document.createElement('div');
        carousel.className = 'hero-carousel';
        carousel.setAttribute('role', 'region');
        carousel.setAttribute('aria-label', 'Promotions');
        carousel.innerHTML = `
          <div class="carousel-slides" aria-live="polite"></div>
          <div class="carousel-controls">
            <button class="carousel-btn prev" aria-label="Previous slide"></button>
            <button class="carousel-btn next" aria-label="Next slide"></button>
          </div>
          <div class="carousel-indicators" role="tablist"></div>
        `;
        carouselContainer.appendChild(carousel);

        // Load slides from localStorage or use defaults
        const savedSlides = JSON.parse(localStorage.getItem('carouselSlides') || '[]');
        const slides = savedSlides.length > 0 ? savedSlides : [
          { img: 'https://picsum.photos/seed/promo1/1200/420', title: 'Weekend Special', subtitle: '20% off selected strains  Code WEEKEND', cta: 'Shop deals' },
          { img: 'https://picsum.photos/seed/promo2/1200/420', title: 'Free Delivery', subtitle: 'Free delivery over $75 this week only', cta: 'Learn more' },
          { img: 'https://picsum.photos/seed/promo3/1200/420', title: 'New Arrivals', subtitle: 'Fresh live rosin and new gummies', cta: 'Browse new' }
        ];

        const slidesEl = carousel.querySelector('.carousel-slides');
        const indicatorsEl = carousel.querySelector('.carousel-indicators');
        let currentIndex = 0;
        let autoRotateInterval = null;

        // Create slides
        slides.forEach((s, i) => {
          const sl = document.createElement('div');
          sl.className = `carousel-slide ${i === 0 ? 'active' : ''}`;
          sl.innerHTML = `
            <div class="slide-media skeleton"><img src="${s.img}" alt="${s.title}" loading="lazy"/></div>
            <div class="slide-body">
              <div class="slide-title">${s.title}</div>
              <div class="slide-sub">${s.subtitle}</div>
              <div class="slide-cta"><button class="btn cta">${s.cta}</button></div>
            </div>
          `;
          sl.dataset.index = i;
          slidesEl.appendChild(sl);

          // Create indicator
          const indicator = document.createElement('button');
          indicator.className = `carousel-indicator ${i === 0 ? 'active' : ''}`;
          indicator.setAttribute('role', 'tab');
          indicator.setAttribute('aria-label', `Go to slide ${i + 1}`);
          indicator.dataset.index = i;
          indicatorsEl.appendChild(indicator);
        });

        // Update slide visibility
        function updateSlides() {
          slidesEl.querySelectorAll('.carousel-slide').forEach((slide, i) => {
            slide.classList.remove('active', 'prev', 'next');
            if (i === currentIndex) {
              slide.classList.add('active');
            } else if (i < currentIndex) {
              slide.classList.add('prev');
            } else {
              slide.classList.add('next');
            }
          });

          // Update indicators
          indicatorsEl.querySelectorAll('.carousel-indicator').forEach((indicator, i) => {
            indicator.classList.toggle('active', i === currentIndex);
          });
        }

        // Navigate functions
        function goToSlide(index) {
          currentIndex = (index + slides.length) % slides.length;
          updateSlides();
          resetAutoRotate();
        }

        function nextSlide() {
          goToSlide(currentIndex + 1);
        }

        function prevSlide() {
          goToSlide(currentIndex - 1);
        }

        // Auto-rotate
        function startAutoRotate() {
          autoRotateInterval = setInterval(nextSlide, 5000); // Change slide every 5 seconds
        }

        function resetAutoRotate() {
          if (autoRotateInterval) {
            clearInterval(autoRotateInterval);
          }
          startAutoRotate();
        }

        // Event listeners
        carousel.querySelector('.carousel-btn.next').addEventListener('click', () => {
          nextSlide();
        });

        carousel.querySelector('.carousel-btn.prev').addEventListener('click', () => {
          prevSlide();
        });

        indicatorsEl.querySelectorAll('.carousel-indicator').forEach((indicator) => {
          indicator.addEventListener('click', () => {
            goToSlide(parseInt(indicator.dataset.index));
          });
        });

        // Pause auto-rotate on hover
        carousel.addEventListener('mouseenter', () => {
          if (autoRotateInterval) {
            clearInterval(autoRotateInterval);
          }
        });

        carousel.addEventListener('mouseleave', () => {
          startAutoRotate();
        });

        // Initialize
        updateSlides();
        startAutoRotate();

        // Handle image loading
        slidesEl.querySelectorAll('.slide-media img').forEach(img => {
          img.addEventListener('load', () => {
            img.closest('.slide-media')?.classList.remove('skeleton');
            img.style.opacity = '1';
          });
          img.style.opacity = '0';
        });
      }

      // small helper: create an inline SVG placeholder as data URL (fallback)
      function svgPlaceholder(text, w=600, h=360, id=0){
        const bg1 = ['#0f1724','#04263a','#102030','#0b2330'][id % 4];
        const bg2 = ['#071029','#052037','#081623','#071223'][id % 4];
        const safe = text.replace(/&/g,'%26').replace(/#/g,'%23');
        const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='${w}' height='${h}' viewBox='0 0 ${w} ${h}'>`+
          `<defs><linearGradient id='g${id}' x1='0' x2='1'><stop offset='0' stop-color='${bg1}'/><stop offset='1' stop-color='${bg2}'/></linearGradient></defs>`+
          `<rect width='100%' height='100%' fill='url(#g${id})'/>`+
          `<text x='50%' y='52%' dominant-baseline='middle' text-anchor='middle' font-family='Arial, Helvetica, sans-serif' font-size='32' fill='rgba(230,238,248,0.95)'>${safe}</text>`+
        `</svg>`;
        return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
      }

      filtered.forEach(p => {
        const card = document.createElement("div");
        card.className = "card";
        // Ensure cards have proper width on mobile for horizontal scrolling
        if (window.innerWidth <= 767) {
          const viewportWidth = window.innerWidth;
          // Card width: full viewport minus left padding (16px) and right padding (16px) only
          // This ensures one full card is visible at a time with no peek of next card
          const cardWidth = Math.floor(viewportWidth - 32); // 100vw - 2*16px (padding only)
          card.style.flexShrink = '0';
          card.style.width = `${cardWidth}px`;
          card.style.minWidth = `${cardWidth}px`;
          card.style.maxWidth = `${cardWidth}px`;
        }
        const imgUrl = p.image || svgPlaceholder(p.name.split(' ')[0], 800, 440, p.id);
        card.innerHTML = `
          <div class="card-media skeleton" aria-hidden="true">
            <img src="${imgUrl}" alt="${p.name}" loading="lazy" />
          </div>
          <div class="card-info">
            <div class="card-header">
              <div>
                <div class="card-title">${p.name}</div>
                <div class="card-category">${p.category}</div>
              </div>
              <span class="tag">${p.thc} mg THC</span>
            </div>
            <div class="card-desc">${p.desc}</div>
            <div class="card-footer">
              <span class="price">${formatMoney(p.price)}</span>
              <button class="btn btn-primary" data-add-id="${p.id}">Add to cart</button>
            </div>
          </div>
        `;
        // handle image load to remove skeleton and fade in
        grid.appendChild(card);
        const img = card.querySelector('.card-media img');
        if(img){
          img.style.opacity = '0';
          img.addEventListener('load', ()=>{
            const media = card.querySelector('.card-media');
            if(media) media.classList.remove('skeleton');
            img.classList.add('img-loaded');
            img.style.opacity = '1';
          });
        }
      });

      grid.querySelectorAll("[data-add-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = parseInt(btn.getAttribute("data-add-id"), 10);
          const existing = cart.find(i => i.id === id);
          if (existing) existing.qty += 1;
          else cart.push({ id, qty: 1 });
          updateCartIndicator();
          const product = products.find(p => p.id === id);
          showToast(`${product ? product.name : 'Item'} added to cart`, 'View cart', () => switchSection('cart-section'));
        });
      });
      
      // Add swipe/touch functionality for mobile product scrolling
      // Always re-initialize on mobile since products are re-rendered
      if (window.innerWidth <= 767) {
        // Remove any existing handlers by checking if already initialized
        if (grid.dataset.swipeHandlersAdded === 'true') {
          // Grid was recreated, need to re-initialize
          grid.dataset.swipeHandlersAdded = 'false';
        }
        initProductSwipe(grid);
      }
    }
    
    // Initialize swipe functionality for product cards on mobile
    function initProductSwipe(grid) {
      if (!grid) return;
      
      // Skip if already initialized (to avoid duplicate handlers)
      if (grid.dataset.swipeHandlersAdded === 'true') {
        return;
      }
      
      // Mark as initialized to prevent duplicate handlers
      grid.dataset.swipeHandlersAdded = 'true';
      
      // Force flex layout on mobile (in case CSS hasn't applied yet)
      if (window.innerWidth <= 767) {
        grid.style.display = 'flex';
        grid.style.flexDirection = 'row';
        grid.style.flexWrap = 'nowrap';
        grid.style.overflowX = 'auto';
        grid.style.overflowY = 'hidden';
        grid.style.scrollBehavior = 'smooth';
        // Ensure grid takes full width for horizontal scrolling
        const pageContainer = grid.closest('.page-container');
        if (pageContainer) {
          grid.style.width = 'calc(100% + 2 * 16px)'; // Break out of padding
          grid.style.marginLeft = '-16px';
          grid.style.marginRight = '-16px';
        }
      }
      
      let isDown = false;
      let startX;
      let scrollLeft;
      let startY;
      let hasScrolled = false;
      
      // Touch/Mouse start
      const handleStart = (e) => {
        const touch = e.touches ? e.touches[0] : null;
        const clientX = touch ? touch.clientX : e.clientX;
        const clientY = touch ? touch.clientY : e.clientY;
        
        // Check if click is on a button - if so, don't start swipe
        const target = e.target;
        if (target.closest('button') || target.closest('.btn')) {
          return;
        }
        
        isDown = true;
        hasScrolled = false;
        grid.style.cursor = 'grabbing';
        grid.style.scrollBehavior = 'auto';
        startX = clientX - grid.getBoundingClientRect().left;
        startY = clientY - grid.getBoundingClientRect().top;
        scrollLeft = grid.scrollLeft;
      };
      
      // Touch/Mouse move
      const handleMove = (e) => {
        if (!isDown) return;
        
        const touch = e.touches ? e.touches[0] : null;
        const clientX = touch ? touch.clientX : e.clientX;
        const clientY = touch ? touch.clientY : e.clientY;
        
        const x = clientX - grid.getBoundingClientRect().left;
        const y = clientY - grid.getBoundingClientRect().top;
        const walkX = (x - startX) * 1.2;
        const walkY = Math.abs(y - startY);
        
        // Only scroll horizontally if horizontal movement is greater than vertical
        if (Math.abs(walkX) > Math.abs(walkY) && Math.abs(walkX) > 5) {
          e.preventDefault();
          hasScrolled = true;
          grid.scrollLeft = scrollLeft - walkX;
        }
      };
      
      // Touch/Mouse end
      const handleEnd = (e) => {
        if (!isDown) return;
        isDown = false;
        grid.style.cursor = 'grab';
        grid.style.scrollBehavior = 'smooth';
        
        // If user scrolled, prevent click events on cards
        if (hasScrolled) {
          e.preventDefault();
          e.stopPropagation();
          
          // Temporarily disable clicks on cards
          const cards = grid.querySelectorAll('.card');
          cards.forEach(card => {
            card.style.pointerEvents = 'none';
            setTimeout(() => {
              card.style.pointerEvents = 'auto';
            }, 100);
          });
        }
        
        // Snap to nearest card after a brief delay
        setTimeout(() => {
          snapToNearestCard(grid);
        }, 150);
      };
      
      // Snap to nearest card
      function snapToNearestCard(grid) {
        const cards = grid.querySelectorAll('.card');
        if (cards.length === 0) return;
        
        const firstCard = cards[0];
        const cardWidth = firstCard.offsetWidth;
        const gap = parseInt(getComputedStyle(grid).gap) || 16;
        const cardWidthWithGap = cardWidth + gap;
        const scrollLeft = grid.scrollLeft;
        const nearestIndex = Math.round(scrollLeft / cardWidthWithGap);
        const targetScroll = Math.max(0, Math.min(nearestIndex * cardWidthWithGap, grid.scrollWidth - grid.clientWidth));
        
        grid.scrollTo({
          left: targetScroll,
          behavior: 'smooth'
        });
      }
      
      // Mouse events (for testing on desktop with mouse)
      grid.addEventListener('mousedown', handleStart);
      grid.addEventListener('mouseleave', handleEnd);
      grid.addEventListener('mouseup', handleEnd);
      grid.addEventListener('mousemove', handleMove);
      
      // Touch events (for mobile)
      grid.addEventListener('touchstart', handleStart, { passive: true });
      grid.addEventListener('touchend', handleEnd, { passive: false });
      grid.addEventListener('touchmove', handleMove, { passive: false });
      
      // Add grab cursor style
      grid.style.cursor = 'grab';
      grid.style.userSelect = 'none';
    }

    function renderCart() {
      const container = document.getElementById("cart-items");
      const totalEl = document.getElementById("cart-total");
      container.innerHTML = "";

      if (!cart.length) {
        container.innerHTML = "<div class='text-muted'>Your cart is empty.</div>";
        totalEl.textContent = "$0.00";
        return;
      }

      let total = 0;
      cart.forEach(item => {
        const product = products.find(p => p.id === item.id);
        if (!product) return;
        const lineTotal = product.price * item.qty;
        total += lineTotal;

        const row = document.createElement("div");
        row.className = "row";
        row.style.justifyContent = "space-between";
        row.style.marginBottom = "6px";
        row.innerHTML = `
          <div>
            <div style="font-size:13px;">${product.name}</div>
            <div class="text-muted">${item.qty}  ${formatMoney(product.price)}</div>
          </div>
          <div class="row">
            <span style="font-size:13px; margin-right:8px;">${formatMoney(lineTotal)}</span>
            <button class="btn btn-outline" data-minus-id="${product.id}"></button>
            <button class="btn btn-outline" data-plus-id="${product.id}">+</button>
            <button class="btn btn-outline" data-remove-id="${product.id}"></button>
          </div>
        `;
        container.appendChild(row);
      });

      totalEl.textContent = formatMoney(total);

      container.querySelectorAll("[data-plus-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = parseInt(btn.getAttribute("data-plus-id"), 10);
          const item = cart.find(i => i.id === id);
          if (item) item.qty += 1;
          renderCart();
          updateCartIndicator();
        });
      });
      container.querySelectorAll("[data-minus-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = parseInt(btn.getAttribute("data-minus-id"), 10);
          const item = cart.find(i => i.id === id);
          if (item && item.qty > 1) item.qty -= 1;
          else cart = cart.filter(i => i.id !== id);
          renderCart();
          updateCartIndicator();
        });
      });
      container.querySelectorAll("[data-remove-id]").forEach(btn => {
        btn.addEventListener("click", () => {
          const id = parseInt(btn.getAttribute("data-remove-id"), 10);
          cart = cart.filter(i => i.id !== id);
          renderCart();
          updateCartIndicator();
        });
      });
    }

    function renderAdminProducts() {
      const tbody = document.querySelector("#admin-products-table tbody");
      tbody.innerHTML = "";
      products.forEach(p => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${p.name}</td>
          <td>${p.category}</td>
          <td>${p.thc}</td>
          <td>${formatMoney(p.price)}</td>
          <td><button class="btn btn-outline" data-delete-id="${p.id}">Delete</button></td>
        `;
        tbody.appendChild(tr);
      });

      // wire delete buttons to API
      tbody.querySelectorAll('[data-delete-id]').forEach(btn => {
        btn.addEventListener('click', async ()=>{
          const id = btn.getAttribute('data-delete-id');
          if(!confirm('Delete this product?')) return;
          try{
            const headers = await getAuthHeaders();
            const res = await fetch('/api/products/' + encodeURIComponent(id), { 
              method: 'DELETE',
              headers,
              credentials: 'include'
            });
            if(res.status === 204){
              // reload
              await loadProductsFromApi();
              document.getElementById('admin-ad-status').textContent = 'Product deleted.';
            }else{
              const err = await res.json();
              alert('Delete failed: ' + (err && err.error ? err.error : res.status));
            }
          }catch(e){
            alert('Delete failed: ' + e.message);
          }
        });
      });
    }

    function switchSection(id) {
      document.querySelectorAll("main .section").forEach(sec => {
        sec.classList.toggle("active", sec.id === id);
      });
      // Update navigation active states (handled by updateNavActiveStates)
      updateNavActiveStates();
      if (id === "shop-section") renderProducts();
      if (id === "cart-section") renderCart();
    }

    // --- Event wiring ------------------------------------------------------
    // Navigation buttons are now dynamically generated, so event listeners
    // are attached in renderTopNav() and renderBottomNav() functions

    document.getElementById("category-list").addEventListener("click", e => {
      const item = e.target.closest(".category-item");
      if (!item) return;
      currentCategory = item.getAttribute("data-category");
      document.querySelectorAll(".category-item").forEach(c => {
        c.classList.toggle("active", c === item);
      });
      renderProducts();
    });

    document.getElementById("search-input").addEventListener("input", () => {
      renderProducts();
    });

    document.getElementById("clear-cart-btn").addEventListener("click", () => {
      if (!cart.length) return;
      if (confirm("Clear cart?")) {
        cart = [];
        renderCart();
        updateCartIndicator();
      }
    });

    document.getElementById("place-order-btn").addEventListener("click", async () => {
      const name = document.getElementById("checkout-name").value.trim();
      const phone = document.getElementById("checkout-phone").value.trim();
      const addr = document.getElementById("checkout-address").value.trim();
      const windowVal = document.getElementById("checkout-window").value;
      const notes = document.getElementById("checkout-notes").value.trim();
      const ageOk = document.getElementById("checkout-age-confirm").checked;
      const statusEl = document.getElementById("order-status");

      if (!cart.length) {
        alert("Cart is empty.");
        return;
      }
      if (!name || !phone || !addr) {
        alert("Fill out name, phone, and address.");
        return;
      }
      if (!ageOk) {
        alert("You must confirm age 21+.");
        return;
      }

      try {
        const headers = await getAuthHeaders();
        const orderItems = cart.map(item => ({
          product_id: item.id,
          quantity: item.qty
        }));

        const res = await fetch('/api/orders', {
          method: 'POST',
          headers,
          body: JSON.stringify({
            customer_name: name,
            customer_phone: phone,
            delivery_address: addr,
            delivery_window: windowVal,
            order_notes: notes,
            items: orderItems,
            age_confirmed: true
          }),
          credentials: 'include'
        });

        if (res.ok) {
          const order = await res.json();
          showToast(`Order #${order.id} placed successfully!`, 'View orders', () => {
            // Could navigate to orders view
          });
          statusEl.textContent = `Order #${order.id} placed successfully! Total: ${formatMoney(order.total)}`;
          cart = [];
          renderCart();
          updateCartIndicator();
          
          // Clear form
          document.getElementById("checkout-name").value = '';
          document.getElementById("checkout-phone").value = '';
          document.getElementById("checkout-address").value = '';
          document.getElementById("checkout-notes").value = '';
          document.getElementById("checkout-age-confirm").checked = false;
        } else {
          const error = await res.json();
          alert('Order failed: ' + (error.error || 'Unknown error'));
        }
      } catch (e) {
        console.error('Order error:', e);
        alert('Failed to place order. Please try again.');
      }
    });

    document.getElementById("submit-id-btn").addEventListener("click", () => {
      const first = document.getElementById("id-first-name").value.trim();
      const last = document.getElementById("id-last-name").value.trim();
      const dob = document.getElementById("id-dob").value;
      const file = document.getElementById("id-file").files[0];
      const consent = document.getElementById("id-consent").checked;
      const statusEl = document.getElementById("id-status");

      if (!first || !last || !dob || !file) {
        alert("Fill out all ID fields and choose a file.");
        return;
      }
      if (!consent) {
        alert("You must consent to ID storage.");
        return;
      }
      statusEl.textContent = `ID submitted for ${first} ${last} (demo only, not uploaded anywhere).`;
    });

    // Featured Deal admin removed

    // Carousel Banner Management
    let carouselSlides = JSON.parse(localStorage.getItem('carouselSlides') || '[]');
    if (carouselSlides.length === 0) {
      // Default slides
      carouselSlides = [
        { img: 'https://picsum.photos/seed/promo1/1200/420', title: 'Weekend Special', subtitle: '20% off selected strains  Code WEEKEND', cta: 'Shop deals' },
        { img: 'https://picsum.photos/seed/promo2/1200/420', title: 'Free Delivery', subtitle: 'Free delivery over $75 this week only', cta: 'Learn more' },
        { img: 'https://picsum.photos/seed/promo3/1200/420', title: 'New Arrivals', subtitle: 'Fresh live rosin and new gummies', cta: 'Browse new' }
      ];
    }

    function renderCarouselAdmin() {
      const container = document.getElementById('carousel-slides-admin');
      container.innerHTML = '';
      
      carouselSlides.forEach((slide, index) => {
        const slideDiv = document.createElement('div');
        slideDiv.className = 'carousel-slide-admin';
        slideDiv.innerHTML = `
          <div class="carousel-slide-admin-header">
            <div class="carousel-slide-admin-title">Slide ${index + 1}</div>
            <button class="btn btn-outline" onclick="removeCarouselSlide(${index})" style="padding: var(--space-xs) var(--space-sm); font-size: 12px;">Remove</button>
          </div>
          <div class="carousel-slide-admin-preview">
            <img src="${slide.img}" alt="Preview" id="carousel-preview-${index}" />
          </div>
          <div class="form-group">
            <label>Upload Image</label>
            <input type="file" accept="image/*" class="carousel-image-file" data-index="${index}" style="width: 100%; padding: var(--space-sm);" />
          </div>
          <div class="form-group">
            <label>Or Enter Image URL</label>
            <input type="text" class="carousel-image-url" data-index="${index}" value="${slide.img}" placeholder="Image URL" style="width: 100%;" />
          </div>
          <div class="form-group">
            <label>Title</label>
            <input type="text" class="carousel-title" data-index="${index}" value="${slide.title || ''}" placeholder="Slide title" style="width: 100%;" />
          </div>
          <div class="form-group">
            <label>Subtitle</label>
            <input type="text" class="carousel-subtitle" data-index="${index}" value="${slide.subtitle || ''}" placeholder="Slide subtitle" style="width: 100%;" />
          </div>
          <div class="form-group">
            <label>CTA Button Text</label>
            <input type="text" class="carousel-cta" data-index="${index}" value="${slide.cta || ''}" placeholder="Button text" style="width: 100%;" />
          </div>
        `;
        container.appendChild(slideDiv);

        // Add event listeners for this slide
        const fileInput = slideDiv.querySelector('.carousel-image-file');
        const urlInput = slideDiv.querySelector('.carousel-image-url');
        const titleInput = slideDiv.querySelector('.carousel-title');
        const subtitleInput = slideDiv.querySelector('.carousel-subtitle');
        const ctaInput = slideDiv.querySelector('.carousel-cta');

        fileInput.addEventListener('change', async (e) => {
          const file = e.target.files[0];
          if (file) {
            await uploadCarouselImage(file, index);
          }
        });

        urlInput.addEventListener('input', (e) => {
          carouselSlides[index].img = e.target.value;
          document.getElementById(`carousel-preview-${index}`).src = e.target.value;
        });

        titleInput.addEventListener('input', (e) => {
          carouselSlides[index].title = e.target.value;
        });

        subtitleInput.addEventListener('input', (e) => {
          carouselSlides[index].subtitle = e.target.value;
        });

        ctaInput.addEventListener('input', (e) => {
          carouselSlides[index].cta = e.target.value;
        });
      });
    }

    async function uploadCarouselImage(file, index) {
      if (!currentUser || currentUser.role !== 'admin') {
        alert('Admin access required');
        return;
      }

      try {
        const formData = new FormData();
        formData.append('image', file);
        
        const token = localStorage.getItem('authToken');
        const uploadRes = await fetch('/api/upload/image', {
          method: 'POST',
          headers: {
            'Authorization': `Bearer ${token}`
          },
          body: formData,
          credentials: 'include'
        });

        if (uploadRes.ok) {
          const uploadData = await uploadRes.json();
          carouselSlides[index].img = uploadData.url;
          document.getElementById(`carousel-preview-${index}`).src = uploadData.url;
          document.querySelector(`.carousel-image-url[data-index="${index}"]`).value = uploadData.url;
          showToast('Image uploaded successfully!', 'OK');
        } else {
          const uploadError = await uploadRes.json().catch(() => ({ error: 'Upload failed' }));
          alert('Image upload failed: ' + (uploadError.error || 'Unknown error'));
        }
      } catch (error) {
        alert('Error uploading image: ' + error.message);
      }
    }

    window.removeCarouselSlide = function(index) {
      if (confirm('Remove this slide?')) {
        carouselSlides.splice(index, 1);
        renderCarouselAdmin();
      }
    };

    document.getElementById('add-carousel-slide-btn').addEventListener('click', () => {
      if (carouselSlides.length >= 5) {
        alert('Maximum 5 slides allowed');
        return;
      }
      carouselSlides.push({
        img: 'https://picsum.photos/seed/promo' + (carouselSlides.length + 1) + '/1200/420',
        title: 'New Slide',
        subtitle: 'Enter subtitle here',
        cta: 'Learn more'
      });
      renderCarouselAdmin();
    });

    document.getElementById('save-carousel-btn').addEventListener('click', () => {
      localStorage.setItem('carouselSlides', JSON.stringify(carouselSlides));
      document.getElementById('carousel-status').textContent = 'Carousel banners saved! Changes will appear on next page load.';
      document.getElementById('carousel-status').style.color = 'var(--text-primary)';
      showToast('Carousel banners saved!', 'OK');
    });

    // Render carousel admin when admin section is shown
    const originalSwitchSection = switchSection;
    window.switchSection = function(id) {
      // Protect admin section - require authentication and admin role
      if (id === 'admin-section') {
        if (!currentUser) {
          alert('Please log in to access the admin panel.');
          switchSection('account-section');
          return;
        }
        if (currentUser.role !== 'admin') {
          alert('Admin access required. You do not have permission to access this section.');
          switchSection('shop-section');
          return;
        }
        renderCarouselAdmin();
      }
      if (id === 'cart-section') {
        renderCart();
        if (typeof setCheckoutStep === 'function') setCheckoutStep(1);
        if (typeof updateCheckoutSummary === 'function') updateCheckoutSummary();
      }
      originalSwitchSection(id);
      // Update navigation active states after section switch
      updateNavActiveStates();
      // Update AppFooter active states (for backward compatibility)
      if (typeof initAppFooter === 'function') initAppFooter();
    };

    // Image preview functionality
    const imageFileInput = document.getElementById('admin-new-image-file');
    const imageUrlInput = document.getElementById('admin-new-image-url');
    const previewDiv = document.getElementById('image-preview');
    const previewImg = document.getElementById('preview-img');
    const removePreviewBtn = document.getElementById('remove-preview');

    imageFileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        // Clear URL input when file is selected
        imageUrlInput.value = '';
        
        // Show preview
        const reader = new FileReader();
        reader.onload = (e) => {
          previewImg.src = e.target.result;
          previewDiv.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    });

    imageUrlInput.addEventListener('input', (e) => {
      if (e.target.value.trim()) {
        // Clear file input when URL is entered
        imageFileInput.value = '';
        previewDiv.style.display = 'none';
      }
    });

    removePreviewBtn.addEventListener('click', () => {
      imageFileInput.value = '';
      previewDiv.style.display = 'none';
      previewImg.src = '';
    });

    // Admin: Add product
    document.getElementById('add-product-btn').addEventListener('click', async () => {
      const name = document.getElementById('admin-new-name').value.trim();
      const category = document.getElementById('admin-new-category').value;
      const price = Number(document.getElementById('admin-new-price').value || 0);
      const thc = Number(document.getElementById('admin-new-thc').value || 0);
      const imageFile = document.getElementById('admin-new-image-file').files[0];
      const imageUrl = document.getElementById('admin-new-image-url').value.trim();
      const status = document.getElementById('admin-ad-status');
      
      if(!name){ 
        alert('Enter product name'); 
        return; 
      }
      
      if (!currentUser) {
        alert('Please log in first. Use admin@zipmetro.com / admin123');
        switchSection('account-section');
        return;
      }
      
      if (currentUser.role !== 'admin') {
        alert('Admin access required. Please log in as admin.');
        return;
      }
      
      try{
        let imagePath = imageUrl; // Default to URL if provided
        
        // Upload file if selected
        if (imageFile) {
          status.textContent = 'Uploading image...';
          const formData = new FormData();
          formData.append('image', imageFile);
          
          const token = localStorage.getItem('authToken');
          const uploadRes = await fetch('/api/upload/image', {
    method: 'POST',
    headers: {
        'Authorization': `Bearer ${token}`
    },
    body: formData,
    credentials: 'include'
});

          
          if (uploadRes.ok) {
            const uploadData = await uploadRes.json();
            imagePath = uploadData.url; // Use uploaded file URL
          } else {
            const uploadError = await uploadRes.json().catch(() => ({ error: 'Upload failed' }));
            throw new Error('Image upload failed: ' + (uploadError.error || 'Unknown error'));
          }
        }
        
        // Create product with image path
        const headers = await getAuthHeaders();
        const res = await fetch('/api/products', { 
          method: 'POST', 
          headers,
          body: JSON.stringify({ name, category, price, thc, image: imagePath }),
          credentials: 'include'
        });
        
        if(res.status === 201){
          const created = await res.json();
          status.textContent = 'Product added: ' + created.name;
          status.style.color = 'var(--text-primary)';
          showToast('Product added successfully!', 'OK');
          // clear inputs
          document.getElementById('admin-new-name').value='';
          document.getElementById('admin-new-price').value='';
          document.getElementById('admin-new-thc').value='';
          document.getElementById('admin-new-image-file').value='';
          document.getElementById('admin-new-image-url').value='';
          previewDiv.style.display = 'none';
          previewImg.src = '';
          await loadProductsFromApi();
        } else if (res.status === 401) {
          alert('Please log in as admin first. Use: admin@zipmetro.com / admin123');
          switchSection('account-section');
        } else if (res.status === 403) {
          alert('Admin access required. Please log in as admin.');
        } else {
          const err = await res.json().catch(() => ({ error: 'Unknown error' }));
          status.textContent = 'Add failed: ' + (err.error || `Status ${res.status}`);
          status.style.color = 'var(--accent)';
          alert('Add failed: ' + (err.error || `Status ${res.status}`));
        }
      } catch(e) { 
        console.error('Add product error:', e);
        status.textContent = 'Add failed: ' + e.message;
        status.style.color = 'var(--accent)';
        alert('Add failed: ' + e.message + '. Make sure you are logged in as admin.');
      }
    });

    // Tab switching functionality
    function initTabs() {
      // Main tabs
      document.querySelectorAll('.tab-button[data-tab]').forEach(button => {
        button.addEventListener('click', () => {
          const tabId = button.getAttribute('data-tab');
          
          // Update button states
          document.querySelectorAll('.tab-button[data-tab]').forEach(btn => {
            btn.classList.remove('active');
            btn.setAttribute('aria-selected', 'false');
          });
          button.classList.add('active');
          button.setAttribute('aria-selected', 'true');
          
          // Update content visibility
          document.querySelectorAll('.tab-content[id$="-tab"]').forEach(content => {
            content.classList.remove('active');
          });
          const targetContent = document.getElementById(tabId);
          if (targetContent) {
            targetContent.classList.add('active');
          }
        });
      });

      // Sub-tabs (Login/Register)
      document.querySelectorAll('.tab-button[data-subtab]').forEach(button => {
        button.addEventListener('click', () => {
          const subtabId = button.getAttribute('data-subtab');
          
          // Update button states
          document.querySelectorAll('.tab-button[data-subtab]').forEach(btn => {
            btn.classList.remove('active');
          });
          button.classList.add('active');
          
          // Update content visibility
          const parentTab = button.closest('.tab-content');
          if (parentTab) {
            parentTab.querySelectorAll('.tab-content[id$="-subtab"]').forEach(content => {
              content.classList.remove('active');
            });
            const targetContent = document.getElementById(subtabId);
            if (targetContent) {
              targetContent.classList.add('active');
            }
          }
        });
      });
    }

    // Initialize notification toggles
    function initNotificationToggles() {
      const smsToggle = document.getElementById('notif-sms-toggle');
      const emailToggle = document.getElementById('notif-email-toggle');
      const pushToggle = document.getElementById('notif-push-toggle');

      // Set initial states
      if (smsToggle) smsToggle.checked = notifPrefs.sms;
      if (emailToggle) emailToggle.checked = notifPrefs.email;
      if (pushToggle) pushToggle.checked = notifPrefs.push;

      // Add change listeners
      if (smsToggle) {
        smsToggle.addEventListener('change', () => {
          notifPrefs.sms = smsToggle.checked;
        });
      }
      if (emailToggle) {
        emailToggle.addEventListener('change', () => {
          notifPrefs.email = emailToggle.checked;
        });
      }
      if (pushToggle) {
        pushToggle.addEventListener('change', () => {
          notifPrefs.push = pushToggle.checked;
        });
      }
    }

    document.getElementById("save-notif-btn").addEventListener("click", () => {
      const status = document.getElementById("notif-status");
      const enabled = Object.entries(notifPrefs)
        .filter(([, v]) => v)
        .map(([k]) => k.toUpperCase())
        .join(", ") || "NONE";
      status.textContent = "Saved. Channels enabled: " + enabled + ".";
      status.style.color = 'var(--text-primary)';
    });

    // --- Auth Event Listeners ----------------------------------------------
    document.getElementById('login-btn').addEventListener('click', async () => {
      const email = document.getElementById('login-email').value.trim();
      const password = document.getElementById('login-password').value.trim();
      if (!email || !password) {
        document.getElementById('login-status').textContent = 'Please enter email and password';
        document.getElementById('login-status').style.color = 'var(--accent)';
        return;
      }
      await login(email, password);
    });

    document.getElementById('register-btn').addEventListener('click', async () => {
      const email = document.getElementById('register-email').value.trim();
      const password = document.getElementById('register-password').value.trim();
      const firstName = document.getElementById('register-first-name').value.trim();
      const lastName = document.getElementById('register-last-name').value.trim();
      if (!email || !password) {
        document.getElementById('register-status').textContent = 'Please enter email and password';
        document.getElementById('register-status').style.color = 'var(--accent)';
        return;
      }
      await register(email, password, firstName, lastName);
    });

    document.getElementById('logout-btn').addEventListener('click', () => {
      logout();
    });

    document.getElementById('login-toggle-btn').addEventListener('click', () => {
      switchSection('account-section');
    });

    // --- Initial render ----------------------------------------------------
    // Load products from API (falls back to client-side if API unavailable)
    loadProductsFromApi();
    renderAdminProducts();
    // Initialize tabs and notification toggles
    initTabs();
    initNotificationToggles();
    // Initialize carousel admin if admin section is active
    if (document.getElementById('admin-section')?.classList.contains('active')) {
      renderCarouselAdmin();
    }
    // accessibility: focus main when skip-link used
    document.querySelector('.skip-link').addEventListener('click', (e)=>{
      const m = document.getElementById('main-content');
      if(m){ m.setAttribute('tabindex','-1'); m.focus(); }
    });

    // Mini-Cart Functions
    function openMiniCart() {
      const miniCart = document.getElementById('mini-cart');
      const overlay = document.getElementById('mini-cart-overlay');
      if (miniCart && overlay) {
        miniCart.hidden = false;
        overlay.hidden = false;
        document.body.style.overflow = 'hidden';
        renderMiniCart();
      }
    }

    function closeMiniCart() {
      const miniCart = document.getElementById('mini-cart');
      const overlay = document.getElementById('mini-cart-overlay');
      if (miniCart && overlay) {
        miniCart.hidden = true;
        overlay.hidden = true;
        document.body.style.overflow = '';
      }
    }

    function renderMiniCart() {
      const body = document.getElementById('mini-cart-body');
      const footer = document.getElementById('mini-cart-footer');
      const totalEl = document.getElementById('mini-cart-total');
      if (!body || !footer || !totalEl) return;

      body.innerHTML = '';
      
      if (!cart.length) {
        footer.style.display = 'none';
        return;
      }

      footer.style.display = 'block';
      let total = 0;

      cart.forEach(item => {
        const product = products.find(p => p.id === item.id);
        if (!product) return;
        const lineTotal = product.price * item.qty;
        total += lineTotal;

        const itemEl = document.createElement('div');
        itemEl.className = 'mini-cart-item';
        itemEl.innerHTML = `
          <img class="mini-cart-item-image" src="${product.image || ''}" alt="${product.name}" onerror="this.style.display='none'" />
          <div class="mini-cart-item-details">
            <div class="mini-cart-item-name">${product.name}</div>
            <div class="mini-cart-item-price">${formatMoney(product.price)} each</div>
            <div class="mini-cart-qty-controls">
              <button class="mini-cart-qty-btn" onclick="updateCartQty(${product.id}, -1)"></button>
              <span class="mini-cart-qty-value">${item.qty}</span>
              <button class="mini-cart-qty-btn" onclick="updateCartQty(${product.id}, 1)">+</button>
            </div>
          </div>
          <button class="mini-cart-item-remove" onclick="removeFromCart(${product.id})" aria-label="Remove ${product.name}"></button>
        `;
        body.appendChild(itemEl);
      });

      totalEl.textContent = formatMoney(total);
    }

    function updateCartQty(productId, delta) {
      const item = cart.find(i => i.id === productId);
      if (!item) return;
      item.qty = Math.max(0, item.qty + delta);
      if (item.qty === 0) {
        cart = cart.filter(i => i.id !== productId);
      }
      saveCart();
      updateCartIndicator();
      renderMiniCart();
      renderCart();
      updateCheckoutSummary();
    }

    function removeFromCart(productId) {
      cart = cart.filter(i => i.id !== productId);
      saveCart();
      updateCartIndicator();
      renderMiniCart();
      renderCart();
      updateCheckoutSummary();
    }

    // Mini-cart event listeners
    document.getElementById('mini-cart-close')?.addEventListener('click', closeMiniCart);
    document.getElementById('mini-cart-overlay')?.addEventListener('click', closeMiniCart);
    document.getElementById('mini-cart-checkout')?.addEventListener('click', () => {
      closeMiniCart();
      switchSection('cart-section');
    });

    // Checkout Step Management
    let currentCheckoutStep = 1;

    function setCheckoutStep(step) {
      currentCheckoutStep = step;
      
      // Update step indicators
      document.querySelectorAll('.checkout-step').forEach((el, idx) => {
        const stepNum = idx + 1;
        el.classList.remove('active', 'completed');
        if (stepNum < step) {
          el.classList.add('completed');
        } else if (stepNum === step) {
          el.classList.add('active');
        }
      });

      // Show/hide step content
      document.querySelectorAll('.checkout-step-content').forEach((el, idx) => {
        const stepNum = idx + 1;
        if (stepNum === step) {
          el.classList.add('active');
        } else {
          el.classList.remove('active');
        }
      });
    }

    function updateCheckoutSummary() {
      const container = document.getElementById('checkout-summary-items');
      const totalEl = document.getElementById('checkout-summary-total');
      if (!container || !totalEl) return;

      container.innerHTML = '';
      let total = 0;

      cart.forEach(item => {
        const product = products.find(p => p.id === item.id);
        if (!product) return;
        const lineTotal = product.price * item.qty;
        total += lineTotal;

        const itemEl = document.createElement('div');
        itemEl.className = 'checkout-summary-item';
        itemEl.innerHTML = `
          <div>
            <div class="checkout-summary-item-name">${product.name}</div>
            <div class="checkout-summary-item-qty">Qty: ${item.qty}</div>
          </div>
          <div>${formatMoney(lineTotal)}</div>
        `;
        container.appendChild(itemEl);
      });

      totalEl.textContent = formatMoney(total);
    }

    function validateCheckoutForm() {
      const name = document.getElementById('checkout-name');
      const phone = document.getElementById('checkout-phone');
      const address = document.getElementById('checkout-address');
      const window = document.getElementById('checkout-window');
      const ageConfirm = document.getElementById('checkout-age-confirm');
      const formError = document.getElementById('checkout-form-error');

      let isValid = true;
      const errors = [];

      // Clear previous errors
      [name, phone, address, window, ageConfirm].forEach(el => {
        if (el) {
          el.classList.remove('form-invalid', 'form-valid');
          const errorEl = document.getElementById(el.id + '-error');
          if (errorEl) errorEl.textContent = '';
        }
      });
      if (formError) formError.style.display = 'none';

      // Validate name
      if (!name || !name.value.trim()) {
        isValid = false;
        if (name) {
          name.classList.add('form-invalid');
          const errorEl = document.getElementById('checkout-name-error');
          if (errorEl) errorEl.textContent = 'Name is required';
        }
        errors.push('Name is required');
      } else if (name) {
        name.classList.add('form-valid');
      }

      // Validate phone
      const phoneRegex = /^[\d\s\(\)\-]+$/;
      if (!phone || !phone.value.trim()) {
        isValid = false;
        if (phone) {
          phone.classList.add('form-invalid');
          const errorEl = document.getElementById('checkout-phone-error');
          if (errorEl) errorEl.textContent = 'Phone is required';
        }
        errors.push('Phone is required');
      } else if (phone && !phoneRegex.test(phone.value)) {
        isValid = false;
        phone.classList.add('form-invalid');
        const errorEl = document.getElementById('checkout-phone-error');
        if (errorEl) errorEl.textContent = 'Please enter a valid phone number';
        errors.push('Invalid phone number');
      } else if (phone) {
        phone.classList.add('form-valid');
      }

      // Validate address
      if (!address || !address.value.trim()) {
        isValid = false;
        if (address) {
          address.classList.add('form-invalid');
          const errorEl = document.getElementById('checkout-address-error');
          if (errorEl) errorEl.textContent = 'Address is required';
        }
        errors.push('Address is required');
      } else if (address) {
        address.classList.add('form-valid');
      }

      // Validate delivery window
      if (!window || !window.value) {
        isValid = false;
        if (window) {
          window.classList.add('form-invalid');
          const errorEl = document.getElementById('checkout-window-error');
          if (errorEl) errorEl.textContent = 'Please select a delivery window';
        }
        errors.push('Delivery window is required');
      } else if (window) {
        window.classList.add('form-valid');
      }

      // Validate age confirmation
      if (!ageConfirm || !ageConfirm.checked) {
        isValid = false;
        if (ageConfirm) {
          const errorEl = document.getElementById('checkout-age-confirm-error');
          if (errorEl) errorEl.textContent = 'Age confirmation is required';
        }
        errors.push('Age confirmation is required');
      }

      if (!isValid && formError) {
        formError.textContent = 'Please fix the errors above';
        formError.style.display = 'block';
      }

      return isValid;
    }

    function initCheckoutForm() {
      const form = document.getElementById('checkout-form');
      const continueBtn1 = document.getElementById('checkout-continue-1');
      const backBtn2 = document.getElementById('checkout-back-2');
      const placeOrderBtn = document.getElementById('place-order-btn');

      if (continueBtn1) {
        continueBtn1.addEventListener('click', () => {
          if (cart.length === 0) {
            showToast('Your cart is empty', 'Add items', () => switchSection('shop-section'));
            return;
          }
          setCheckoutStep(2);
        });
      }

      if (backBtn2) {
        backBtn2.addEventListener('click', () => {
          setCheckoutStep(1);
        });
      }

      if (form) {
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          if (validateCheckoutForm()) {
            // Simulate order placement
            const orderNumber = 'ZM' + Date.now().toString().slice(-6);
            document.getElementById('order-number').textContent = orderNumber;
            setCheckoutStep(3);
            
            // Clear cart after successful order
            cart = [];
            saveCart();
            updateCartIndicator();
            
            showToast('Order placed successfully!', 'View order', () => {});
          }
        });
      }
    }

    function initMobileCartCTA() {
      const cta = document.getElementById('mobile-view-cart-cta');
      const countEl = document.getElementById('mobile-view-cart-count');
      
      function updateCTA() {
        if (!cta || !countEl) return;
        const itemCount = cart.reduce((sum, item) => sum + item.qty, 0);
        countEl.textContent = itemCount;
        
        if (itemCount > 0 && window.innerWidth <= 768) {
          cta.hidden = false;
        } else {
          cta.hidden = true;
        }
      }

      if (cta) {
        cta.addEventListener('click', () => {
          openMiniCart();
        });
      }

      // Update on cart change and window resize
      const originalUpdateCartIndicator = updateCartIndicator;
      updateCartIndicator = function() {
        originalUpdateCartIndicator();
        updateCTA();
      };

      window.addEventListener('resize', updateCTA);
      updateCTA();
    }

    // Checkout initialization is handled in the switchSection wrapper above

    // Initialize on page load
    initCheckoutForm();
    initMobileCartCTA();
    updateCheckoutSummary();
    
    // Render TopNav (Desktop header navigation)
    function renderTopNav() {
      const topNav = document.getElementById('site-nav');
      if (!topNav) return;
      
      topNav.innerHTML = '';
      
      navItems.forEach(item => {
        // Check role-based visibility
        if (item.showForRole && (!currentUser || currentUser.role !== item.showForRole)) {
          return; // Skip this item
        }
        
        const button = document.createElement('button');
        button.className = 'nav-btn';
        button.setAttribute('data-section', item.id);
        button.textContent = item.label;
        button.addEventListener('click', () => switchSection(item.id));
        topNav.appendChild(button);
      });
      
      updateNavActiveStates();
    }
    
    // Render BottomNav (Mobile bottom navigation)
    function renderBottomNav() {
      const bottomNav = document.getElementById('bottom-nav');
      if (!bottomNav) return;
      
      bottomNav.innerHTML = '';
      
      // Filter nav items for bottom nav (exclude admin from bottom nav, show in account section instead)
      const bottomNavItems = navItems.filter(item => item.id !== 'admin-section');
      
      bottomNavItems.forEach(item => {
        // Check role-based visibility
        if (item.showForRole && (!currentUser || currentUser.role !== item.showForRole)) {
          return; // Skip this item
        }
        
        const button = document.createElement('button');
        button.className = 'app-footer-link';
        button.setAttribute('data-section', item.id);
        button.setAttribute('aria-label', item.label);
        button.onclick = () => switchSection(item.id);
        
        button.innerHTML = `
          <div class="app-footer-icon">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              ${item.icon}
            </svg>
          </div>
          <span class="app-footer-label">${item.label}</span>
        `;
        
        bottomNav.appendChild(button);
      });
      
      updateNavActiveStates();
    }
    
    // Update active states for both TopNav and BottomNav
    function updateNavActiveStates() {
      const activeSection = document.querySelector('.section.active');
      if (!activeSection) return;
      
      const sectionId = activeSection.id;
      
      // Update TopNav active states
      document.querySelectorAll('#site-nav .nav-btn').forEach(btn => {
        const btnSection = btn.getAttribute('data-section');
        btn.classList.toggle('active', btnSection === sectionId);
      });
      
      // Update BottomNav active states
      document.querySelectorAll('.app-footer-link').forEach(link => {
        const linkSection = link.getAttribute('data-section');
        link.classList.toggle('active', linkSection === sectionId);
      });
    }
    
    // Initialize navigation (TopNav and BottomNav)
    function initNavigation() {
      renderTopNav();
      renderBottomNav();
      updateNavActiveStates();
    }
    
    // Initialize AppFooter active state (kept for backward compatibility)
    function initAppFooter() {
      updateNavActiveStates();
    }
    
    // Initialize navigation on page load
    initNavigation();
  </script>

  <!-- BottomNav - Mobile-only bottom navigation -->
  <div class="app-footer">
    <nav role="navigation" aria-label="Primary app navigation" id="bottom-nav">
      <!-- Navigation links will be generated by JavaScript from navItems config -->
    </nav>
  </div>

  <!-- Footer -->
  <footer>
    <div class="footer-top">
      <div class="footer-col">
        <div class="footer-logo">ZipMetro</div>
        <p class="footer-tagline">Fast, Local Cannabis Delivery</p>
        <div class="footer-trust">
          <p>21+ Licensed Delivery</p>
          <p>Secure Checkout</p>
        </div>
      </div>
      <div class="footer-col">
        <h4>Quick Links</h4>
        <ul class="footer-links">
          <li><a href="#" onclick="switchSection('shop-section'); return false;">Shop Now</a></li>
          <li><a href="#" onclick="switchSection('shop-section'); filterDeals(); return false;">View Deals</a></li>
          <li><a href="#" onclick="switchSection('cart-section'); return false;">My Orders</a></li>
          <li><a href="#" onclick="switchSection('account-section'); return false;">My Account</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <h4>Support</h4>
        <ul class="footer-links">
          <li><a href="#">FAQ</a></li>
          <li><a href="#">Contact Us</a></li>
          <li><a href="#">Delivery Info</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <h4>Legal</h4>
        <ul class="footer-links">
          <li><a href="#">Terms of Service</a></li>
          <li><a href="#">Privacy Policy</a></li>
          <li><a href="#">Compliance</a></li>
        </ul>
      </div>
      <div class="footer-col">
        <h4>Connect</h4>
        <div class="social-icons">
          <a href="#" aria-label="Facebook">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
          </a>
          <a href="#" aria-label="Instagram">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
          </a>
          <a href="#" aria-label="Twitter">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
          </a>
          <a href="#" aria-label="LinkedIn">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
          </a>
        </div>
        <div class="newsletter-signup">
          <input type="email" placeholder="Your email" />
          <button class="btn btn-primary">Subscribe</button>
        </div>
      </div>
    </div>
    <div class="footer-bottom">
      <p>&copy; 2024 ZipMetro. All rights reserved.</p>
      <p class="compliance-notice">For 21+ licensed delivery. This product has not been evaluated by the FDA.</p>
    </div>
  </footer>
</body>
</html>


